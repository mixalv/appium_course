"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.NoDriverProxyCommandError = exports.AppiumDriver = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _config = require("./config");

var _baseDriver = require("@appium/base-driver");

var _asyncLock = _interopRequireDefault(require("async-lock"));

var _utils = require("./utils");

var _support = require("@appium/support");

var _schema = require("./schema");

const desiredCapabilityConstraints = Object.freeze({
  automationName: {
    presence: true,
    isString: true
  },
  platformName: {
    presence: true,
    isString: true
  }
});
const sessionsListGuard = new _asyncLock.default();
const pendingDriversGuard = new _asyncLock.default();

class AppiumDriver extends _baseDriver.DriverCore {
  sessions = {};
  pendingDrivers = {};
  newCommandTimeoutMs = 0;
  pluginClasses = [];
  sessionPlugins = {};
  sessionlessPlugins = [];
  driverConfig;
  server;

  constructor(opts) {
    if (opts.tmpDir) {
      process.env.APPIUM_TMP_DIR = opts.tmpDir;
    }

    super(opts);
    this.desiredCapConstraints = desiredCapabilityConstraints;
    this.args = { ...opts
    };
    (0, _config.updateBuildInfo)().catch(err => {
      this.log.debug(err);
    });
  }

  get log() {
    if (!this._log) {
      const instanceName = `${this.constructor.name}@${_support.node.getObjectId(this).substring(0, 4)}`;
      this._log = _support.logger.getLogger(instanceName);
    }

    return this._log;
  }

  get isCommandsQueueEnabled() {
    return false;
  }

  sessionExists(sessionId) {
    const dstSession = this.sessions[sessionId];
    return dstSession && dstSession.sessionId !== null;
  }

  driverForSession(sessionId) {
    return this.sessions[sessionId];
  }

  async getStatus() {
    return {
      build: _lodash.default.clone((0, _config.getBuildInfo)())
    };
  }

  async getSessions() {
    return _lodash.default.toPairs(this.sessions).map(([id, driver]) => ({
      id,
      capabilities: driver.caps
    }));
  }

  printNewSessionAnnouncement(driverName, driverVersion, driverBaseVersion) {
    this.log.info(driverVersion ? `Appium v${_config.APPIUM_VER} creating new ${driverName} (v${driverVersion}) session` : `Appium v${_config.APPIUM_VER} creating new ${driverName} session`);
    this.log.info(`Checking BaseDriver versions for Appium and ${driverName}`);
    this.log.info(AppiumDriver.baseVersion ? `Appium's BaseDriver version is ${AppiumDriver.baseVersion}` : `Could not determine Appium's BaseDriver version`);
    this.log.info(driverBaseVersion ? `${driverName}'s BaseDriver version is ${driverBaseVersion}` : `Could not determine ${driverName}'s BaseDriver version`);
  }

  assignCliArgsToExtension(extType, extName, extInstance) {
    var _this$args$extType;

    const allCliArgsForExt = (_this$args$extType = this.args[extType]) === null || _this$args$extType === void 0 ? void 0 : _this$args$extType[extName];

    if (!_lodash.default.isEmpty(allCliArgsForExt)) {
      const defaults = (0, _schema.getDefaultsForExtension)(extType, extName);
      const cliArgs = _lodash.default.isEmpty(defaults) ? allCliArgsForExt : _lodash.default.omitBy(allCliArgsForExt, (value, key) => _lodash.default.isEqual(defaults[key], value));

      if (!_lodash.default.isEmpty(cliArgs)) {
        extInstance.cliArgs = cliArgs;
      }
    }
  }

  async createSession(jsonwpCaps, reqCaps, w3cCapabilities, driverData) {
    var _alwaysMatch, _w3cCapabilities;

    const defaultCapabilities = _lodash.default.cloneDeep(this.args.defaultCapabilities);

    const defaultSettings = (0, _utils.pullSettings)(defaultCapabilities);
    jsonwpCaps = _lodash.default.cloneDeep(jsonwpCaps);
    const jwpSettings = { ...defaultSettings,
      ...(0, _utils.pullSettings)(jsonwpCaps)
    };
    w3cCapabilities = _lodash.default.cloneDeep(w3cCapabilities);
    const w3cSettings = { ...jwpSettings,
      ...(0, _utils.pullSettings)((_alwaysMatch = ((_w3cCapabilities = w3cCapabilities) !== null && _w3cCapabilities !== void 0 ? _w3cCapabilities : {}).alwaysMatch) !== null && _alwaysMatch !== void 0 ? _alwaysMatch : {})
    };

    for (const firstMatchEntry of (_firstMatch = ((_w3cCapabilities2 = w3cCapabilities) !== null && _w3cCapabilities2 !== void 0 ? _w3cCapabilities2 : {}).firstMatch) !== null && _firstMatch !== void 0 ? _firstMatch : []) {
      var _firstMatch, _w3cCapabilities2;

      Object.assign(w3cSettings, (0, _utils.pullSettings)(firstMatchEntry));
    }

    let protocol;
    let innerSessionId, dCaps;

    try {
      const parsedCaps = (0, _utils.parseCapsForInnerDriver)(jsonwpCaps, w3cCapabilities, this.desiredCapConstraints, defaultCapabilities);
      const {
        desiredCaps,
        processedJsonwpCapabilities,
        processedW3CCapabilities
      } = parsedCaps;
      protocol = parsedCaps.protocol;
      const error = parsedCaps.error;

      if (error) {
        throw error;
      }

      const {
        driver: InnerDriver,
        version: driverVersion,
        driverName
      } = this.driverConfig.findMatchingDriver(desiredCaps);
      this.printNewSessionAnnouncement(InnerDriver.name, driverVersion, InnerDriver.baseVersion);

      if (this.args.sessionOverride) {
        await this.deleteAllSessions();
      }

      let runningDriversData = [];
      let otherPendingDriversData = [];
      const driverInstance = new InnerDriver(this.args, true);

      if (this.args.relaxedSecurityEnabled) {
        this.log.info(`Applying relaxed security to '${InnerDriver.name}' as per ` + `server command line argument. All insecure features will be ` + `enabled unless explicitly disabled by --deny-insecure`);
        driverInstance.relaxedSecurityEnabled = true;
      }

      if (!_lodash.default.isEmpty(this.args.denyInsecure)) {
        this.log.info('Explicitly preventing use of insecure features:');
        this.args.denyInsecure.map(a => this.log.info(`    ${a}`));
        driverInstance.denyInsecure = this.args.denyInsecure;
      }

      if (!_lodash.default.isEmpty(this.args.allowInsecure)) {
        this.log.info('Explicitly enabling use of insecure features:');
        this.args.allowInsecure.map(a => this.log.info(`    ${a}`));
        driverInstance.allowInsecure = this.args.allowInsecure;
      }

      this.assignCliArgsToExtension('driver', driverName, driverInstance);
      driverInstance.server = this.server;
      driverInstance.serverHost = this.args.address;
      driverInstance.serverPort = this.args.port;
      driverInstance.serverPath = this.args.basePath;

      try {
        var _await$this$curSessio;

        runningDriversData = (_await$this$curSessio = await this.curSessionDataForDriver(InnerDriver)) !== null && _await$this$curSessio !== void 0 ? _await$this$curSessio : [];
      } catch (e) {
        throw new _baseDriver.errors.SessionNotCreatedError(e.message);
      }

      await pendingDriversGuard.acquire(AppiumDriver.name, () => {
        this.pendingDrivers[InnerDriver.name] = this.pendingDrivers[InnerDriver.name] || [];
        otherPendingDriversData = _lodash.default.compact(this.pendingDrivers[InnerDriver.name].map(drv => drv.driverData));
        this.pendingDrivers[InnerDriver.name].push(driverInstance);
      });

      try {
        [innerSessionId, dCaps] = await driverInstance.createSession(processedJsonwpCapabilities, reqCaps, processedW3CCapabilities, [...runningDriversData, ...otherPendingDriversData]);
        protocol = driverInstance.protocol;
        this.sessions[innerSessionId] = driverInstance;
      } finally {
        await pendingDriversGuard.acquire(AppiumDriver.name, () => {
          _lodash.default.pull(this.pendingDrivers[InnerDriver.name], driverInstance);
        });
      }

      this.attachUnexpectedShutdownHandler(driverInstance, innerSessionId);
      this.log.info(`New ${InnerDriver.name} session created successfully, session ` + `${innerSessionId} added to master session list`);
      driverInstance.startNewCommandTimeout();

      if (driverInstance.isW3CProtocol() && !_lodash.default.isEmpty(w3cSettings)) {
        this.log.info(`Applying the initial values to Appium settings parsed from W3C caps: ` + JSON.stringify(w3cSettings));
        await driverInstance.updateSettings(w3cSettings);
      } else if (driverInstance.isMjsonwpProtocol() && !_lodash.default.isEmpty(jwpSettings)) {
        this.log.info(`Applying the initial values to Appium settings parsed from MJSONWP caps: ` + JSON.stringify(jwpSettings));
        await driverInstance.updateSettings(jwpSettings);
      }
    } catch (error) {
      return {
        protocol,
        error
      };
    }

    return {
      protocol,
      value: [innerSessionId, dCaps, protocol]
    };
  }

  attachUnexpectedShutdownHandler(driver, innerSessionId) {
    const onShutdown = (cause = new Error('Unknown error')) => {
      this.log.warn(`Ending session, cause was '${cause.message}'`);

      if (this.sessionPlugins[innerSessionId]) {
        for (const plugin of this.sessionPlugins[innerSessionId]) {
          if (_lodash.default.isFunction(plugin.onUnexpectedShutdown)) {
            this.log.debug(`Plugin ${plugin.name} defines an unexpected shutdown handler; calling it now`);

            try {
              plugin.onUnexpectedShutdown(driver, cause);
            } catch (e) {
              this.log.warn(`Got an error when running plugin ${plugin.name} shutdown handler: ${e}`);
            }
          } else {
            this.log.debug(`Plugin ${plugin.name} does not define an unexpected shutdown handler`);
          }
        }
      }

      this.log.info(`Removing session '${innerSessionId}' from our master session list`);
      delete this.sessions[innerSessionId];
      delete this.sessionPlugins[innerSessionId];
    };

    if (_lodash.default.isFunction(driver.onUnexpectedShutdown)) {
      driver.onUnexpectedShutdown(onShutdown);
    } else {
      this.log.warn(`Failed to attach the unexpected shutdown listener. ` + `Is 'onUnexpectedShutdown' method available for '${driver.constructor.name}'?`);
    }
  }

  async curSessionDataForDriver(InnerDriver) {
    const data = _lodash.default.compact(_lodash.default.values(this.sessions).filter(s => s.constructor.name === InnerDriver.name).map(s => s.driverData));

    for (const datum of data) {
      if (!datum) {
        throw new Error(`Problem getting session data for driver type ` + `${InnerDriver.name}; does it implement 'get driverData'?`);
      }
    }

    return data;
  }

  async deleteSession(sessionId) {
    let protocol;

    try {
      let otherSessionsData;
      const dstSession = await sessionsListGuard.acquire(AppiumDriver.name, () => {
        if (!this.sessions[sessionId]) {
          return;
        }

        const curConstructorName = this.sessions[sessionId].constructor.name;
        otherSessionsData = _lodash.default.toPairs(this.sessions).filter(([key, value]) => value.constructor.name === curConstructorName && key !== sessionId).map(([, value]) => value.driverData);
        const dstSession = this.sessions[sessionId];
        protocol = dstSession.protocol;
        this.log.info(`Removing session ${sessionId} from our master session list`);
        delete this.sessions[sessionId];
        delete this.sessionPlugins[sessionId];
        return dstSession;
      });

      if (!dstSession) {
        throw new Error('Session not found');
      }

      return {
        protocol,
        value: await dstSession.deleteSession(sessionId, otherSessionsData)
      };
    } catch (e) {
      this.log.error(`Had trouble ending session ${sessionId}: ${e.message}`);
      return {
        protocol,
        error: e
      };
    }
  }

  async deleteAllSessions(opts = {}) {
    const sessionsCount = _lodash.default.size(this.sessions);

    if (0 === sessionsCount) {
      this.log.debug('There are no active sessions for cleanup');
      return;
    }

    const {
      force = false,
      reason
    } = opts;
    this.log.debug(`Cleaning up ${_support.util.pluralize('active session', sessionsCount, true)}`);
    const cleanupPromises = force ? _lodash.default.values(this.sessions).map(drv => drv.startUnexpectedShutdown(reason && new Error(reason))) : _lodash.default.keys(this.sessions).map(id => this.deleteSession(id));

    for (const cleanupPromise of cleanupPromises) {
      try {
        await cleanupPromise;
      } catch (e) {
        this.log.debug(e);
      }
    }
  }

  pluginsForSession(sessionId = null) {
    if (sessionId) {
      if (!this.sessionPlugins[sessionId]) {
        this.sessionPlugins[sessionId] = this.createPluginInstances();
      }

      return this.sessionPlugins[sessionId];
    }

    if (_lodash.default.isEmpty(this.sessionlessPlugins)) {
      this.sessionlessPlugins = this.createPluginInstances();
    }

    return this.sessionlessPlugins;
  }

  pluginsToHandleCmd(cmd, sessionId = null) {
    return this.pluginsForSession(sessionId).filter(p => _lodash.default.isFunction(p[cmd]) || _lodash.default.isFunction(p.handle));
  }

  createPluginInstances() {
    return this.pluginClasses.map(PluginClass => {
      const name = PluginClass.pluginName;
      const plugin = new PluginClass(name);
      this.assignCliArgsToExtension('plugin', name, plugin);
      return plugin;
    });
  }

  async executeCommand(cmd, ...args) {
    var _$last;

    const isGetStatus = cmd === _baseDriver.GET_STATUS_COMMAND;
    const isUmbrellaCmd = isAppiumDriverCommand(cmd);
    const isSessionCmd = (0, _baseDriver.isSessionCommand)(cmd);
    const reqForProxy = (_$last = _lodash.default.last(args)) === null || _$last === void 0 ? void 0 : _$last.reqForProxy;

    if (reqForProxy) {
      args.pop();
    }

    let sessionId = null;
    let dstSession = null;
    let protocol = null;
    let driver = this;

    if (isSessionCmd) {
      sessionId = _lodash.default.last(args);
      dstSession = this.sessions[sessionId];

      if (!dstSession) {
        throw new Error(`The session with id '${sessionId}' does not exist`);
      }

      protocol = dstSession.protocol;

      if (!isUmbrellaCmd) {
        driver = dstSession;
      }
    }

    const plugins = this.pluginsToHandleCmd(cmd, sessionId);
    const cmdHandledBy = {
      default: false
    };

    const defaultBehavior = async () => {
      plugins.length && this.log.info(`Executing default handling behavior for command '${cmd}'`);
      cmdHandledBy.default = true;

      if (reqForProxy) {
        if (!dstSession.proxyCommand) {
          throw new NoDriverProxyCommandError();
        }

        return await dstSession.proxyCommand(reqForProxy.originalUrl, reqForProxy.method, reqForProxy.body);
      }

      if (isGetStatus) {
        return await this.getStatus();
      }

      if (isUmbrellaCmd) {
        return await _baseDriver.BaseDriver.prototype.executeCommand.call(this, cmd, ...args);
      }

      return await dstSession.executeCommand(cmd, ...args);
    };

    const wrappedCmd = this.wrapCommandWithPlugins({
      driver,
      cmd,
      args,
      plugins,
      cmdHandledBy,
      next: defaultBehavior
    });
    const res = await this.executeWrappedCommand({
      wrappedCmd,
      protocol
    });
    this.logPluginHandlerReport(plugins, {
      cmd,
      cmdHandledBy
    });

    if (cmd === _baseDriver.CREATE_SESSION_COMMAND && this.sessionlessPlugins.length && !res.error) {
      const sessionId = _lodash.default.first(res.value);

      this.log.info(`Promoting ${this.sessionlessPlugins.length} sessionless plugins to be attached ` + `to session ID ${sessionId}`);
      this.sessionPlugins[sessionId] = this.sessionlessPlugins;
      this.sessionlessPlugins = [];
    }

    return res;
  }

  wrapCommandWithPlugins({
    driver,
    cmd,
    args,
    next,
    cmdHandledBy,
    plugins
  }) {
    plugins.length && this.log.info(`Plugins which can handle cmd '${cmd}': ${plugins.map(p => p.name)}`);

    for (const plugin of plugins) {
      cmdHandledBy[plugin.name] = false;

      next = (_next => async () => {
        this.log.info(`Plugin ${plugin.name} is now handling cmd '${cmd}'`);
        cmdHandledBy[plugin.name] = true;

        if (plugin[cmd]) {
          return await plugin[cmd](_next, driver, ...args);
        }

        return await plugin.handle(_next, driver, cmd, ...args);
      })(next);
    }

    return next;
  }

  logPluginHandlerReport(plugins, {
    cmd,
    cmdHandledBy
  }) {
    if (!plugins.length) {
      return;
    }

    const didHandle = Object.keys(cmdHandledBy).filter(k => cmdHandledBy[k]);
    const didntHandle = Object.keys(cmdHandledBy).filter(k => !cmdHandledBy[k]);

    if (didntHandle.length > 0) {
      this.log.info(`Command '${cmd}' was *not* handled by the following behaviours or plugins, even ` + `though they were registered to handle it: ${JSON.stringify(didntHandle)}. The ` + `command *was* handled by these: ${JSON.stringify(didHandle)}.`);
    }
  }

  async executeWrappedCommand({
    wrappedCmd,
    protocol
  }) {
    let cmdRes,
        cmdErr,
        res = {};

    try {
      cmdRes = await wrappedCmd();
    } catch (e) {
      cmdErr = e;
    }

    if (_lodash.default.isPlainObject(cmdRes) && _lodash.default.has(cmdRes, 'protocol')) {
      res = cmdRes;
    } else {
      res.value = cmdRes;
      res.error = cmdErr;
      res.protocol = protocol;
    }

    return res;
  }

  proxyActive(sessionId) {
    const dstSession = this.sessions[sessionId];
    return dstSession && _lodash.default.isFunction(dstSession.proxyActive) && dstSession.proxyActive(sessionId);
  }

  getProxyAvoidList(sessionId) {
    const dstSession = this.sessions[sessionId];
    return dstSession ? dstSession.getProxyAvoidList() : [];
  }

  canProxy(sessionId) {
    const dstSession = this.sessions[sessionId];
    return dstSession && dstSession.canProxy(sessionId);
  }

}

exports.AppiumDriver = AppiumDriver;

function isAppiumDriverCommand(cmd) {
  return !(0, _baseDriver.isSessionCommand)(cmd) || cmd === _baseDriver.DELETE_SESSION_COMMAND;
}

class NoDriverProxyCommandError extends Error {
  code = 'APPIUMERR_NO_DRIVER_PROXYCOMMAND';

  constructor() {
    super(`The default behavior for this command was to proxy, but the driver ` + `did not have the 'proxyCommand' method defined. To fully support ` + `plugins, drivers should have 'proxyCommand' set to a jwpProxy object's ` + `'command()' method, in addition to the normal 'proxyReqRes'`);
  }

}

exports.NoDriverProxyCommandError = NoDriverProxyCommandError;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9hcHBpdW0uanMiXSwibmFtZXMiOlsiZGVzaXJlZENhcGFiaWxpdHlDb25zdHJhaW50cyIsIk9iamVjdCIsImZyZWV6ZSIsImF1dG9tYXRpb25OYW1lIiwicHJlc2VuY2UiLCJpc1N0cmluZyIsInBsYXRmb3JtTmFtZSIsInNlc3Npb25zTGlzdEd1YXJkIiwiQXN5bmNMb2NrIiwicGVuZGluZ0RyaXZlcnNHdWFyZCIsIkFwcGl1bURyaXZlciIsIkRyaXZlckNvcmUiLCJzZXNzaW9ucyIsInBlbmRpbmdEcml2ZXJzIiwibmV3Q29tbWFuZFRpbWVvdXRNcyIsInBsdWdpbkNsYXNzZXMiLCJzZXNzaW9uUGx1Z2lucyIsInNlc3Npb25sZXNzUGx1Z2lucyIsImRyaXZlckNvbmZpZyIsInNlcnZlciIsImNvbnN0cnVjdG9yIiwib3B0cyIsInRtcERpciIsInByb2Nlc3MiLCJlbnYiLCJBUFBJVU1fVE1QX0RJUiIsImRlc2lyZWRDYXBDb25zdHJhaW50cyIsImFyZ3MiLCJjYXRjaCIsImVyciIsImxvZyIsImRlYnVnIiwiX2xvZyIsImluc3RhbmNlTmFtZSIsIm5hbWUiLCJub2RlIiwiZ2V0T2JqZWN0SWQiLCJzdWJzdHJpbmciLCJsb2dnZXIiLCJnZXRMb2dnZXIiLCJpc0NvbW1hbmRzUXVldWVFbmFibGVkIiwic2Vzc2lvbkV4aXN0cyIsInNlc3Npb25JZCIsImRzdFNlc3Npb24iLCJkcml2ZXJGb3JTZXNzaW9uIiwiZ2V0U3RhdHVzIiwiYnVpbGQiLCJfIiwiY2xvbmUiLCJnZXRTZXNzaW9ucyIsInRvUGFpcnMiLCJtYXAiLCJpZCIsImRyaXZlciIsImNhcGFiaWxpdGllcyIsImNhcHMiLCJwcmludE5ld1Nlc3Npb25Bbm5vdW5jZW1lbnQiLCJkcml2ZXJOYW1lIiwiZHJpdmVyVmVyc2lvbiIsImRyaXZlckJhc2VWZXJzaW9uIiwiaW5mbyIsIkFQUElVTV9WRVIiLCJiYXNlVmVyc2lvbiIsImFzc2lnbkNsaUFyZ3NUb0V4dGVuc2lvbiIsImV4dFR5cGUiLCJleHROYW1lIiwiZXh0SW5zdGFuY2UiLCJhbGxDbGlBcmdzRm9yRXh0IiwiaXNFbXB0eSIsImRlZmF1bHRzIiwiY2xpQXJncyIsIm9taXRCeSIsInZhbHVlIiwia2V5IiwiaXNFcXVhbCIsImNyZWF0ZVNlc3Npb24iLCJqc29ud3BDYXBzIiwicmVxQ2FwcyIsInczY0NhcGFiaWxpdGllcyIsImRyaXZlckRhdGEiLCJkZWZhdWx0Q2FwYWJpbGl0aWVzIiwiY2xvbmVEZWVwIiwiZGVmYXVsdFNldHRpbmdzIiwiandwU2V0dGluZ3MiLCJ3M2NTZXR0aW5ncyIsImFsd2F5c01hdGNoIiwiZmlyc3RNYXRjaEVudHJ5IiwiZmlyc3RNYXRjaCIsImFzc2lnbiIsInByb3RvY29sIiwiaW5uZXJTZXNzaW9uSWQiLCJkQ2FwcyIsInBhcnNlZENhcHMiLCJkZXNpcmVkQ2FwcyIsInByb2Nlc3NlZEpzb253cENhcGFiaWxpdGllcyIsInByb2Nlc3NlZFczQ0NhcGFiaWxpdGllcyIsImVycm9yIiwiSW5uZXJEcml2ZXIiLCJ2ZXJzaW9uIiwiZmluZE1hdGNoaW5nRHJpdmVyIiwic2Vzc2lvbk92ZXJyaWRlIiwiZGVsZXRlQWxsU2Vzc2lvbnMiLCJydW5uaW5nRHJpdmVyc0RhdGEiLCJvdGhlclBlbmRpbmdEcml2ZXJzRGF0YSIsImRyaXZlckluc3RhbmNlIiwicmVsYXhlZFNlY3VyaXR5RW5hYmxlZCIsImRlbnlJbnNlY3VyZSIsImEiLCJhbGxvd0luc2VjdXJlIiwic2VydmVySG9zdCIsImFkZHJlc3MiLCJzZXJ2ZXJQb3J0IiwicG9ydCIsInNlcnZlclBhdGgiLCJiYXNlUGF0aCIsImN1clNlc3Npb25EYXRhRm9yRHJpdmVyIiwiZSIsImVycm9ycyIsIlNlc3Npb25Ob3RDcmVhdGVkRXJyb3IiLCJtZXNzYWdlIiwiYWNxdWlyZSIsImNvbXBhY3QiLCJkcnYiLCJwdXNoIiwicHVsbCIsImF0dGFjaFVuZXhwZWN0ZWRTaHV0ZG93bkhhbmRsZXIiLCJzdGFydE5ld0NvbW1hbmRUaW1lb3V0IiwiaXNXM0NQcm90b2NvbCIsIkpTT04iLCJzdHJpbmdpZnkiLCJ1cGRhdGVTZXR0aW5ncyIsImlzTWpzb253cFByb3RvY29sIiwib25TaHV0ZG93biIsImNhdXNlIiwiRXJyb3IiLCJ3YXJuIiwicGx1Z2luIiwiaXNGdW5jdGlvbiIsIm9uVW5leHBlY3RlZFNodXRkb3duIiwiZGF0YSIsInZhbHVlcyIsImZpbHRlciIsInMiLCJkYXR1bSIsImRlbGV0ZVNlc3Npb24iLCJvdGhlclNlc3Npb25zRGF0YSIsImN1ckNvbnN0cnVjdG9yTmFtZSIsInNlc3Npb25zQ291bnQiLCJzaXplIiwiZm9yY2UiLCJyZWFzb24iLCJ1dGlsIiwicGx1cmFsaXplIiwiY2xlYW51cFByb21pc2VzIiwic3RhcnRVbmV4cGVjdGVkU2h1dGRvd24iLCJrZXlzIiwiY2xlYW51cFByb21pc2UiLCJwbHVnaW5zRm9yU2Vzc2lvbiIsImNyZWF0ZVBsdWdpbkluc3RhbmNlcyIsInBsdWdpbnNUb0hhbmRsZUNtZCIsImNtZCIsInAiLCJoYW5kbGUiLCJQbHVnaW5DbGFzcyIsInBsdWdpbk5hbWUiLCJleGVjdXRlQ29tbWFuZCIsImlzR2V0U3RhdHVzIiwiR0VUX1NUQVRVU19DT01NQU5EIiwiaXNVbWJyZWxsYUNtZCIsImlzQXBwaXVtRHJpdmVyQ29tbWFuZCIsImlzU2Vzc2lvbkNtZCIsInJlcUZvclByb3h5IiwibGFzdCIsInBvcCIsInBsdWdpbnMiLCJjbWRIYW5kbGVkQnkiLCJkZWZhdWx0IiwiZGVmYXVsdEJlaGF2aW9yIiwibGVuZ3RoIiwicHJveHlDb21tYW5kIiwiTm9Ecml2ZXJQcm94eUNvbW1hbmRFcnJvciIsIm9yaWdpbmFsVXJsIiwibWV0aG9kIiwiYm9keSIsIkJhc2VEcml2ZXIiLCJwcm90b3R5cGUiLCJjYWxsIiwid3JhcHBlZENtZCIsIndyYXBDb21tYW5kV2l0aFBsdWdpbnMiLCJuZXh0IiwicmVzIiwiZXhlY3V0ZVdyYXBwZWRDb21tYW5kIiwibG9nUGx1Z2luSGFuZGxlclJlcG9ydCIsIkNSRUFURV9TRVNTSU9OX0NPTU1BTkQiLCJmaXJzdCIsIl9uZXh0IiwiZGlkSGFuZGxlIiwiayIsImRpZG50SGFuZGxlIiwiY21kUmVzIiwiY21kRXJyIiwiaXNQbGFpbk9iamVjdCIsImhhcyIsInByb3h5QWN0aXZlIiwiZ2V0UHJveHlBdm9pZExpc3QiLCJjYW5Qcm94eSIsIkRFTEVURV9TRVNTSU9OX0NPTU1BTkQiLCJjb2RlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUNBOztBQUNBOztBQUNBOztBQUdBOztBQUNBOztBQUNBOztBQUNBOztBQU1BLE1BQU1BLDRCQUE0QixHQUFHQyxNQUFNLENBQUNDLE1BQVAsQ0FBYztBQUNqREMsRUFBQUEsY0FBYyxFQUFFO0FBQ2RDLElBQUFBLFFBQVEsRUFBRSxJQURJO0FBRWRDLElBQUFBLFFBQVEsRUFBRTtBQUZJLEdBRGlDO0FBS2pEQyxFQUFBQSxZQUFZLEVBQUU7QUFDWkYsSUFBQUEsUUFBUSxFQUFFLElBREU7QUFFWkMsSUFBQUEsUUFBUSxFQUFFO0FBRkU7QUFMbUMsQ0FBZCxDQUFyQztBQVdBLE1BQU1FLGlCQUFpQixHQUFHLElBQUlDLGtCQUFKLEVBQTFCO0FBQ0EsTUFBTUMsbUJBQW1CLEdBQUcsSUFBSUQsa0JBQUosRUFBNUI7O0FBS0EsTUFBTUUsWUFBTixTQUEyQkMsc0JBQTNCLENBQXNDO0FBT3BDQyxFQUFBQSxRQUFRLEdBQUcsRUFBSDtBQVFSQyxFQUFBQSxjQUFjLEdBQUcsRUFBSDtBQU9kQyxFQUFBQSxtQkFBbUIsR0FBRyxDQUFIO0FBTW5CQyxFQUFBQSxhQUFhLEdBQUcsRUFBSDtBQU1iQyxFQUFBQSxjQUFjLEdBQUcsRUFBSDtBQU1kQyxFQUFBQSxrQkFBa0IsR0FBRyxFQUFIO0FBR2xCQyxFQUFBQSxZQUFZO0FBR1pDLEVBQUFBLE1BQU07O0FBS05DLEVBQUFBLFdBQVcsQ0FBRUMsSUFBRixFQUFRO0FBS2pCLFFBQUlBLElBQUksQ0FBQ0MsTUFBVCxFQUFpQjtBQUNmQyxNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsY0FBWixHQUE2QkosSUFBSSxDQUFDQyxNQUFsQztBQUNEOztBQUVELFVBQU1ELElBQU47QUFFQSxTQUFLSyxxQkFBTCxHQUE2QjFCLDRCQUE3QjtBQUVBLFNBQUsyQixJQUFMLEdBQVksRUFBQyxHQUFHTjtBQUFKLEtBQVo7QUFLQSxtQ0FBa0JPLEtBQWxCLENBQXlCQyxHQUFELElBQVM7QUFDL0IsV0FBS0MsR0FBTCxDQUFTQyxLQUFULENBQWVGLEdBQWY7QUFDRCxLQUZEO0FBR0Q7O0FBS00sTUFBSEMsR0FBRyxHQUFJO0FBQ1QsUUFBSSxDQUFDLEtBQUtFLElBQVYsRUFBZ0I7QUFDZCxZQUFNQyxZQUFZLEdBQUksR0FBRSxLQUFLYixXQUFMLENBQWlCYyxJQUFLLElBQUdDLGNBQUtDLFdBQUwsQ0FBaUIsSUFBakIsRUFBdUJDLFNBQXZCLENBQWlDLENBQWpDLEVBQW9DLENBQXBDLENBQXVDLEVBQXhGO0FBQ0EsV0FBS0wsSUFBTCxHQUFZTSxnQkFBT0MsU0FBUCxDQUFpQk4sWUFBakIsQ0FBWjtBQUNEOztBQUNELFdBQU8sS0FBS0QsSUFBWjtBQUNEOztBQUt5QixNQUF0QlEsc0JBQXNCLEdBQUk7QUFDNUIsV0FBTyxLQUFQO0FBQ0Q7O0FBRURDLEVBQUFBLGFBQWEsQ0FBRUMsU0FBRixFQUFhO0FBQ3hCLFVBQU1DLFVBQVUsR0FBRyxLQUFLL0IsUUFBTCxDQUFjOEIsU0FBZCxDQUFuQjtBQUNBLFdBQU9DLFVBQVUsSUFBSUEsVUFBVSxDQUFDRCxTQUFYLEtBQXlCLElBQTlDO0FBQ0Q7O0FBRURFLEVBQUFBLGdCQUFnQixDQUFFRixTQUFGLEVBQWE7QUFDM0IsV0FBTyxLQUFLOUIsUUFBTCxDQUFjOEIsU0FBZCxDQUFQO0FBQ0Q7O0FBRWMsUUFBVEcsU0FBUyxHQUFJO0FBQ2pCLFdBQU87QUFDTEMsTUFBQUEsS0FBSyxFQUFFQyxnQkFBRUMsS0FBRixDQUFRLDJCQUFSO0FBREYsS0FBUDtBQUdEOztBQUVnQixRQUFYQyxXQUFXLEdBQUk7QUFDbkIsV0FBT0YsZ0JBQUVHLE9BQUYsQ0FBVSxLQUFLdEMsUUFBZixFQUNKdUMsR0FESSxDQUNBLENBQUMsQ0FBQ0MsRUFBRCxFQUFLQyxNQUFMLENBQUQsTUFBbUI7QUFBQ0QsTUFBQUEsRUFBRDtBQUFLRSxNQUFBQSxZQUFZLEVBQUVELE1BQU0sQ0FBQ0U7QUFBMUIsS0FBbkIsQ0FEQSxDQUFQO0FBRUQ7O0FBRURDLEVBQUFBLDJCQUEyQixDQUFFQyxVQUFGLEVBQWNDLGFBQWQsRUFBNkJDLGlCQUE3QixFQUFnRDtBQUN6RSxTQUFLN0IsR0FBTCxDQUFTOEIsSUFBVCxDQUFjRixhQUFhLEdBQ3RCLFdBQVVHLGtCQUFXLGlCQUFnQkosVUFBVyxNQUFLQyxhQUFjLFdBRDdDLEdBRXRCLFdBQVVHLGtCQUFXLGlCQUFnQkosVUFBVyxVQUZyRDtBQUlBLFNBQUszQixHQUFMLENBQVM4QixJQUFULENBQWUsK0NBQThDSCxVQUFXLEVBQXhFO0FBQ0EsU0FBSzNCLEdBQUwsQ0FBUzhCLElBQVQsQ0FBY2xELFlBQVksQ0FBQ29ELFdBQWIsR0FDVCxrQ0FBaUNwRCxZQUFZLENBQUNvRCxXQUFZLEVBRGpELEdBRVQsaURBRkw7QUFJQSxTQUFLaEMsR0FBTCxDQUFTOEIsSUFBVCxDQUFjRCxpQkFBaUIsR0FDMUIsR0FBRUYsVUFBVyw0QkFBMkJFLGlCQUFrQixFQURoQyxHQUUxQix1QkFBc0JGLFVBQVcsdUJBRnRDO0FBSUQ7O0FBWURNLEVBQUFBLHdCQUF3QixDQUFFQyxPQUFGLEVBQVdDLE9BQVgsRUFBb0JDLFdBQXBCLEVBQWlDO0FBQUE7O0FBQ3ZELFVBQU1DLGdCQUFnQix5QkFBbUQsS0FBS3hDLElBQUwsQ0FBVXFDLE9BQVYsQ0FBbkQsdURBQW1ELG1CQUFxQkMsT0FBckIsQ0FBekU7O0FBQ0EsUUFBSSxDQUFDbEIsZ0JBQUVxQixPQUFGLENBQVVELGdCQUFWLENBQUwsRUFBa0M7QUFDaEMsWUFBTUUsUUFBUSxHQUFHLHFDQUF3QkwsT0FBeEIsRUFBaUNDLE9BQWpDLENBQWpCO0FBQ0EsWUFBTUssT0FBTyxHQUFHdkIsZ0JBQUVxQixPQUFGLENBQVVDLFFBQVYsSUFDWkYsZ0JBRFksR0FFWnBCLGdCQUFFd0IsTUFBRixDQUFTSixnQkFBVCxFQUEyQixDQUFDSyxLQUFELEVBQVFDLEdBQVIsS0FBZ0IxQixnQkFBRTJCLE9BQUYsQ0FBVUwsUUFBUSxDQUFDSSxHQUFELENBQWxCLEVBQXlCRCxLQUF6QixDQUEzQyxDQUZKOztBQUdBLFVBQUksQ0FBQ3pCLGdCQUFFcUIsT0FBRixDQUFVRSxPQUFWLENBQUwsRUFBeUI7QUFDdkJKLFFBQUFBLFdBQVcsQ0FBQ0ksT0FBWixHQUFzQkEsT0FBdEI7QUFDRDtBQUNGO0FBQ0Y7O0FBU2tCLFFBQWJLLGFBQWEsQ0FBRUMsVUFBRixFQUFjQyxPQUFkLEVBQXVCQyxlQUF2QixFQUF3Q0MsVUFBeEMsRUFBb0Q7QUFBQTs7QUFDckUsVUFBTUMsbUJBQW1CLEdBQUdqQyxnQkFBRWtDLFNBQUYsQ0FBWSxLQUFLdEQsSUFBTCxDQUFVcUQsbUJBQXRCLENBQTVCOztBQUNBLFVBQU1FLGVBQWUsR0FBRyx5QkFBYUYsbUJBQWIsQ0FBeEI7QUFDQUosSUFBQUEsVUFBVSxHQUFHN0IsZ0JBQUVrQyxTQUFGLENBQVlMLFVBQVosQ0FBYjtBQUNBLFVBQU1PLFdBQVcsR0FBRyxFQUFDLEdBQUdELGVBQUo7QUFBcUIsU0FBRyx5QkFBYU4sVUFBYjtBQUF4QixLQUFwQjtBQUNBRSxJQUFBQSxlQUFlLEdBQUcvQixnQkFBRWtDLFNBQUYsQ0FBWUgsZUFBWixDQUFsQjtBQUtBLFVBQU1NLFdBQVcsR0FBRyxFQUNsQixHQUFHRCxXQURlO0FBRWxCLFNBQUcseUNBQWEscUJBQUNMLGVBQUQsK0RBQW9CLEVBQXBCLEVBQXdCTyxXQUFyQyx1REFBb0QsRUFBcEQ7QUFGZSxLQUFwQjs7QUFJQSxTQUFLLE1BQU1DLGVBQVgsbUJBQStCLHNCQUFDUixlQUFELGlFQUFvQixFQUFwQixFQUF3QlMsVUFBdkQscURBQXFFLEVBQXJFLEVBQTBFO0FBQUE7O0FBQ3hFdEYsTUFBQUEsTUFBTSxDQUFDdUYsTUFBUCxDQUFjSixXQUFkLEVBQTJCLHlCQUFhRSxlQUFiLENBQTNCO0FBQ0Q7O0FBRUQsUUFBSUcsUUFBSjtBQUNBLFFBQUlDLGNBQUosRUFBb0JDLEtBQXBCOztBQUNBLFFBQUk7QUFFRixZQUFNQyxVQUFVLEdBQUcsb0NBQ2pCaEIsVUFEaUIsRUFFakJFLGVBRmlCLEVBR2pCLEtBQUtwRCxxQkFIWSxFQUlqQnNELG1CQUppQixDQUFuQjtBQU9BLFlBQU07QUFBQ2EsUUFBQUEsV0FBRDtBQUFjQyxRQUFBQSwyQkFBZDtBQUEyQ0MsUUFBQUE7QUFBM0MsVUFBeUhILFVBQS9IO0FBQ0FILE1BQUFBLFFBQVEsR0FBR0csVUFBVSxDQUFDSCxRQUF0QjtBQUNBLFlBQU1PLEtBQUssR0FBZ0RKLFVBQUQsQ0FBYUksS0FBdkU7O0FBRUEsVUFBSUEsS0FBSixFQUFXO0FBQ1QsY0FBTUEsS0FBTjtBQUNEOztBQUVELFlBQU07QUFDSjNDLFFBQUFBLE1BQU0sRUFBRTRDLFdBREo7QUFFSkMsUUFBQUEsT0FBTyxFQUFFeEMsYUFGTDtBQUdKRCxRQUFBQTtBQUhJLFVBSUYsS0FBS3ZDLFlBQUwsQ0FBa0JpRixrQkFBbEIsQ0FBcUNOLFdBQXJDLENBSko7QUFLQSxXQUFLckMsMkJBQUwsQ0FBaUN5QyxXQUFXLENBQUMvRCxJQUE3QyxFQUFtRHdCLGFBQW5ELEVBQWtFdUMsV0FBVyxDQUFDbkMsV0FBOUU7O0FBRUEsVUFBSSxLQUFLbkMsSUFBTCxDQUFVeUUsZUFBZCxFQUErQjtBQUM3QixjQUFNLEtBQUtDLGlCQUFMLEVBQU47QUFDRDs7QUFLRCxVQUFJQyxrQkFBa0IsR0FBRyxFQUF6QjtBQUlBLFVBQUlDLHVCQUF1QixHQUFHLEVBQTlCO0FBRUEsWUFBTUMsY0FBYyxHQUFHLElBQUlQLFdBQUosQ0FBZ0IsS0FBS3RFLElBQXJCLEVBQTJCLElBQTNCLENBQXZCOztBQU1BLFVBQUksS0FBS0EsSUFBTCxDQUFVOEUsc0JBQWQsRUFBc0M7QUFDcEMsYUFBSzNFLEdBQUwsQ0FBUzhCLElBQVQsQ0FBZSxpQ0FBZ0NxQyxXQUFXLENBQUMvRCxJQUFLLFdBQWxELEdBQ1gsOERBRFcsR0FFWCx1REFGSDtBQUdBc0UsUUFBQUEsY0FBYyxDQUFDQyxzQkFBZixHQUF3QyxJQUF4QztBQUNEOztBQUVELFVBQUksQ0FBQzFELGdCQUFFcUIsT0FBRixDQUFVLEtBQUt6QyxJQUFMLENBQVUrRSxZQUFwQixDQUFMLEVBQXdDO0FBQ3RDLGFBQUs1RSxHQUFMLENBQVM4QixJQUFULENBQWMsaURBQWQ7QUFDQSxhQUFLakMsSUFBTCxDQUFVK0UsWUFBVixDQUF1QnZELEdBQXZCLENBQTRCd0QsQ0FBRCxJQUFPLEtBQUs3RSxHQUFMLENBQVM4QixJQUFULENBQWUsT0FBTStDLENBQUUsRUFBdkIsQ0FBbEM7QUFDQUgsUUFBQUEsY0FBYyxDQUFDRSxZQUFmLEdBQThCLEtBQUsvRSxJQUFMLENBQVUrRSxZQUF4QztBQUNEOztBQUVELFVBQUksQ0FBQzNELGdCQUFFcUIsT0FBRixDQUFVLEtBQUt6QyxJQUFMLENBQVVpRixhQUFwQixDQUFMLEVBQXlDO0FBQ3ZDLGFBQUs5RSxHQUFMLENBQVM4QixJQUFULENBQWMsK0NBQWQ7QUFDQSxhQUFLakMsSUFBTCxDQUFVaUYsYUFBVixDQUF3QnpELEdBQXhCLENBQTZCd0QsQ0FBRCxJQUFPLEtBQUs3RSxHQUFMLENBQVM4QixJQUFULENBQWUsT0FBTStDLENBQUUsRUFBdkIsQ0FBbkM7QUFDQUgsUUFBQUEsY0FBYyxDQUFDSSxhQUFmLEdBQStCLEtBQUtqRixJQUFMLENBQVVpRixhQUF6QztBQUNEOztBQUlELFdBQUs3Qyx3QkFBTCxDQUE4QixRQUE5QixFQUF3Q04sVUFBeEMsRUFBb0QrQyxjQUFwRDtBQU1BQSxNQUFBQSxjQUFjLENBQUNyRixNQUFmLEdBQXdCLEtBQUtBLE1BQTdCO0FBQ0FxRixNQUFBQSxjQUFjLENBQUNLLFVBQWYsR0FBNEIsS0FBS2xGLElBQUwsQ0FBVW1GLE9BQXRDO0FBQ0FOLE1BQUFBLGNBQWMsQ0FBQ08sVUFBZixHQUE0QixLQUFLcEYsSUFBTCxDQUFVcUYsSUFBdEM7QUFDQVIsTUFBQUEsY0FBYyxDQUFDUyxVQUFmLEdBQTRCLEtBQUt0RixJQUFMLENBQVV1RixRQUF0Qzs7QUFFQSxVQUFJO0FBQUE7O0FBQ0ZaLFFBQUFBLGtCQUFrQiw0QkFBRyxNQUFNLEtBQUthLHVCQUFMLENBQTZCbEIsV0FBN0IsQ0FBVCx5RUFBc0QsRUFBeEU7QUFDRCxPQUZELENBRUUsT0FBT21CLENBQVAsRUFBVTtBQUNWLGNBQU0sSUFBSUMsbUJBQU9DLHNCQUFYLENBQWtDRixDQUFDLENBQUNHLE9BQXBDLENBQU47QUFDRDs7QUFDRCxZQUFNOUcsbUJBQW1CLENBQUMrRyxPQUFwQixDQUE0QjlHLFlBQVksQ0FBQ3dCLElBQXpDLEVBQStDLE1BQU07QUFDekQsYUFBS3JCLGNBQUwsQ0FBb0JvRixXQUFXLENBQUMvRCxJQUFoQyxJQUF3QyxLQUFLckIsY0FBTCxDQUFvQm9GLFdBQVcsQ0FBQy9ELElBQWhDLEtBQXlDLEVBQWpGO0FBQ0FxRSxRQUFBQSx1QkFBdUIsR0FBR3hELGdCQUFFMEUsT0FBRixDQUFVLEtBQUs1RyxjQUFMLENBQW9Cb0YsV0FBVyxDQUFDL0QsSUFBaEMsRUFBc0NpQixHQUF0QyxDQUEyQ3VFLEdBQUQsSUFBU0EsR0FBRyxDQUFDM0MsVUFBdkQsQ0FBVixDQUExQjtBQUNBLGFBQUtsRSxjQUFMLENBQW9Cb0YsV0FBVyxDQUFDL0QsSUFBaEMsRUFBc0N5RixJQUF0QyxDQUEyQ25CLGNBQTNDO0FBQ0QsT0FKSyxDQUFOOztBQU1BLFVBQUk7QUFDRixTQUFDZCxjQUFELEVBQWlCQyxLQUFqQixJQUEwQixNQUFNYSxjQUFjLENBQUM3QixhQUFmLENBQzlCbUIsMkJBRDhCLEVBRTlCakIsT0FGOEIsRUFHOUJrQix3QkFIOEIsRUFJOUIsQ0FBQyxHQUFHTyxrQkFBSixFQUF3QixHQUFHQyx1QkFBM0IsQ0FKOEIsQ0FBaEM7QUFNQWQsUUFBQUEsUUFBUSxHQUFHZSxjQUFjLENBQUNmLFFBQTFCO0FBQ0EsYUFBSzdFLFFBQUwsQ0FBYzhFLGNBQWQsSUFBZ0NjLGNBQWhDO0FBQ0QsT0FURCxTQVNVO0FBQ1IsY0FBTS9GLG1CQUFtQixDQUFDK0csT0FBcEIsQ0FBNEI5RyxZQUFZLENBQUN3QixJQUF6QyxFQUErQyxNQUFNO0FBQ3pEYSwwQkFBRTZFLElBQUYsQ0FBTyxLQUFLL0csY0FBTCxDQUFvQm9GLFdBQVcsQ0FBQy9ELElBQWhDLENBQVAsRUFBOENzRSxjQUE5QztBQUNELFNBRkssQ0FBTjtBQUdEOztBQUVELFdBQUtxQiwrQkFBTCxDQUFxQ3JCLGNBQXJDLEVBQXFEZCxjQUFyRDtBQUVBLFdBQUs1RCxHQUFMLENBQVM4QixJQUFULENBQWUsT0FBTXFDLFdBQVcsQ0FBQy9ELElBQUsseUNBQXhCLEdBQ1gsR0FBRXdELGNBQWUsK0JBRHBCO0FBSUFjLE1BQUFBLGNBQWMsQ0FBQ3NCLHNCQUFmOztBQUdBLFVBQUl0QixjQUFjLENBQUN1QixhQUFmLE1BQWtDLENBQUNoRixnQkFBRXFCLE9BQUYsQ0FBVWdCLFdBQVYsQ0FBdkMsRUFBK0Q7QUFDN0QsYUFBS3RELEdBQUwsQ0FBUzhCLElBQVQsQ0FBZSx1RUFBRCxHQUNab0UsSUFBSSxDQUFDQyxTQUFMLENBQWU3QyxXQUFmLENBREY7QUFFQSxjQUFNb0IsY0FBYyxDQUFDMEIsY0FBZixDQUE4QjlDLFdBQTlCLENBQU47QUFDRCxPQUpELE1BSU8sSUFBSW9CLGNBQWMsQ0FBQzJCLGlCQUFmLE1BQXNDLENBQUNwRixnQkFBRXFCLE9BQUYsQ0FBVWUsV0FBVixDQUEzQyxFQUFtRTtBQUN4RSxhQUFLckQsR0FBTCxDQUFTOEIsSUFBVCxDQUFlLDJFQUFELEdBQ1pvRSxJQUFJLENBQUNDLFNBQUwsQ0FBZTlDLFdBQWYsQ0FERjtBQUVBLGNBQU1xQixjQUFjLENBQUMwQixjQUFmLENBQThCL0MsV0FBOUIsQ0FBTjtBQUNEO0FBQ0YsS0F2SEQsQ0F1SEUsT0FBT2EsS0FBUCxFQUFjO0FBQ2QsYUFBTztBQUNMUCxRQUFBQSxRQURLO0FBRUxPLFFBQUFBO0FBRkssT0FBUDtBQUlEOztBQUVELFdBQU87QUFDTFAsTUFBQUEsUUFESztBQUVMakIsTUFBQUEsS0FBSyxFQUFFLENBQUNrQixjQUFELEVBQWlCQyxLQUFqQixFQUF3QkYsUUFBeEI7QUFGRixLQUFQO0FBSUQ7O0FBRURvQyxFQUFBQSwrQkFBK0IsQ0FBRXhFLE1BQUYsRUFBVXFDLGNBQVYsRUFBMEI7QUFDdkQsVUFBTTBDLFVBQVUsR0FBRyxDQUFDQyxLQUFLLEdBQUcsSUFBSUMsS0FBSixDQUFVLGVBQVYsQ0FBVCxLQUF3QztBQUN6RCxXQUFLeEcsR0FBTCxDQUFTeUcsSUFBVCxDQUFlLDhCQUE2QkYsS0FBSyxDQUFDZCxPQUFRLEdBQTFEOztBQUVBLFVBQUksS0FBS3ZHLGNBQUwsQ0FBb0IwRSxjQUFwQixDQUFKLEVBQXlDO0FBQ3ZDLGFBQUssTUFBTThDLE1BQVgsSUFBcUIsS0FBS3hILGNBQUwsQ0FBb0IwRSxjQUFwQixDQUFyQixFQUEwRDtBQUN4RCxjQUFJM0MsZ0JBQUUwRixVQUFGLENBQWFELE1BQU0sQ0FBQ0Usb0JBQXBCLENBQUosRUFBK0M7QUFDN0MsaUJBQUs1RyxHQUFMLENBQVNDLEtBQVQsQ0FBZ0IsVUFBU3lHLE1BQU0sQ0FBQ3RHLElBQUsseURBQXJDOztBQUNBLGdCQUFJO0FBQ0ZzRyxjQUFBQSxNQUFNLENBQUNFLG9CQUFQLENBQTRCckYsTUFBNUIsRUFBb0NnRixLQUFwQztBQUNELGFBRkQsQ0FFRSxPQUFPakIsQ0FBUCxFQUFVO0FBQ1YsbUJBQUt0RixHQUFMLENBQVN5RyxJQUFULENBQWUsb0NBQW1DQyxNQUFNLENBQUN0RyxJQUFLLHNCQUFxQmtGLENBQUUsRUFBckY7QUFDRDtBQUNGLFdBUEQsTUFPTztBQUNMLGlCQUFLdEYsR0FBTCxDQUFTQyxLQUFULENBQWdCLFVBQVN5RyxNQUFNLENBQUN0RyxJQUFLLGlEQUFyQztBQUNEO0FBQ0Y7QUFDRjs7QUFFRCxXQUFLSixHQUFMLENBQVM4QixJQUFULENBQWUscUJBQW9COEIsY0FBZSxnQ0FBbEQ7QUFDQSxhQUFPLEtBQUs5RSxRQUFMLENBQWM4RSxjQUFkLENBQVA7QUFDQSxhQUFPLEtBQUsxRSxjQUFMLENBQW9CMEUsY0FBcEIsQ0FBUDtBQUNELEtBckJEOztBQXVCQSxRQUFJM0MsZ0JBQUUwRixVQUFGLENBQWFwRixNQUFNLENBQUNxRixvQkFBcEIsQ0FBSixFQUErQztBQUM3Q3JGLE1BQUFBLE1BQU0sQ0FBQ3FGLG9CQUFQLENBQTRCTixVQUE1QjtBQUNELEtBRkQsTUFFTztBQUNMLFdBQUt0RyxHQUFMLENBQVN5RyxJQUFULENBQWUscURBQUQsR0FDWCxtREFBa0RsRixNQUFNLENBQUNqQyxXQUFQLENBQW1CYyxJQUFLLElBRDdFO0FBRUQ7QUFDRjs7QUFPNEIsUUFBdkJpRix1QkFBdUIsQ0FBRWxCLFdBQUYsRUFBZTtBQUMxQyxVQUFNMEMsSUFBSSxHQUFHNUYsZ0JBQUUwRSxPQUFGLENBQVUxRSxnQkFBRTZGLE1BQUYsQ0FBUyxLQUFLaEksUUFBZCxFQUNwQmlJLE1BRG9CLENBQ1pDLENBQUQsSUFBT0EsQ0FBQyxDQUFDMUgsV0FBRixDQUFjYyxJQUFkLEtBQXVCK0QsV0FBVyxDQUFDL0QsSUFEN0IsRUFFcEJpQixHQUZvQixDQUVmMkYsQ0FBRCxJQUFPQSxDQUFDLENBQUMvRCxVQUZPLENBQVYsQ0FBYjs7QUFHQSxTQUFLLE1BQU1nRSxLQUFYLElBQW9CSixJQUFwQixFQUEwQjtBQUN4QixVQUFJLENBQUNJLEtBQUwsRUFBWTtBQUNWLGNBQU0sSUFBSVQsS0FBSixDQUFXLCtDQUFELEdBQ2IsR0FBRXJDLFdBQVcsQ0FBQy9ELElBQUssdUNBRGhCLENBQU47QUFFRDtBQUNGOztBQUNELFdBQU95RyxJQUFQO0FBQ0Q7O0FBS2tCLFFBQWJLLGFBQWEsQ0FBRXRHLFNBQUYsRUFBYTtBQUM5QixRQUFJK0MsUUFBSjs7QUFDQSxRQUFJO0FBQ0YsVUFBSXdELGlCQUFKO0FBQ0EsWUFBTXRHLFVBQVUsR0FBRyxNQUFNcEMsaUJBQWlCLENBQUNpSCxPQUFsQixDQUEwQjlHLFlBQVksQ0FBQ3dCLElBQXZDLEVBQTZDLE1BQU07QUFDMUUsWUFBSSxDQUFDLEtBQUt0QixRQUFMLENBQWM4QixTQUFkLENBQUwsRUFBK0I7QUFDN0I7QUFDRDs7QUFDRCxjQUFNd0csa0JBQWtCLEdBQUcsS0FBS3RJLFFBQUwsQ0FBYzhCLFNBQWQsRUFBeUJ0QixXQUF6QixDQUFxQ2MsSUFBaEU7QUFDQStHLFFBQUFBLGlCQUFpQixHQUFHbEcsZ0JBQUVHLE9BQUYsQ0FBVSxLQUFLdEMsUUFBZixFQUNiaUksTUFEYSxDQUNOLENBQUMsQ0FBQ3BFLEdBQUQsRUFBTUQsS0FBTixDQUFELEtBQWtCQSxLQUFLLENBQUNwRCxXQUFOLENBQWtCYyxJQUFsQixLQUEyQmdILGtCQUEzQixJQUFpRHpFLEdBQUcsS0FBSy9CLFNBRHJFLEVBRWJTLEdBRmEsQ0FFVCxDQUFDLEdBQUdxQixLQUFILENBQUQsS0FBZUEsS0FBSyxDQUFDTyxVQUZaLENBQXBCO0FBR0EsY0FBTXBDLFVBQVUsR0FBRyxLQUFLL0IsUUFBTCxDQUFjOEIsU0FBZCxDQUFuQjtBQUNBK0MsUUFBQUEsUUFBUSxHQUFHOUMsVUFBVSxDQUFDOEMsUUFBdEI7QUFDQSxhQUFLM0QsR0FBTCxDQUFTOEIsSUFBVCxDQUFlLG9CQUFtQmxCLFNBQVUsK0JBQTVDO0FBSUEsZUFBTyxLQUFLOUIsUUFBTCxDQUFjOEIsU0FBZCxDQUFQO0FBQ0EsZUFBTyxLQUFLMUIsY0FBTCxDQUFvQjBCLFNBQXBCLENBQVA7QUFDQSxlQUFPQyxVQUFQO0FBQ0QsT0FqQndCLENBQXpCOztBQW9CQSxVQUFJLENBQUNBLFVBQUwsRUFBaUI7QUFDZixjQUFNLElBQUkyRixLQUFKLENBQVUsbUJBQVYsQ0FBTjtBQUNEOztBQUNELGFBQU87QUFDTDdDLFFBQUFBLFFBREs7QUFFTGpCLFFBQUFBLEtBQUssRUFBRSxNQUFNN0IsVUFBVSxDQUFDcUcsYUFBWCxDQUF5QnRHLFNBQXpCLEVBQW9DdUcsaUJBQXBDO0FBRlIsT0FBUDtBQUlELEtBN0JELENBNkJFLE9BQU83QixDQUFQLEVBQVU7QUFDVixXQUFLdEYsR0FBTCxDQUFTa0UsS0FBVCxDQUFnQiw4QkFBNkJ0RCxTQUFVLEtBQUkwRSxDQUFDLENBQUNHLE9BQVEsRUFBckU7QUFDQSxhQUFPO0FBQ0w5QixRQUFBQSxRQURLO0FBRUxPLFFBQUFBLEtBQUssRUFBRW9CO0FBRkYsT0FBUDtBQUlEO0FBQ0Y7O0FBRXNCLFFBQWpCZixpQkFBaUIsQ0FBRWhGLElBQUksR0FBRyxFQUFULEVBQWE7QUFDbEMsVUFBTThILGFBQWEsR0FBR3BHLGdCQUFFcUcsSUFBRixDQUFPLEtBQUt4SSxRQUFaLENBQXRCOztBQUNBLFFBQUksTUFBTXVJLGFBQVYsRUFBeUI7QUFDdkIsV0FBS3JILEdBQUwsQ0FBU0MsS0FBVCxDQUFlLDBDQUFmO0FBQ0E7QUFDRDs7QUFFRCxVQUFNO0FBQ0pzSCxNQUFBQSxLQUFLLEdBQUcsS0FESjtBQUVKQyxNQUFBQTtBQUZJLFFBR0ZqSSxJQUhKO0FBSUEsU0FBS1MsR0FBTCxDQUFTQyxLQUFULENBQWdCLGVBQWN3SCxjQUFLQyxTQUFMLENBQWUsZ0JBQWYsRUFBaUNMLGFBQWpDLEVBQWdELElBQWhELENBQXNELEVBQXBGO0FBQ0EsVUFBTU0sZUFBZSxHQUFHSixLQUFLLEdBQ3pCdEcsZ0JBQUU2RixNQUFGLENBQVMsS0FBS2hJLFFBQWQsRUFBd0J1QyxHQUF4QixDQUE2QnVFLEdBQUQsSUFBU0EsR0FBRyxDQUFDZ0MsdUJBQUosQ0FBNEJKLE1BQU0sSUFBSSxJQUFJaEIsS0FBSixDQUFVZ0IsTUFBVixDQUF0QyxDQUFyQyxDQUR5QixHQUV6QnZHLGdCQUFFNEcsSUFBRixDQUFPLEtBQUsvSSxRQUFaLEVBQXNCdUMsR0FBdEIsQ0FBMkJDLEVBQUQsSUFBUSxLQUFLNEYsYUFBTCxDQUFtQjVGLEVBQW5CLENBQWxDLENBRko7O0FBR0EsU0FBSyxNQUFNd0csY0FBWCxJQUE2QkgsZUFBN0IsRUFBOEM7QUFDNUMsVUFBSTtBQUNGLGNBQU1HLGNBQU47QUFDRCxPQUZELENBRUUsT0FBT3hDLENBQVAsRUFBVTtBQUNWLGFBQUt0RixHQUFMLENBQVNDLEtBQVQsQ0FBZXFGLENBQWY7QUFDRDtBQUNGO0FBQ0Y7O0FBUUR5QyxFQUFBQSxpQkFBaUIsQ0FBRW5ILFNBQVMsR0FBRyxJQUFkLEVBQW9CO0FBQ25DLFFBQUlBLFNBQUosRUFBZTtBQUNiLFVBQUksQ0FBQyxLQUFLMUIsY0FBTCxDQUFvQjBCLFNBQXBCLENBQUwsRUFBcUM7QUFDbkMsYUFBSzFCLGNBQUwsQ0FBb0IwQixTQUFwQixJQUFpQyxLQUFLb0gscUJBQUwsRUFBakM7QUFDRDs7QUFDRCxhQUFPLEtBQUs5SSxjQUFMLENBQW9CMEIsU0FBcEIsQ0FBUDtBQUNEOztBQUVELFFBQUlLLGdCQUFFcUIsT0FBRixDQUFVLEtBQUtuRCxrQkFBZixDQUFKLEVBQXdDO0FBQ3RDLFdBQUtBLGtCQUFMLEdBQTBCLEtBQUs2SSxxQkFBTCxFQUExQjtBQUNEOztBQUNELFdBQU8sS0FBSzdJLGtCQUFaO0FBQ0Q7O0FBWUQ4SSxFQUFBQSxrQkFBa0IsQ0FBRUMsR0FBRixFQUFPdEgsU0FBUyxHQUFHLElBQW5CLEVBQXlCO0FBR3pDLFdBQU8sS0FBS21ILGlCQUFMLENBQXVCbkgsU0FBdkIsRUFDSm1HLE1BREksQ0FDSW9CLENBQUQsSUFBT2xILGdCQUFFMEYsVUFBRixDQUFhd0IsQ0FBQyxDQUFDRCxHQUFELENBQWQsS0FBd0JqSCxnQkFBRTBGLFVBQUYsQ0FBYXdCLENBQUMsQ0FBQ0MsTUFBZixDQURsQyxDQUFQO0FBRUQ7O0FBRURKLEVBQUFBLHFCQUFxQixHQUFJO0FBQ3ZCLFdBQU8sS0FBSy9JLGFBQUwsQ0FBbUJvQyxHQUFuQixDQUF3QmdILFdBQUQsSUFBaUI7QUFDN0MsWUFBTWpJLElBQUksR0FBR2lJLFdBQVcsQ0FBQ0MsVUFBekI7QUFDQSxZQUFNNUIsTUFBTSxHQUFHLElBQUkyQixXQUFKLENBQWdCakksSUFBaEIsQ0FBZjtBQUNBLFdBQUs2Qix3QkFBTCxDQUE4QixRQUE5QixFQUF3QzdCLElBQXhDLEVBQThDc0csTUFBOUM7QUFDQSxhQUFPQSxNQUFQO0FBQ0QsS0FMTSxDQUFQO0FBTUQ7O0FBUW1CLFFBQWQ2QixjQUFjLENBQUVMLEdBQUYsRUFBTyxHQUFHckksSUFBVixFQUFnQjtBQUFBOztBQVVsQyxVQUFNMkksV0FBVyxHQUFHTixHQUFHLEtBQUtPLDhCQUE1QjtBQUNBLFVBQU1DLGFBQWEsR0FBR0MscUJBQXFCLENBQUNULEdBQUQsQ0FBM0M7QUFDQSxVQUFNVSxZQUFZLEdBQUcsa0NBQWlCVixHQUFqQixDQUFyQjtBQUtBLFVBQU1XLFdBQVcsYUFBRzVILGdCQUFFNkgsSUFBRixDQUFPakosSUFBUCxDQUFILDJDQUFHLE9BQWNnSixXQUFsQzs7QUFDQSxRQUFJQSxXQUFKLEVBQWlCO0FBQ2ZoSixNQUFBQSxJQUFJLENBQUNrSixHQUFMO0FBQ0Q7O0FBS0QsUUFBSW5JLFNBQVMsR0FBRyxJQUFoQjtBQUNBLFFBQUlDLFVBQVUsR0FBRyxJQUFqQjtBQUNBLFFBQUk4QyxRQUFRLEdBQUcsSUFBZjtBQUVBLFFBQUlwQyxNQUFNLEdBQUcsSUFBYjs7QUFDQSxRQUFJcUgsWUFBSixFQUFrQjtBQUNoQmhJLE1BQUFBLFNBQVMsR0FBR0ssZ0JBQUU2SCxJQUFGLENBQU9qSixJQUFQLENBQVo7QUFDQWdCLE1BQUFBLFVBQVUsR0FBRyxLQUFLL0IsUUFBTCxDQUFjOEIsU0FBZCxDQUFiOztBQUNBLFVBQUksQ0FBQ0MsVUFBTCxFQUFpQjtBQUNmLGNBQU0sSUFBSTJGLEtBQUosQ0FBVyx3QkFBdUI1RixTQUFVLGtCQUE1QyxDQUFOO0FBQ0Q7O0FBRUQrQyxNQUFBQSxRQUFRLEdBQUc5QyxVQUFVLENBQUM4QyxRQUF0Qjs7QUFDQSxVQUFJLENBQUMrRSxhQUFMLEVBQW9CO0FBQ2xCbkgsUUFBQUEsTUFBTSxHQUFHVixVQUFUO0FBQ0Q7QUFDRjs7QUFHRCxVQUFNbUksT0FBTyxHQUFHLEtBQUtmLGtCQUFMLENBQXdCQyxHQUF4QixFQUE2QnRILFNBQTdCLENBQWhCO0FBUUEsVUFBTXFJLFlBQVksR0FBRztBQUFDQyxNQUFBQSxPQUFPLEVBQUU7QUFBVixLQUFyQjs7QUFNQSxVQUFNQyxlQUFlLEdBQUcsWUFBWTtBQUlsQ0gsTUFBQUEsT0FBTyxDQUFDSSxNQUFSLElBQWtCLEtBQUtwSixHQUFMLENBQVM4QixJQUFULENBQWUsb0RBQW1Eb0csR0FBSSxHQUF0RSxDQUFsQjtBQUdBZSxNQUFBQSxZQUFZLENBQUNDLE9BQWIsR0FBdUIsSUFBdkI7O0FBRUEsVUFBSUwsV0FBSixFQUFpQjtBQUtmLFlBQUksQ0FBQ2hJLFVBQVUsQ0FBQ3dJLFlBQWhCLEVBQThCO0FBQzVCLGdCQUFNLElBQUlDLHlCQUFKLEVBQU47QUFDRDs7QUFDRCxlQUFPLE1BQU16SSxVQUFVLENBQUN3SSxZQUFYLENBQXdCUixXQUFXLENBQUNVLFdBQXBDLEVBQWlEVixXQUFXLENBQUNXLE1BQTdELEVBQ1hYLFdBQVcsQ0FBQ1ksSUFERCxDQUFiO0FBRUQ7O0FBRUQsVUFBSWpCLFdBQUosRUFBaUI7QUFDZixlQUFPLE1BQU0sS0FBS3pILFNBQUwsRUFBYjtBQUNEOztBQUVELFVBQUkySCxhQUFKLEVBQW1CO0FBR2pCLGVBQU8sTUFBTWdCLHVCQUFXQyxTQUFYLENBQXFCcEIsY0FBckIsQ0FBb0NxQixJQUFwQyxDQUF5QyxJQUF6QyxFQUErQzFCLEdBQS9DLEVBQW9ELEdBQUdySSxJQUF2RCxDQUFiO0FBQ0Q7O0FBR0QsYUFBTyxNQUFNZ0IsVUFBVSxDQUFDMEgsY0FBWCxDQUEwQkwsR0FBMUIsRUFBK0IsR0FBR3JJLElBQWxDLENBQWI7QUFDRCxLQWpDRDs7QUFvQ0EsVUFBTWdLLFVBQVUsR0FBRyxLQUFLQyxzQkFBTCxDQUE0QjtBQUM3Q3ZJLE1BQUFBLE1BRDZDO0FBQ3JDMkcsTUFBQUEsR0FEcUM7QUFDaENySSxNQUFBQSxJQURnQztBQUMxQm1KLE1BQUFBLE9BRDBCO0FBQ2pCQyxNQUFBQSxZQURpQjtBQUNIYyxNQUFBQSxJQUFJLEVBQUVaO0FBREgsS0FBNUIsQ0FBbkI7QUFHQSxVQUFNYSxHQUFHLEdBQUcsTUFBTSxLQUFLQyxxQkFBTCxDQUEyQjtBQUFDSixNQUFBQSxVQUFEO0FBQWFsRyxNQUFBQTtBQUFiLEtBQTNCLENBQWxCO0FBSUEsU0FBS3VHLHNCQUFMLENBQTRCbEIsT0FBNUIsRUFBcUM7QUFBQ2QsTUFBQUEsR0FBRDtBQUFNZSxNQUFBQTtBQUFOLEtBQXJDOztBQUtBLFFBQUlmLEdBQUcsS0FBS2lDLGtDQUFSLElBQWtDLEtBQUtoTCxrQkFBTCxDQUF3QmlLLE1BQTFELElBQW9FLENBQUNZLEdBQUcsQ0FBQzlGLEtBQTdFLEVBQW9GO0FBQ2xGLFlBQU10RCxTQUFTLEdBQUdLLGdCQUFFbUosS0FBRixDQUFRSixHQUFHLENBQUN0SCxLQUFaLENBQWxCOztBQUNBLFdBQUsxQyxHQUFMLENBQVM4QixJQUFULENBQWUsYUFBWSxLQUFLM0Msa0JBQUwsQ0FBd0JpSyxNQUFPLHNDQUE1QyxHQUNYLGlCQUFnQnhJLFNBQVUsRUFEN0I7QUFFQSxXQUFLMUIsY0FBTCxDQUFvQjBCLFNBQXBCLElBQWlDLEtBQUt6QixrQkFBdEM7QUFDQSxXQUFLQSxrQkFBTCxHQUEwQixFQUExQjtBQUNEOztBQUVELFdBQU82SyxHQUFQO0FBQ0Q7O0FBRURGLEVBQUFBLHNCQUFzQixDQUFFO0FBQUN2SSxJQUFBQSxNQUFEO0FBQVMyRyxJQUFBQSxHQUFUO0FBQWNySSxJQUFBQSxJQUFkO0FBQW9Ca0ssSUFBQUEsSUFBcEI7QUFBMEJkLElBQUFBLFlBQTFCO0FBQXdDRCxJQUFBQTtBQUF4QyxHQUFGLEVBQW9EO0FBQ3hFQSxJQUFBQSxPQUFPLENBQUNJLE1BQVIsSUFBa0IsS0FBS3BKLEdBQUwsQ0FBUzhCLElBQVQsQ0FBZSxpQ0FBZ0NvRyxHQUFJLE1BQUtjLE9BQU8sQ0FBQzNILEdBQVIsQ0FBYThHLENBQUQsSUFBT0EsQ0FBQyxDQUFDL0gsSUFBckIsQ0FBMkIsRUFBbkYsQ0FBbEI7O0FBSUEsU0FBSyxNQUFNc0csTUFBWCxJQUFxQnNDLE9BQXJCLEVBQThCO0FBSTVCQyxNQUFBQSxZQUFZLENBQUN2QyxNQUFNLENBQUN0RyxJQUFSLENBQVosR0FBNEIsS0FBNUI7O0FBQ0EySixNQUFBQSxJQUFJLEdBQUcsQ0FBRU0sS0FBRCxJQUFXLFlBQVk7QUFDN0IsYUFBS3JLLEdBQUwsQ0FBUzhCLElBQVQsQ0FBZSxVQUFTNEUsTUFBTSxDQUFDdEcsSUFBSyx5QkFBd0I4SCxHQUFJLEdBQWhFO0FBQ0FlLFFBQUFBLFlBQVksQ0FBQ3ZDLE1BQU0sQ0FBQ3RHLElBQVIsQ0FBWixHQUE0QixJQUE1Qjs7QUFFQSxZQUFJc0csTUFBTSxDQUFDd0IsR0FBRCxDQUFWLEVBQWlCO0FBQ2YsaUJBQU8sTUFBTXhCLE1BQU0sQ0FBQ3dCLEdBQUQsQ0FBTixDQUFZbUMsS0FBWixFQUFtQjlJLE1BQW5CLEVBQTJCLEdBQUcxQixJQUE5QixDQUFiO0FBQ0Q7O0FBRUQsZUFBTyxNQUFNNkcsTUFBTSxDQUFDMEIsTUFBUCxDQUFjaUMsS0FBZCxFQUFxQjlJLE1BQXJCLEVBQTZCMkcsR0FBN0IsRUFBa0MsR0FBR3JJLElBQXJDLENBQWI7QUFDRCxPQVRNLEVBU0prSyxJQVRJLENBQVA7QUFVRDs7QUFFRCxXQUFPQSxJQUFQO0FBQ0Q7O0FBRURHLEVBQUFBLHNCQUFzQixDQUFFbEIsT0FBRixFQUFXO0FBQUNkLElBQUFBLEdBQUQ7QUFBTWUsSUFBQUE7QUFBTixHQUFYLEVBQWdDO0FBQ3BELFFBQUksQ0FBQ0QsT0FBTyxDQUFDSSxNQUFiLEVBQXFCO0FBQ25CO0FBQ0Q7O0FBUUQsVUFBTWtCLFNBQVMsR0FBR25NLE1BQU0sQ0FBQzBKLElBQVAsQ0FBWW9CLFlBQVosRUFBMEJsQyxNQUExQixDQUFrQ3dELENBQUQsSUFBT3RCLFlBQVksQ0FBQ3NCLENBQUQsQ0FBcEQsQ0FBbEI7QUFDQSxVQUFNQyxXQUFXLEdBQUdyTSxNQUFNLENBQUMwSixJQUFQLENBQVlvQixZQUFaLEVBQTBCbEMsTUFBMUIsQ0FBa0N3RCxDQUFELElBQU8sQ0FBQ3RCLFlBQVksQ0FBQ3NCLENBQUQsQ0FBckQsQ0FBcEI7O0FBQ0EsUUFBSUMsV0FBVyxDQUFDcEIsTUFBWixHQUFxQixDQUF6QixFQUE0QjtBQUMxQixXQUFLcEosR0FBTCxDQUFTOEIsSUFBVCxDQUFlLFlBQVdvRyxHQUFJLG1FQUFoQixHQUNYLDZDQUE0Q2hDLElBQUksQ0FBQ0MsU0FBTCxDQUFlcUUsV0FBZixDQUE0QixRQUQ3RCxHQUVYLG1DQUFrQ3RFLElBQUksQ0FBQ0MsU0FBTCxDQUFlbUUsU0FBZixDQUEwQixHQUYvRDtBQUdEO0FBQ0Y7O0FBRTBCLFFBQXJCTCxxQkFBcUIsQ0FBRTtBQUFDSixJQUFBQSxVQUFEO0FBQWFsRyxJQUFBQTtBQUFiLEdBQUYsRUFBMEI7QUFDbkQsUUFBSThHLE1BQUo7QUFBQSxRQUFZQyxNQUFaO0FBQUEsUUFBb0JWLEdBQUcsR0FBRyxFQUExQjs7QUFDQSxRQUFJO0FBSUZTLE1BQUFBLE1BQU0sR0FBRyxNQUFNWixVQUFVLEVBQXpCO0FBQ0QsS0FMRCxDQUtFLE9BQU92RSxDQUFQLEVBQVU7QUFDVm9GLE1BQUFBLE1BQU0sR0FBR3BGLENBQVQ7QUFDRDs7QUFLRCxRQUFJckUsZ0JBQUUwSixhQUFGLENBQWdCRixNQUFoQixLQUEyQnhKLGdCQUFFMkosR0FBRixDQUFNSCxNQUFOLEVBQWMsVUFBZCxDQUEvQixFQUEwRDtBQUN4RFQsTUFBQUEsR0FBRyxHQUFHUyxNQUFOO0FBQ0QsS0FGRCxNQUVPO0FBQ0xULE1BQUFBLEdBQUcsQ0FBQ3RILEtBQUosR0FBWStILE1BQVo7QUFDQVQsTUFBQUEsR0FBRyxDQUFDOUYsS0FBSixHQUFZd0csTUFBWjtBQUNBVixNQUFBQSxHQUFHLENBQUNyRyxRQUFKLEdBQWVBLFFBQWY7QUFDRDs7QUFDRCxXQUFPcUcsR0FBUDtBQUNEOztBQUVEYSxFQUFBQSxXQUFXLENBQUVqSyxTQUFGLEVBQWE7QUFDdEIsVUFBTUMsVUFBVSxHQUFHLEtBQUsvQixRQUFMLENBQWM4QixTQUFkLENBQW5CO0FBQ0EsV0FBT0MsVUFBVSxJQUFJSSxnQkFBRTBGLFVBQUYsQ0FBYTlGLFVBQVUsQ0FBQ2dLLFdBQXhCLENBQWQsSUFBc0RoSyxVQUFVLENBQUNnSyxXQUFYLENBQXVCakssU0FBdkIsQ0FBN0Q7QUFDRDs7QUFFRGtLLEVBQUFBLGlCQUFpQixDQUFFbEssU0FBRixFQUFhO0FBQzVCLFVBQU1DLFVBQVUsR0FBRyxLQUFLL0IsUUFBTCxDQUFjOEIsU0FBZCxDQUFuQjtBQUNBLFdBQU9DLFVBQVUsR0FBR0EsVUFBVSxDQUFDaUssaUJBQVgsRUFBSCxHQUFvQyxFQUFyRDtBQUNEOztBQUVEQyxFQUFBQSxRQUFRLENBQUVuSyxTQUFGLEVBQWE7QUFDbkIsVUFBTUMsVUFBVSxHQUFHLEtBQUsvQixRQUFMLENBQWM4QixTQUFkLENBQW5CO0FBQ0EsV0FBT0MsVUFBVSxJQUFJQSxVQUFVLENBQUNrSyxRQUFYLENBQW9CbkssU0FBcEIsQ0FBckI7QUFDRDs7QUF0cUJtQzs7OztBQTJxQnRDLFNBQVMrSCxxQkFBVCxDQUFnQ1QsR0FBaEMsRUFBcUM7QUFDbkMsU0FBTyxDQUFDLGtDQUFpQkEsR0FBakIsQ0FBRCxJQUEwQkEsR0FBRyxLQUFLOEMsa0NBQXpDO0FBQ0Q7O0FBTU0sTUFBTTFCLHlCQUFOLFNBQXdDOUMsS0FBeEMsQ0FBOEM7QUFJbkR5RSxFQUFBQSxJQUFJLEdBQUcsa0NBQUg7O0FBRUozTCxFQUFBQSxXQUFXLEdBQUk7QUFDYixVQUFPLHFFQUFELEdBQ0MsbUVBREQsR0FFQyx5RUFGRCxHQUdDLDZEQUhQO0FBSUQ7O0FBWGtEIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi9cbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBnZXRCdWlsZEluZm8sIHVwZGF0ZUJ1aWxkSW5mbywgQVBQSVVNX1ZFUiB9IGZyb20gJy4vY29uZmlnJztcbmltcG9ydCB7IEJhc2VEcml2ZXIsIERyaXZlckNvcmUsIGVycm9ycywgaXNTZXNzaW9uQ29tbWFuZCxcbiAgICAgICAgIENSRUFURV9TRVNTSU9OX0NPTU1BTkQsIERFTEVURV9TRVNTSU9OX0NPTU1BTkQsIEdFVF9TVEFUVVNfQ09NTUFORFxufSBmcm9tICdAYXBwaXVtL2Jhc2UtZHJpdmVyJztcbmltcG9ydCBBc3luY0xvY2sgZnJvbSAnYXN5bmMtbG9jayc7XG5pbXBvcnQgeyBwYXJzZUNhcHNGb3JJbm5lckRyaXZlciwgcHVsbFNldHRpbmdzIH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgeyB1dGlsLCBub2RlLCBsb2dnZXIgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IHsgZ2V0RGVmYXVsdHNGb3JFeHRlbnNpb24gfSBmcm9tICcuL3NjaGVtYSc7XG5cbi8qKlxuICogSW52YXJpYW50IHNldCBvZiBiYXNlIGNvbnN0cmFpbnRzXG4gKiBAdHlwZSB7UmVhZG9ubHk8Q29uc3RyYWludHM+fVxuICovXG5jb25zdCBkZXNpcmVkQ2FwYWJpbGl0eUNvbnN0cmFpbnRzID0gT2JqZWN0LmZyZWV6ZSh7XG4gIGF1dG9tYXRpb25OYW1lOiB7XG4gICAgcHJlc2VuY2U6IHRydWUsXG4gICAgaXNTdHJpbmc6IHRydWUsXG4gIH0sXG4gIHBsYXRmb3JtTmFtZToge1xuICAgIHByZXNlbmNlOiB0cnVlLFxuICAgIGlzU3RyaW5nOiB0cnVlLFxuICB9LFxufSk7XG5cbmNvbnN0IHNlc3Npb25zTGlzdEd1YXJkID0gbmV3IEFzeW5jTG9jaygpO1xuY29uc3QgcGVuZGluZ0RyaXZlcnNHdWFyZCA9IG5ldyBBc3luY0xvY2soKTtcblxuLyoqXG4gKiBAaW1wbGVtZW50cyB7U2Vzc2lvbkhhbmRsZXJ9XG4gKi9cbmNsYXNzIEFwcGl1bURyaXZlciBleHRlbmRzIERyaXZlckNvcmUge1xuICAvKipcbiAgICogQWNjZXNzIHRvIHNlc3Npb25zIGxpc3QgbXVzdCBiZSBndWFyZGVkIHdpdGggYSBTZW1hcGhvcmUsIGJlY2F1c2VcbiAgICogaXQgbWlnaHQgYmUgY2hhbmdlZCBieSBvdGhlciBhc3luYyBjYWxscyBhdCBhbnkgdGltZVxuICAgKiBJdCBpcyBub3QgcmVjb21tZW5kZWQgdG8gYWNjZXNzIHRoaXMgcHJvcGVydHkgZGlyZWN0bHkgZnJvbSB0aGUgb3V0c2lkZVxuICAgKiBAdHlwZSB7UmVjb3JkPHN0cmluZyxFeHRlcm5hbERyaXZlcj59XG4gICAqL1xuICBzZXNzaW9ucyA9IHt9O1xuXG4gIC8qKlxuICAgKiBBY2Nlc3MgdG8gcGVuZGluZyBkcml2ZXJzIGxpc3QgbXVzdCBiZSBndWFyZGVkIHdpdGggYSBTZW1hcGhvcmUsIGJlY2F1c2VcbiAgICogaXQgbWlnaHQgYmUgY2hhbmdlZCBieSBvdGhlciBhc3luYyBjYWxscyBhdCBhbnkgdGltZVxuICAgKiBJdCBpcyBub3QgcmVjb21tZW5kZWQgdG8gYWNjZXNzIHRoaXMgcHJvcGVydHkgZGlyZWN0bHkgZnJvbSB0aGUgb3V0c2lkZVxuICAgKiBAdHlwZSB7UmVjb3JkPHN0cmluZyxFeHRlcm5hbERyaXZlcltdPn1cbiAgICovXG4gIHBlbmRpbmdEcml2ZXJzID0ge307XG5cbiAgLyoqXG4gICAqIE5vdGUgdGhhdCB7QGxpbmtjb2RlIEFwcGl1bURyaXZlcn0gaGFzIG5vIGBuZXdDb21tYW5kVGltZW91dGAgbWV0aG9kLlxuICAgKiBgQXBwaXVtRHJpdmVyYCBkb2VzIG5vdCBzZXQgYW5kIG9ic2VydmUgaXRzIG93biB0aW1lb3V0czsgaW5kaXZpZHVhbFxuICAgKiBzZXNzaW9ucyAobWFuYWdlZCBkcml2ZXJzKSBkbyBpbnN0ZWFkLlxuICAgKi9cbiAgbmV3Q29tbWFuZFRpbWVvdXRNcyA9IDA7XG5cbiAgLyoqXG4gICAqIExpc3Qgb2YgYWN0aXZlIHBsdWdpbnNcbiAgICogQHR5cGUge1BsdWdpbkNsYXNzW119XG4gICAqL1xuICBwbHVnaW5DbGFzc2VzID0gW107XG5cbiAgLyoqXG4gICAqIG1hcCBvZiBzZXNzaW9ucyB0byBhY3R1YWwgcGx1Z2luIGluc3RhbmNlcyBwZXIgc2Vzc2lvblxuICAgKiBAdHlwZSB7UmVjb3JkPHN0cmluZyxJbnN0YW5jZVR5cGU8UGx1Z2luQ2xhc3M+W10+fVxuICAgKi9cbiAgc2Vzc2lvblBsdWdpbnMgPSB7fTtcblxuICAvKipcbiAgICogc29tZSBjb21tYW5kcyBhcmUgc2Vzc2lvbmxlc3MsIHNvIHdlIG5lZWQgYSBzZXQgb2YgcGx1Z2lucyBmb3IgdGhlbVxuICAgKiBAdHlwZSB7SW5zdGFuY2VUeXBlPFBsdWdpbkNsYXNzPltdfVxuICAgKi9cbiAgc2Vzc2lvbmxlc3NQbHVnaW5zID0gW107O1xuXG4gIC8qKiBAdHlwZSB7RHJpdmVyQ29uZmlnfSAqL1xuICBkcml2ZXJDb25maWc7XG5cbiAgLyoqIEB0eXBlIHtBcHBpdW1TZXJ2ZXJ9ICovXG4gIHNlcnZlcjtcblxuICAvKipcbiAgICogQHBhcmFtIHtEcml2ZXJPcHRzfSBvcHRzXG4gICAqL1xuICBjb25zdHJ1Y3RvciAob3B0cykge1xuICAgIC8vIEl0IGlzIG5lY2Vzc2FyeSB0byBzZXQgYC0tdG1wYCBoZXJlIHNpbmNlIGl0IHNob3VsZCBiZSBzZXQgdG9cbiAgICAvLyBwcm9jZXNzLmVudi5BUFBJVU1fVE1QX0RJUiBvbmNlIGF0IGFuIGluaXRpYWwgcG9pbnQgaW4gdGhlIEFwcGl1bSBsaWZlY3ljbGUuXG4gICAgLy8gVGhlIHByb2Nlc3MgYXJndW1lbnQgd2lsbCBiZSByZWZlcmVuY2VkIGJ5IEJhc2VEcml2ZXIuXG4gICAgLy8gUGxlYXNlIGNhbGwgQGFwcGl1bS9zdXBwb3J0LnRlbXBEaXIgbW9kdWxlIHRvIGFwcGx5IHRoaXMgYmVuZWZpdC5cbiAgICBpZiAob3B0cy50bXBEaXIpIHtcbiAgICAgIHByb2Nlc3MuZW52LkFQUElVTV9UTVBfRElSID0gb3B0cy50bXBEaXI7XG4gICAgfVxuXG4gICAgc3VwZXIob3B0cyk7XG5cbiAgICB0aGlzLmRlc2lyZWRDYXBDb25zdHJhaW50cyA9IGRlc2lyZWRDYXBhYmlsaXR5Q29uc3RyYWludHM7XG5cbiAgICB0aGlzLmFyZ3MgPSB7Li4ub3B0c307XG5cbiAgICAvLyBhbGxvdyB0aGlzIHRvIGhhcHBlbiBpbiB0aGUgYmFja2dyb3VuZCwgc28gbm8gYGF3YWl0YFxuICAgIC8vIGNhdGNoIHRoaXMgdG8gYXZvaWQgYW4gdW5oYW5kbGVkIHJlamVjdGlvblxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcm9taXNlL3ByZWZlci1hd2FpdC10by10aGVuLHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLWNhbGxiYWNrc1xuICAgIHVwZGF0ZUJ1aWxkSW5mbygpLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIHRoaXMubG9nLmRlYnVnKGVycik7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIGxvZ2dlciBpbnN0YW5jZSBmb3IgdGhlIGN1cnJlbnQgdW1icmVsbGEgZHJpdmVyIGluc3RhbmNlXG4gICAqL1xuICBnZXQgbG9nICgpIHtcbiAgICBpZiAoIXRoaXMuX2xvZykge1xuICAgICAgY29uc3QgaW5zdGFuY2VOYW1lID0gYCR7dGhpcy5jb25zdHJ1Y3Rvci5uYW1lfUAke25vZGUuZ2V0T2JqZWN0SWQodGhpcykuc3Vic3RyaW5nKDAsIDQpfWA7XG4gICAgICB0aGlzLl9sb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKGluc3RhbmNlTmFtZSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9sb2c7XG4gIH1cblxuICAvKipcbiAgICogQ2FuY2VsIGNvbW1hbmRzIHF1ZXVlaW5nIGZvciB0aGUgdW1icmVsbGEgQXBwaXVtIGRyaXZlclxuICAgKi9cbiAgZ2V0IGlzQ29tbWFuZHNRdWV1ZUVuYWJsZWQgKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHNlc3Npb25FeGlzdHMgKHNlc3Npb25JZCkge1xuICAgIGNvbnN0IGRzdFNlc3Npb24gPSB0aGlzLnNlc3Npb25zW3Nlc3Npb25JZF07XG4gICAgcmV0dXJuIGRzdFNlc3Npb24gJiYgZHN0U2Vzc2lvbi5zZXNzaW9uSWQgIT09IG51bGw7XG4gIH1cblxuICBkcml2ZXJGb3JTZXNzaW9uIChzZXNzaW9uSWQpIHtcbiAgICByZXR1cm4gdGhpcy5zZXNzaW9uc1tzZXNzaW9uSWRdO1xuICB9XG5cbiAgYXN5bmMgZ2V0U3RhdHVzICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgcmV0dXJuIHtcbiAgICAgIGJ1aWxkOiBfLmNsb25lKGdldEJ1aWxkSW5mbygpKSxcbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgZ2V0U2Vzc2lvbnMgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICByZXR1cm4gXy50b1BhaXJzKHRoaXMuc2Vzc2lvbnMpXG4gICAgICAubWFwKChbaWQsIGRyaXZlcl0pID0+ICh7aWQsIGNhcGFiaWxpdGllczogZHJpdmVyLmNhcHN9KSk7XG4gIH1cblxuICBwcmludE5ld1Nlc3Npb25Bbm5vdW5jZW1lbnQgKGRyaXZlck5hbWUsIGRyaXZlclZlcnNpb24sIGRyaXZlckJhc2VWZXJzaW9uKSB7XG4gICAgdGhpcy5sb2cuaW5mbyhkcml2ZXJWZXJzaW9uXG4gICAgICA/IGBBcHBpdW0gdiR7QVBQSVVNX1ZFUn0gY3JlYXRpbmcgbmV3ICR7ZHJpdmVyTmFtZX0gKHYke2RyaXZlclZlcnNpb259KSBzZXNzaW9uYFxuICAgICAgOiBgQXBwaXVtIHYke0FQUElVTV9WRVJ9IGNyZWF0aW5nIG5ldyAke2RyaXZlck5hbWV9IHNlc3Npb25gXG4gICAgKTtcbiAgICB0aGlzLmxvZy5pbmZvKGBDaGVja2luZyBCYXNlRHJpdmVyIHZlcnNpb25zIGZvciBBcHBpdW0gYW5kICR7ZHJpdmVyTmFtZX1gKTtcbiAgICB0aGlzLmxvZy5pbmZvKEFwcGl1bURyaXZlci5iYXNlVmVyc2lvblxuICAgICAgPyBgQXBwaXVtJ3MgQmFzZURyaXZlciB2ZXJzaW9uIGlzICR7QXBwaXVtRHJpdmVyLmJhc2VWZXJzaW9ufWBcbiAgICAgIDogYENvdWxkIG5vdCBkZXRlcm1pbmUgQXBwaXVtJ3MgQmFzZURyaXZlciB2ZXJzaW9uYFxuICAgICk7XG4gICAgdGhpcy5sb2cuaW5mbyhkcml2ZXJCYXNlVmVyc2lvblxuICAgICAgPyBgJHtkcml2ZXJOYW1lfSdzIEJhc2VEcml2ZXIgdmVyc2lvbiBpcyAke2RyaXZlckJhc2VWZXJzaW9ufWBcbiAgICAgIDogYENvdWxkIG5vdCBkZXRlcm1pbmUgJHtkcml2ZXJOYW1lfSdzIEJhc2VEcml2ZXIgdmVyc2lvbmBcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIGFuZCBhc3NpZ24gQ0xJIGFyZ3MgZm9yIGEgZHJpdmVyIG9yIHBsdWdpblxuICAgKlxuICAgKiBJZiB0aGUgZXh0ZW5zaW9uIGhhcyBwcm92aWRlZCBhIHNjaGVtYSwgdmFsaWRhdGlvbiBoYXMgYWxyZWFkeSBoYXBwZW5lZC5cbiAgICpcbiAgICogQW55IGFyZyB3aGljaCBpcyBlcXVhbCB0byBpdHMgZGVmYXVsdCB2YWx1ZSB3aWxsIG5vdCBiZSBhc3NpZ25lZCB0byB0aGUgZXh0ZW5zaW9uLlxuICAgKiBAcGFyYW0ge0V4dGVuc2lvblR5cGV9IGV4dFR5cGUgJ2RyaXZlcicgb3IgJ3BsdWdpbidcbiAgICogQHBhcmFtIHtzdHJpbmd9IGV4dE5hbWUgdGhlIG5hbWUgb2YgdGhlIGV4dGVuc2lvblxuICAgKiBAcGFyYW0ge09iamVjdH0gZXh0SW5zdGFuY2UgdGhlIGRyaXZlciBvciBwbHVnaW4gaW5zdGFuY2VcbiAgICovXG4gIGFzc2lnbkNsaUFyZ3NUb0V4dGVuc2lvbiAoZXh0VHlwZSwgZXh0TmFtZSwgZXh0SW5zdGFuY2UpIHtcbiAgICBjb25zdCBhbGxDbGlBcmdzRm9yRXh0ID0gLyoqIEB0eXBlIHtSZWNvcmQ8c3RyaW5nLHVua25vd24+fHVuZGVmaW5lZH0gKi8odGhpcy5hcmdzW2V4dFR5cGVdPy5bZXh0TmFtZV0pO1xuICAgIGlmICghXy5pc0VtcHR5KGFsbENsaUFyZ3NGb3JFeHQpKSB7XG4gICAgICBjb25zdCBkZWZhdWx0cyA9IGdldERlZmF1bHRzRm9yRXh0ZW5zaW9uKGV4dFR5cGUsIGV4dE5hbWUpO1xuICAgICAgY29uc3QgY2xpQXJncyA9IF8uaXNFbXB0eShkZWZhdWx0cylcbiAgICAgICAgPyBhbGxDbGlBcmdzRm9yRXh0XG4gICAgICAgIDogXy5vbWl0QnkoYWxsQ2xpQXJnc0ZvckV4dCwgKHZhbHVlLCBrZXkpID0+IF8uaXNFcXVhbChkZWZhdWx0c1trZXldLCB2YWx1ZSkpO1xuICAgICAgaWYgKCFfLmlzRW1wdHkoY2xpQXJncykpIHtcbiAgICAgICAgZXh0SW5zdGFuY2UuY2xpQXJncyA9IGNsaUFyZ3M7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBzZXNzaW9uXG4gICAqIEBwYXJhbSB7VzNDQ2FwYWJpbGl0aWVzfSBqc29ud3BDYXBzIEpTT05XUCBmb3JtYXR0ZWQgZGVzaXJlZCBjYXBhYmlsaXRpZXNcbiAgICogQHBhcmFtIHtXM0NDYXBhYmlsaXRpZXN9IHJlcUNhcHMgUmVxdWlyZWQgY2FwYWJpbGl0aWVzIChKU09OV1Agc3RhbmRhcmQpXG4gICAqIEBwYXJhbSB7VzNDQ2FwYWJpbGl0aWVzfSB3M2NDYXBhYmlsaXRpZXMgVzNDIGNhcGFiaWxpdGllc1xuICAgKiBAcGFyYW0ge2ltcG9ydCgnQGFwcGl1bS90eXBlcycpLkRyaXZlckRhdGFbXX0gW2RyaXZlckRhdGFdXG4gICAqL1xuICBhc3luYyBjcmVhdGVTZXNzaW9uIChqc29ud3BDYXBzLCByZXFDYXBzLCB3M2NDYXBhYmlsaXRpZXMsIGRyaXZlckRhdGEpIHtcbiAgICBjb25zdCBkZWZhdWx0Q2FwYWJpbGl0aWVzID0gXy5jbG9uZURlZXAodGhpcy5hcmdzLmRlZmF1bHRDYXBhYmlsaXRpZXMpO1xuICAgIGNvbnN0IGRlZmF1bHRTZXR0aW5ncyA9IHB1bGxTZXR0aW5ncyhkZWZhdWx0Q2FwYWJpbGl0aWVzKTtcbiAgICBqc29ud3BDYXBzID0gXy5jbG9uZURlZXAoanNvbndwQ2Fwcyk7XG4gICAgY29uc3QgandwU2V0dGluZ3MgPSB7Li4uZGVmYXVsdFNldHRpbmdzLCAuLi5wdWxsU2V0dGluZ3MoanNvbndwQ2Fwcyl9O1xuICAgIHczY0NhcGFiaWxpdGllcyA9IF8uY2xvbmVEZWVwKHczY0NhcGFiaWxpdGllcyk7XG4gICAgLy8gSXQgaXMgcG9zc2libGUgdGhhdCB0aGUgY2xpZW50IG9ubHkgcHJvdmlkZXMgY2FwcyB1c2luZyBKU09OV1Agc3RhbmRhcmQsXG4gICAgLy8gYWx0aG91Z2ggZmlyc3RNYXRjaC9hbHdheXNNYXRjaCBwcm9wZXJ0aWVzIGFyZSBzdGlsbCBwcmVzZW50LlxuICAgIC8vIEluIHN1Y2ggY2FzZSB3ZSBhc3N1bWUgdGhlIGNsaWVudCB1bmRlcnN0YW5kcyBXM0MgcHJvdG9jb2wgYW5kIG1lcmdlIHRoZSBnaXZlblxuICAgIC8vIEpTT05XUCBjYXBzIHRvIFczQyBjYXBzXG4gICAgY29uc3QgdzNjU2V0dGluZ3MgPSB7XG4gICAgICAuLi5qd3BTZXR0aW5ncyxcbiAgICAgIC4uLnB1bGxTZXR0aW5ncygodzNjQ2FwYWJpbGl0aWVzID8/IHt9KS5hbHdheXNNYXRjaCA/PyB7fSlcbiAgICB9O1xuICAgIGZvciAoY29uc3QgZmlyc3RNYXRjaEVudHJ5IG9mICgodzNjQ2FwYWJpbGl0aWVzID8/IHt9KS5maXJzdE1hdGNoID8/IFtdKSkge1xuICAgICAgT2JqZWN0LmFzc2lnbih3M2NTZXR0aW5ncywgcHVsbFNldHRpbmdzKGZpcnN0TWF0Y2hFbnRyeSkpO1xuICAgIH1cblxuICAgIGxldCBwcm90b2NvbDtcbiAgICBsZXQgaW5uZXJTZXNzaW9uSWQsIGRDYXBzO1xuICAgIHRyeSB7XG4gICAgICAvLyBQYXJzZSB0aGUgY2FwcyBpbnRvIGEgZm9ybWF0IHRoYXQgdGhlIElubmVyRHJpdmVyIHdpbGwgYWNjZXB0XG4gICAgICBjb25zdCBwYXJzZWRDYXBzID0gcGFyc2VDYXBzRm9ySW5uZXJEcml2ZXIoXG4gICAgICAgIGpzb253cENhcHMsXG4gICAgICAgIHczY0NhcGFiaWxpdGllcyxcbiAgICAgICAgdGhpcy5kZXNpcmVkQ2FwQ29uc3RyYWludHMsXG4gICAgICAgIGRlZmF1bHRDYXBhYmlsaXRpZXNcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHtkZXNpcmVkQ2FwcywgcHJvY2Vzc2VkSnNvbndwQ2FwYWJpbGl0aWVzLCBwcm9jZXNzZWRXM0NDYXBhYmlsaXRpZXN9ID0gLyoqIEB0eXBlIHtpbXBvcnQoJy4vdXRpbHMnKS5QYXJzZWREcml2ZXJDYXBzfSAqLyhwYXJzZWRDYXBzKTtcbiAgICAgIHByb3RvY29sID0gcGFyc2VkQ2Fwcy5wcm90b2NvbDtcbiAgICAgIGNvbnN0IGVycm9yID0gLyoqIEB0eXBlIHtpbXBvcnQoJy4vdXRpbHMnKS5JbnZhbGlkQ2Fwc30gKi8ocGFyc2VkQ2FwcykuZXJyb3I7XG4gICAgICAvLyBJZiB0aGUgcGFyc2luZyBvZiB0aGUgY2FwcyBwcm9kdWNlZCBhbiBlcnJvciwgdGhyb3cgaXQgaW4gaGVyZVxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB7XG4gICAgICAgIGRyaXZlcjogSW5uZXJEcml2ZXIsXG4gICAgICAgIHZlcnNpb246IGRyaXZlclZlcnNpb24sXG4gICAgICAgIGRyaXZlck5hbWVcbiAgICAgIH0gPSB0aGlzLmRyaXZlckNvbmZpZy5maW5kTWF0Y2hpbmdEcml2ZXIoZGVzaXJlZENhcHMpO1xuICAgICAgdGhpcy5wcmludE5ld1Nlc3Npb25Bbm5vdW5jZW1lbnQoSW5uZXJEcml2ZXIubmFtZSwgZHJpdmVyVmVyc2lvbiwgSW5uZXJEcml2ZXIuYmFzZVZlcnNpb24pO1xuXG4gICAgICBpZiAodGhpcy5hcmdzLnNlc3Npb25PdmVycmlkZSkge1xuICAgICAgICBhd2FpdCB0aGlzLmRlbGV0ZUFsbFNlc3Npb25zKCk7XG4gICAgICB9XG5cbiAgICAgIC8qKlxuICAgICAgICogQHR5cGUge0RyaXZlckRhdGFbXX1cbiAgICAgICAqL1xuICAgICAgbGV0IHJ1bm5pbmdEcml2ZXJzRGF0YSA9IFtdO1xuICAgICAgLyoqXG4gICAgICAgKiBAdHlwZSB7RHJpdmVyRGF0YVtdfVxuICAgICAgICovXG4gICAgICBsZXQgb3RoZXJQZW5kaW5nRHJpdmVyc0RhdGEgPSBbXTtcblxuICAgICAgY29uc3QgZHJpdmVySW5zdGFuY2UgPSBuZXcgSW5uZXJEcml2ZXIodGhpcy5hcmdzLCB0cnVlKTtcblxuICAgICAgLy8gV2Ugd2FudCB0byBhc3NpZ24gc2VjdXJpdHkgdmFsdWVzIGRpcmVjdGx5IG9uIHRoZSBkcml2ZXIuIFRoZSBkcml2ZXJcbiAgICAgIC8vIHNob3VsZCBub3QgcmVhZCBzZWN1cml0eSB2YWx1ZXMgZnJvbSBgdGhpcy5vcHRzYCBiZWNhdXNlIHRob3NlIHZhbHVlc1xuICAgICAgLy8gY291bGQgaGF2ZSBiZWVuIHNldCBieSBhIG1hbGljaW91cyB1c2VyIHZpYSBjYXBhYmlsaXRpZXMsIHdoZXJlYXMgd2VcbiAgICAgIC8vIHdhbnQgYSBndWFyYW50ZWUgdGhlIHZhbHVlcyB3ZXJlIHNldCBieSB0aGUgYXBwaXVtIHNlcnZlciBhZG1pblxuICAgICAgaWYgKHRoaXMuYXJncy5yZWxheGVkU2VjdXJpdHlFbmFibGVkKSB7XG4gICAgICAgIHRoaXMubG9nLmluZm8oYEFwcGx5aW5nIHJlbGF4ZWQgc2VjdXJpdHkgdG8gJyR7SW5uZXJEcml2ZXIubmFtZX0nIGFzIHBlciBgICtcbiAgICAgICAgICBgc2VydmVyIGNvbW1hbmQgbGluZSBhcmd1bWVudC4gQWxsIGluc2VjdXJlIGZlYXR1cmVzIHdpbGwgYmUgYCArXG4gICAgICAgICAgYGVuYWJsZWQgdW5sZXNzIGV4cGxpY2l0bHkgZGlzYWJsZWQgYnkgLS1kZW55LWluc2VjdXJlYCk7XG4gICAgICAgIGRyaXZlckluc3RhbmNlLnJlbGF4ZWRTZWN1cml0eUVuYWJsZWQgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLmFyZ3MuZGVueUluc2VjdXJlKSkge1xuICAgICAgICB0aGlzLmxvZy5pbmZvKCdFeHBsaWNpdGx5IHByZXZlbnRpbmcgdXNlIG9mIGluc2VjdXJlIGZlYXR1cmVzOicpO1xuICAgICAgICB0aGlzLmFyZ3MuZGVueUluc2VjdXJlLm1hcCgoYSkgPT4gdGhpcy5sb2cuaW5mbyhgICAgICR7YX1gKSk7XG4gICAgICAgIGRyaXZlckluc3RhbmNlLmRlbnlJbnNlY3VyZSA9IHRoaXMuYXJncy5kZW55SW5zZWN1cmU7XG4gICAgICB9XG5cbiAgICAgIGlmICghXy5pc0VtcHR5KHRoaXMuYXJncy5hbGxvd0luc2VjdXJlKSkge1xuICAgICAgICB0aGlzLmxvZy5pbmZvKCdFeHBsaWNpdGx5IGVuYWJsaW5nIHVzZSBvZiBpbnNlY3VyZSBmZWF0dXJlczonKTtcbiAgICAgICAgdGhpcy5hcmdzLmFsbG93SW5zZWN1cmUubWFwKChhKSA9PiB0aGlzLmxvZy5pbmZvKGAgICAgJHthfWApKTtcbiAgICAgICAgZHJpdmVySW5zdGFuY2UuYWxsb3dJbnNlY3VyZSA9IHRoaXMuYXJncy5hbGxvd0luc2VjdXJlO1xuICAgICAgfVxuXG4gICAgICAvLyBMaWtld2lzZSwgYW55IGRyaXZlci1zcGVjaWZpYyBDTEkgYXJncyB0aGF0IHdlcmUgcGFzc2VkIGluIHNob3VsZCBiZSBhc3NpZ25lZCBkaXJlY3RseSB0b1xuICAgICAgLy8gdGhlIGRyaXZlciBzbyB0aGF0IHRoZXkgY2Fubm90IGJlIG1pbWlja2VkIGJ5IGEgbWFsaWNpb3VzIHVzZXIgc2VuZGluZyBpbiBjYXBhYmlsaXRpZXNcbiAgICAgIHRoaXMuYXNzaWduQ2xpQXJnc1RvRXh0ZW5zaW9uKCdkcml2ZXInLCBkcml2ZXJOYW1lLCBkcml2ZXJJbnN0YW5jZSk7XG5cbiAgICAgIC8vIFRoaXMgYXNzaWdubWVudCBpcyByZXF1aXJlZCBmb3IgY29ycmVjdCB3ZWIgc29ja2V0cyBmdW5jdGlvbmFsaXR5IGluc2lkZSB0aGUgZHJpdmVyXG4gICAgICAvLyBEcml2ZXJzL3BsdWdpbnMgbWlnaHQgYWxzbyB3YW50IHRvIGtub3cgd2hlcmUgdGhleSBhcmUgaG9zdGVkXG5cbiAgICAgIC8vIFhYWDogdGVtcG9yYXJ5IGhhY2sgdG8gd29yayBhcm91bmQgIzE2NzQ3XG4gICAgICBkcml2ZXJJbnN0YW5jZS5zZXJ2ZXIgPSB0aGlzLnNlcnZlcjtcbiAgICAgIGRyaXZlckluc3RhbmNlLnNlcnZlckhvc3QgPSB0aGlzLmFyZ3MuYWRkcmVzcztcbiAgICAgIGRyaXZlckluc3RhbmNlLnNlcnZlclBvcnQgPSB0aGlzLmFyZ3MucG9ydDtcbiAgICAgIGRyaXZlckluc3RhbmNlLnNlcnZlclBhdGggPSB0aGlzLmFyZ3MuYmFzZVBhdGg7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIHJ1bm5pbmdEcml2ZXJzRGF0YSA9IGF3YWl0IHRoaXMuY3VyU2Vzc2lvbkRhdGFGb3JEcml2ZXIoSW5uZXJEcml2ZXIpID8/IFtdO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLlNlc3Npb25Ob3RDcmVhdGVkRXJyb3IoZS5tZXNzYWdlKTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHBlbmRpbmdEcml2ZXJzR3VhcmQuYWNxdWlyZShBcHBpdW1Ecml2ZXIubmFtZSwgKCkgPT4ge1xuICAgICAgICB0aGlzLnBlbmRpbmdEcml2ZXJzW0lubmVyRHJpdmVyLm5hbWVdID0gdGhpcy5wZW5kaW5nRHJpdmVyc1tJbm5lckRyaXZlci5uYW1lXSB8fCBbXTtcbiAgICAgICAgb3RoZXJQZW5kaW5nRHJpdmVyc0RhdGEgPSBfLmNvbXBhY3QodGhpcy5wZW5kaW5nRHJpdmVyc1tJbm5lckRyaXZlci5uYW1lXS5tYXAoKGRydikgPT4gZHJ2LmRyaXZlckRhdGEpKTtcbiAgICAgICAgdGhpcy5wZW5kaW5nRHJpdmVyc1tJbm5lckRyaXZlci5uYW1lXS5wdXNoKGRyaXZlckluc3RhbmNlKTtcbiAgICAgIH0pO1xuXG4gICAgICB0cnkge1xuICAgICAgICBbaW5uZXJTZXNzaW9uSWQsIGRDYXBzXSA9IGF3YWl0IGRyaXZlckluc3RhbmNlLmNyZWF0ZVNlc3Npb24oXG4gICAgICAgICAgcHJvY2Vzc2VkSnNvbndwQ2FwYWJpbGl0aWVzLFxuICAgICAgICAgIHJlcUNhcHMsXG4gICAgICAgICAgcHJvY2Vzc2VkVzNDQ2FwYWJpbGl0aWVzLFxuICAgICAgICAgIFsuLi5ydW5uaW5nRHJpdmVyc0RhdGEsIC4uLm90aGVyUGVuZGluZ0RyaXZlcnNEYXRhXVxuICAgICAgICApO1xuICAgICAgICBwcm90b2NvbCA9IGRyaXZlckluc3RhbmNlLnByb3RvY29sO1xuICAgICAgICB0aGlzLnNlc3Npb25zW2lubmVyU2Vzc2lvbklkXSA9IGRyaXZlckluc3RhbmNlO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgcGVuZGluZ0RyaXZlcnNHdWFyZC5hY3F1aXJlKEFwcGl1bURyaXZlci5uYW1lLCAoKSA9PiB7XG4gICAgICAgICAgXy5wdWxsKHRoaXMucGVuZGluZ0RyaXZlcnNbSW5uZXJEcml2ZXIubmFtZV0sIGRyaXZlckluc3RhbmNlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuYXR0YWNoVW5leHBlY3RlZFNodXRkb3duSGFuZGxlcihkcml2ZXJJbnN0YW5jZSwgaW5uZXJTZXNzaW9uSWQpO1xuXG4gICAgICB0aGlzLmxvZy5pbmZvKGBOZXcgJHtJbm5lckRyaXZlci5uYW1lfSBzZXNzaW9uIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5LCBzZXNzaW9uIGAgK1xuICAgICAgICBgJHtpbm5lclNlc3Npb25JZH0gYWRkZWQgdG8gbWFzdGVyIHNlc3Npb24gbGlzdGApO1xuXG4gICAgICAvLyBzZXQgdGhlIE5ldyBDb21tYW5kIFRpbWVvdXQgZm9yIHRoZSBpbm5lciBkcml2ZXJcbiAgICAgIGRyaXZlckluc3RhbmNlLnN0YXJ0TmV3Q29tbWFuZFRpbWVvdXQoKTtcblxuICAgICAgLy8gYXBwbHkgaW5pdGlhbCB2YWx1ZXMgdG8gQXBwaXVtIHNldHRpbmdzIChpZiBwcm92aWRlZClcbiAgICAgIGlmIChkcml2ZXJJbnN0YW5jZS5pc1czQ1Byb3RvY29sKCkgJiYgIV8uaXNFbXB0eSh3M2NTZXR0aW5ncykpIHtcbiAgICAgICAgdGhpcy5sb2cuaW5mbyhgQXBwbHlpbmcgdGhlIGluaXRpYWwgdmFsdWVzIHRvIEFwcGl1bSBzZXR0aW5ncyBwYXJzZWQgZnJvbSBXM0MgY2FwczogYCArXG4gICAgICAgICAgSlNPTi5zdHJpbmdpZnkodzNjU2V0dGluZ3MpKTtcbiAgICAgICAgYXdhaXQgZHJpdmVySW5zdGFuY2UudXBkYXRlU2V0dGluZ3ModzNjU2V0dGluZ3MpO1xuICAgICAgfSBlbHNlIGlmIChkcml2ZXJJbnN0YW5jZS5pc01qc29ud3BQcm90b2NvbCgpICYmICFfLmlzRW1wdHkoandwU2V0dGluZ3MpKSB7XG4gICAgICAgIHRoaXMubG9nLmluZm8oYEFwcGx5aW5nIHRoZSBpbml0aWFsIHZhbHVlcyB0byBBcHBpdW0gc2V0dGluZ3MgcGFyc2VkIGZyb20gTUpTT05XUCBjYXBzOiBgICtcbiAgICAgICAgICBKU09OLnN0cmluZ2lmeShqd3BTZXR0aW5ncykpO1xuICAgICAgICBhd2FpdCBkcml2ZXJJbnN0YW5jZS51cGRhdGVTZXR0aW5ncyhqd3BTZXR0aW5ncyk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHByb3RvY29sLFxuICAgICAgICBlcnJvcixcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHByb3RvY29sLFxuICAgICAgdmFsdWU6IFtpbm5lclNlc3Npb25JZCwgZENhcHMsIHByb3RvY29sXVxuICAgIH07XG4gIH1cblxuICBhdHRhY2hVbmV4cGVjdGVkU2h1dGRvd25IYW5kbGVyIChkcml2ZXIsIGlubmVyU2Vzc2lvbklkKSB7XG4gICAgY29uc3Qgb25TaHV0ZG93biA9IChjYXVzZSA9IG5ldyBFcnJvcignVW5rbm93biBlcnJvcicpKSA9PiB7XG4gICAgICB0aGlzLmxvZy53YXJuKGBFbmRpbmcgc2Vzc2lvbiwgY2F1c2Ugd2FzICcke2NhdXNlLm1lc3NhZ2V9J2ApO1xuXG4gICAgICBpZiAodGhpcy5zZXNzaW9uUGx1Z2luc1tpbm5lclNlc3Npb25JZF0pIHtcbiAgICAgICAgZm9yIChjb25zdCBwbHVnaW4gb2YgdGhpcy5zZXNzaW9uUGx1Z2luc1tpbm5lclNlc3Npb25JZF0pIHtcbiAgICAgICAgICBpZiAoXy5pc0Z1bmN0aW9uKHBsdWdpbi5vblVuZXhwZWN0ZWRTaHV0ZG93bikpIHtcbiAgICAgICAgICAgIHRoaXMubG9nLmRlYnVnKGBQbHVnaW4gJHtwbHVnaW4ubmFtZX0gZGVmaW5lcyBhbiB1bmV4cGVjdGVkIHNodXRkb3duIGhhbmRsZXI7IGNhbGxpbmcgaXQgbm93YCk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBwbHVnaW4ub25VbmV4cGVjdGVkU2h1dGRvd24oZHJpdmVyLCBjYXVzZSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgIHRoaXMubG9nLndhcm4oYEdvdCBhbiBlcnJvciB3aGVuIHJ1bm5pbmcgcGx1Z2luICR7cGx1Z2luLm5hbWV9IHNodXRkb3duIGhhbmRsZXI6ICR7ZX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5sb2cuZGVidWcoYFBsdWdpbiAke3BsdWdpbi5uYW1lfSBkb2VzIG5vdCBkZWZpbmUgYW4gdW5leHBlY3RlZCBzaHV0ZG93biBoYW5kbGVyYCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMubG9nLmluZm8oYFJlbW92aW5nIHNlc3Npb24gJyR7aW5uZXJTZXNzaW9uSWR9JyBmcm9tIG91ciBtYXN0ZXIgc2Vzc2lvbiBsaXN0YCk7XG4gICAgICBkZWxldGUgdGhpcy5zZXNzaW9uc1tpbm5lclNlc3Npb25JZF07XG4gICAgICBkZWxldGUgdGhpcy5zZXNzaW9uUGx1Z2luc1tpbm5lclNlc3Npb25JZF07XG4gICAgfTtcblxuICAgIGlmIChfLmlzRnVuY3Rpb24oZHJpdmVyLm9uVW5leHBlY3RlZFNodXRkb3duKSkge1xuICAgICAgZHJpdmVyLm9uVW5leHBlY3RlZFNodXRkb3duKG9uU2h1dGRvd24pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmxvZy53YXJuKGBGYWlsZWQgdG8gYXR0YWNoIHRoZSB1bmV4cGVjdGVkIHNodXRkb3duIGxpc3RlbmVyLiBgICtcbiAgICAgICAgYElzICdvblVuZXhwZWN0ZWRTaHV0ZG93bicgbWV0aG9kIGF2YWlsYWJsZSBmb3IgJyR7ZHJpdmVyLmNvbnN0cnVjdG9yLm5hbWV9Jz9gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHtpbXBvcnQoJy4uL3R5cGVzL2V4dGVuc2lvbicpLkRyaXZlckNsYXNzfSBJbm5lckRyaXZlclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxEcml2ZXJEYXRhW10+fX1cbiAgICovXG4gIGFzeW5jIGN1clNlc3Npb25EYXRhRm9yRHJpdmVyIChJbm5lckRyaXZlcikgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICBjb25zdCBkYXRhID0gXy5jb21wYWN0KF8udmFsdWVzKHRoaXMuc2Vzc2lvbnMpXG4gICAgICAuZmlsdGVyKChzKSA9PiBzLmNvbnN0cnVjdG9yLm5hbWUgPT09IElubmVyRHJpdmVyLm5hbWUpXG4gICAgICAubWFwKChzKSA9PiBzLmRyaXZlckRhdGEpKTtcbiAgICBmb3IgKGNvbnN0IGRhdHVtIG9mIGRhdGEpIHtcbiAgICAgIGlmICghZGF0dW0pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBQcm9ibGVtIGdldHRpbmcgc2Vzc2lvbiBkYXRhIGZvciBkcml2ZXIgdHlwZSBgICtcbiAgICAgICAgICBgJHtJbm5lckRyaXZlci5uYW1lfTsgZG9lcyBpdCBpbXBsZW1lbnQgJ2dldCBkcml2ZXJEYXRhJz9gKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRhdGE7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtzdHJpbmd9IHNlc3Npb25JZFxuICAgKi9cbiAgYXN5bmMgZGVsZXRlU2Vzc2lvbiAoc2Vzc2lvbklkKSB7XG4gICAgbGV0IHByb3RvY29sO1xuICAgIHRyeSB7XG4gICAgICBsZXQgb3RoZXJTZXNzaW9uc0RhdGE7XG4gICAgICBjb25zdCBkc3RTZXNzaW9uID0gYXdhaXQgc2Vzc2lvbnNMaXN0R3VhcmQuYWNxdWlyZShBcHBpdW1Ecml2ZXIubmFtZSwgKCkgPT4ge1xuICAgICAgICBpZiAoIXRoaXMuc2Vzc2lvbnNbc2Vzc2lvbklkXSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjdXJDb25zdHJ1Y3Rvck5hbWUgPSB0aGlzLnNlc3Npb25zW3Nlc3Npb25JZF0uY29uc3RydWN0b3IubmFtZTtcbiAgICAgICAgb3RoZXJTZXNzaW9uc0RhdGEgPSBfLnRvUGFpcnModGhpcy5zZXNzaW9ucylcbiAgICAgICAgICAgICAgLmZpbHRlcigoW2tleSwgdmFsdWVdKSA9PiB2YWx1ZS5jb25zdHJ1Y3Rvci5uYW1lID09PSBjdXJDb25zdHJ1Y3Rvck5hbWUgJiYga2V5ICE9PSBzZXNzaW9uSWQpXG4gICAgICAgICAgICAgIC5tYXAoKFssIHZhbHVlXSkgPT4gdmFsdWUuZHJpdmVyRGF0YSk7XG4gICAgICAgIGNvbnN0IGRzdFNlc3Npb24gPSB0aGlzLnNlc3Npb25zW3Nlc3Npb25JZF07XG4gICAgICAgIHByb3RvY29sID0gZHN0U2Vzc2lvbi5wcm90b2NvbDtcbiAgICAgICAgdGhpcy5sb2cuaW5mbyhgUmVtb3Zpbmcgc2Vzc2lvbiAke3Nlc3Npb25JZH0gZnJvbSBvdXIgbWFzdGVyIHNlc3Npb24gbGlzdGApO1xuICAgICAgICAvLyByZWdhcmRsZXNzIG9mIHdoZXRoZXIgdGhlIGRlbGV0ZVNlc3Npb24gY29tcGxldGVzIHN1Y2Nlc3NmdWxseSBvciBub3RcbiAgICAgICAgLy8gbWFrZSB0aGUgc2Vzc2lvbiB1bmF2YWlsYWJsZSwgYmVjYXVzZSB3aG8ga25vd3Mgd2hhdCBzdGF0ZSBpdCBtaWdodFxuICAgICAgICAvLyBiZSBpbiBvdGhlcndpc2VcbiAgICAgICAgZGVsZXRlIHRoaXMuc2Vzc2lvbnNbc2Vzc2lvbklkXTtcbiAgICAgICAgZGVsZXRlIHRoaXMuc2Vzc2lvblBsdWdpbnNbc2Vzc2lvbklkXTtcbiAgICAgICAgcmV0dXJuIGRzdFNlc3Npb247XG4gICAgICB9KTtcbiAgICAgIC8vIHRoaXMgbWF5IG5vdCBiZSBjb3JyZWN0LCBidXQgaWYgYGRzdFNlc3Npb25gIHdhcyBmYWxzeSwgdGhlIGNhbGwgdG8gYGRlbGV0ZVNlc3Npb24oKWAgd291bGRcbiAgICAgIC8vIHRocm93IGFueXdheS5cbiAgICAgIGlmICghZHN0U2Vzc2lvbikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Nlc3Npb24gbm90IGZvdW5kJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICBwcm90b2NvbCxcbiAgICAgICAgdmFsdWU6IGF3YWl0IGRzdFNlc3Npb24uZGVsZXRlU2Vzc2lvbihzZXNzaW9uSWQsIG90aGVyU2Vzc2lvbnNEYXRhKSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhpcy5sb2cuZXJyb3IoYEhhZCB0cm91YmxlIGVuZGluZyBzZXNzaW9uICR7c2Vzc2lvbklkfTogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBwcm90b2NvbCxcbiAgICAgICAgZXJyb3I6IGUsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZUFsbFNlc3Npb25zIChvcHRzID0ge30pIHtcbiAgICBjb25zdCBzZXNzaW9uc0NvdW50ID0gXy5zaXplKHRoaXMuc2Vzc2lvbnMpO1xuICAgIGlmICgwID09PSBzZXNzaW9uc0NvdW50KSB7XG4gICAgICB0aGlzLmxvZy5kZWJ1ZygnVGhlcmUgYXJlIG5vIGFjdGl2ZSBzZXNzaW9ucyBmb3IgY2xlYW51cCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHtcbiAgICAgIGZvcmNlID0gZmFsc2UsXG4gICAgICByZWFzb24sXG4gICAgfSA9IG9wdHM7XG4gICAgdGhpcy5sb2cuZGVidWcoYENsZWFuaW5nIHVwICR7dXRpbC5wbHVyYWxpemUoJ2FjdGl2ZSBzZXNzaW9uJywgc2Vzc2lvbnNDb3VudCwgdHJ1ZSl9YCk7XG4gICAgY29uc3QgY2xlYW51cFByb21pc2VzID0gZm9yY2VcbiAgICAgID8gXy52YWx1ZXModGhpcy5zZXNzaW9ucykubWFwKChkcnYpID0+IGRydi5zdGFydFVuZXhwZWN0ZWRTaHV0ZG93bihyZWFzb24gJiYgbmV3IEVycm9yKHJlYXNvbikpKVxuICAgICAgOiBfLmtleXModGhpcy5zZXNzaW9ucykubWFwKChpZCkgPT4gdGhpcy5kZWxldGVTZXNzaW9uKGlkKSk7XG4gICAgZm9yIChjb25zdCBjbGVhbnVwUHJvbWlzZSBvZiBjbGVhbnVwUHJvbWlzZXMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGNsZWFudXBQcm9taXNlO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0aGlzLmxvZy5kZWJ1ZyhlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBhcHByb3ByaWF0ZSBwbHVnaW5zIGZvciBhIHNlc3Npb24gKG9yIHNlc3Npb25sZXNzIHBsdWdpbnMpXG4gICAqXG4gICAqIEBwYXJhbSB7P3N0cmluZ30gc2Vzc2lvbklkIC0gdGhlIHNlc3Npb25JZCAob3IgbnVsbCkgdG8gdXNlIHRvIGZpbmQgcGx1Z2luc1xuICAgKiBAcmV0dXJucyB7QXJyYXl9IC0gYXJyYXkgb2YgcGx1Z2luIGluc3RhbmNlc1xuICAgKi9cbiAgcGx1Z2luc0ZvclNlc3Npb24gKHNlc3Npb25JZCA9IG51bGwpIHtcbiAgICBpZiAoc2Vzc2lvbklkKSB7XG4gICAgICBpZiAoIXRoaXMuc2Vzc2lvblBsdWdpbnNbc2Vzc2lvbklkXSkge1xuICAgICAgICB0aGlzLnNlc3Npb25QbHVnaW5zW3Nlc3Npb25JZF0gPSB0aGlzLmNyZWF0ZVBsdWdpbkluc3RhbmNlcygpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuc2Vzc2lvblBsdWdpbnNbc2Vzc2lvbklkXTtcbiAgICB9XG5cbiAgICBpZiAoXy5pc0VtcHR5KHRoaXMuc2Vzc2lvbmxlc3NQbHVnaW5zKSkge1xuICAgICAgdGhpcy5zZXNzaW9ubGVzc1BsdWdpbnMgPSB0aGlzLmNyZWF0ZVBsdWdpbkluc3RhbmNlcygpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5zZXNzaW9ubGVzc1BsdWdpbnM7XG4gIH1cblxuICAvKipcbiAgICogVG8gZ2V0IHBsdWdpbnMgZm9yIGEgY29tbWFuZCwgd2UgZWl0aGVyIGdldCB0aGUgcGx1Z2luIGluc3RhbmNlcyBhc3NvY2lhdGVkIHdpdGggdGhlXG4gICAqIHBhcnRpY3VsYXIgY29tbWFuZCdzIHNlc3Npb24sIG9yIGluIHRoZSBjYXNlIG9mIHNlc3Npb25sZXNzIHBsdWdpbnMsIHB1bGwgZnJvbSB0aGUgc2V0IG9mXG4gICAqIHBsdWdpbiBpbnN0YW5jZXMgcmVzZXJ2ZWQgZm9yIHNlc3Npb25sZXNzIGNvbW1hbmRzIChhbmQgd2UgbGF6aWx5IGNyZWF0ZSBwbHVnaW4gaW5zdGFuY2VzIG9uXG4gICAqIGZpcnN0IHVzZSlcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNtZCAtIHRoZSBuYW1lIG9mIHRoZSBjb21tYW5kIHRvIGZpbmQgYSBwbHVnaW4gdG8gaGFuZGxlXG4gICAqIEBwYXJhbSB7P3N0cmluZ30gc2Vzc2lvbklkIC0gdGhlIHBhcnRpY3VsYXIgc2Vzc2lvbiBmb3Igd2hpY2ggdG8gZmluZCBhIHBsdWdpbiwgb3IgbnVsbCBpZlxuICAgKiBzZXNzaW9ubGVzc1xuICAgKi9cbiAgcGx1Z2luc1RvSGFuZGxlQ21kIChjbWQsIHNlc3Npb25JZCA9IG51bGwpIHtcbiAgICAvLyB0byBoYW5kbGUgYSBnaXZlbiBjb21tYW5kLCBhIHBsdWdpbiBzaG91bGQgZWl0aGVyIGltcGxlbWVudCB0aGF0IGNvbW1hbmQgYXMgYSBwbHVnaW5cbiAgICAvLyBpbnN0YW5jZSBtZXRob2Qgb3IgaXQgc2hvdWxkIGltcGxlbWVudCBhIGdlbmVyaWMgJ2hhbmRsZScgbWV0aG9kXG4gICAgcmV0dXJuIHRoaXMucGx1Z2luc0ZvclNlc3Npb24oc2Vzc2lvbklkKVxuICAgICAgLmZpbHRlcigocCkgPT4gXy5pc0Z1bmN0aW9uKHBbY21kXSkgfHwgXy5pc0Z1bmN0aW9uKHAuaGFuZGxlKSk7XG4gIH1cblxuICBjcmVhdGVQbHVnaW5JbnN0YW5jZXMgKCkge1xuICAgIHJldHVybiB0aGlzLnBsdWdpbkNsYXNzZXMubWFwKChQbHVnaW5DbGFzcykgPT4ge1xuICAgICAgY29uc3QgbmFtZSA9IFBsdWdpbkNsYXNzLnBsdWdpbk5hbWU7XG4gICAgICBjb25zdCBwbHVnaW4gPSBuZXcgUGx1Z2luQ2xhc3MobmFtZSk7XG4gICAgICB0aGlzLmFzc2lnbkNsaUFyZ3NUb0V4dGVuc2lvbigncGx1Z2luJywgbmFtZSwgcGx1Z2luKTtcbiAgICAgIHJldHVybiBwbHVnaW47XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNtZFxuICAgKiBAcGFyYW0gIHsuLi5hbnl9IGFyZ3NcbiAgICogQHJldHVybnMge1Byb21pc2U8e3ZhbHVlOiBhbnksIGVycm9yPzogRXJyb3IsIHByb3RvY29sOiBzdHJpbmd9IHwgaW1wb3J0KCd0eXBlLWZlc3QnKS5Bc3luY1JldHVyblR5cGU8aW1wb3J0KCdAYXBwaXVtL3R5cGVzJykuRHJpdmVyWydleGVjdXRlQ29tbWFuZCddPj59XG4gICAqL1xuICBhc3luYyBleGVjdXRlQ29tbWFuZCAoY21kLCAuLi5hcmdzKSB7XG4gICAgLy8gV2UgaGF2ZSBiYXNpY2FsbHkgdGhyZWUgY2FzZXMgZm9yIGhvdyB0byBoYW5kbGUgY29tbWFuZHM6XG4gICAgLy8gMS4gaGFuZGxlIGdldFN0YXR1cyAod2UgZG8gdGhpcyBhcyBhIHNwZWNpYWwgb3V0IG9mIGJhbmQgY2FzZSBzbyBpdCBkb2Vzbid0IGdldCBhZGRlZCB0byBhblxuICAgIC8vICAgIGV4ZWN1dGlvbiBxdWV1ZSwgYW5kIGNhbiBiZSBjYWxsZWQgd2hpbGUgZS5nLiBjcmVhdGVTZXNzaW9uIGlzIGluIHByb2dyZXNzKVxuICAgIC8vIDIuIGhhbmRsZSBjb21tYW5kcyB0aGF0IHRoaXMgdW1icmVsbGEgZHJpdmVyIHNob3VsZCBoYW5kbGUsIHJhdGhlciB0aGFuIHRoZSBhY3R1YWwgc2Vzc2lvblxuICAgIC8vICAgIGRyaXZlciAoZm9yIGV4YW1wbGUsIGRlbGV0ZVNlc3Npb24sIG9yIG90aGVyIG5vbi1zZXNzaW9uIGNvbW1hbmRzKVxuICAgIC8vIDMuIGhhbmRsZSBzZXNzaW9uIGRyaXZlciBjb21tYW5kcy5cbiAgICAvLyBUaGUgdHJpY2t5IHBhcnQgaXMgdGhhdCBiZWNhdXNlIHdlIHN1cHBvcnQgY29tbWFuZCBwbHVnaW5zLCB3ZSBuZWVkIHRvIHdyYXAgYW55IG9mIHRoZXNlXG4gICAgLy8gY2FzZXMgd2l0aCBwbHVnaW4gaGFuZGxpbmcuXG5cbiAgICBjb25zdCBpc0dldFN0YXR1cyA9IGNtZCA9PT0gR0VUX1NUQVRVU19DT01NQU5EO1xuICAgIGNvbnN0IGlzVW1icmVsbGFDbWQgPSBpc0FwcGl1bURyaXZlckNvbW1hbmQoY21kKTtcbiAgICBjb25zdCBpc1Nlc3Npb25DbWQgPSBpc1Nlc3Npb25Db21tYW5kKGNtZCk7XG5cbiAgICAvLyBpZiBhIHBsdWdpbiBvdmVycmlkZSBwcm94eWluZyBmb3IgdGhpcyBjb21tYW5kIGFuZCB0aGF0IGlzIHdoeSB3ZSBhcmUgaGVyZSBpbnN0ZWFkIG9mIGp1c3RcbiAgICAvLyBsZXR0aW5nIHRoZSBwcm90b2NvbCBwcm94eSB0aGUgY29tbWFuZCBlbnRpcmVseSwgZGV0ZXJtaW5lIHRoYXQsIGdldCB0aGUgcmVxdWVzdCBvYmplY3QgZm9yXG4gICAgLy8gdXNlIGxhdGVyIG9uLCB0aGVuIGNsZWFuIHVwIHRoZSBhcmdzXG4gICAgY29uc3QgcmVxRm9yUHJveHkgPSBfLmxhc3QoYXJncyk/LnJlcUZvclByb3h5O1xuICAgIGlmIChyZXFGb3JQcm94eSkge1xuICAgICAgYXJncy5wb3AoKTtcbiAgICB9XG5cblxuICAgIC8vIGZpcnN0IGRvIHNvbWUgZXJyb3IgY2hlY2tpbmcuIElmIHdlJ3JlIHJlcXVlc3RpbmcgYSBzZXNzaW9uIGNvbW1hbmQgZXhlY3V0aW9uLCB0aGVuIG1ha2VcbiAgICAvLyBzdXJlIHRoYXQgc2Vzc2lvbiBhY3R1YWxseSBleGlzdHMgb24gdGhlIHNlc3Npb24gZHJpdmVyLCBhbmQgc2V0IHRoZSBzZXNzaW9uIGRyaXZlciBpdHNlbGZcbiAgICBsZXQgc2Vzc2lvbklkID0gbnVsbDtcbiAgICBsZXQgZHN0U2Vzc2lvbiA9IG51bGw7XG4gICAgbGV0IHByb3RvY29sID0gbnVsbDtcbiAgICAvKiogQHR5cGUge3RoaXMgfCBFeHRlcm5hbERyaXZlcn0gKi9cbiAgICBsZXQgZHJpdmVyID0gdGhpcztcbiAgICBpZiAoaXNTZXNzaW9uQ21kKSB7XG4gICAgICBzZXNzaW9uSWQgPSBfLmxhc3QoYXJncyk7XG4gICAgICBkc3RTZXNzaW9uID0gdGhpcy5zZXNzaW9uc1tzZXNzaW9uSWRdO1xuICAgICAgaWYgKCFkc3RTZXNzaW9uKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIHNlc3Npb24gd2l0aCBpZCAnJHtzZXNzaW9uSWR9JyBkb2VzIG5vdCBleGlzdGApO1xuICAgICAgfVxuICAgICAgLy8gbm93IHNhdmUgdGhlIHJlc3BvbnNlIHByb3RvY29sIGdpdmVuIHRoYXQgdGhlIHNlc3Npb24gZHJpdmVyJ3MgcHJvdG9jb2wgbWlnaHQgZGlmZmVyXG4gICAgICBwcm90b2NvbCA9IGRzdFNlc3Npb24ucHJvdG9jb2w7XG4gICAgICBpZiAoIWlzVW1icmVsbGFDbWQpIHtcbiAgICAgICAgZHJpdmVyID0gZHN0U2Vzc2lvbjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBnZXQgYW55IHBsdWdpbnMgd2hpY2ggYXJlIHJlZ2lzdGVyZWQgYXMgaGFuZGxpbmcgdGhpcyBjb21tYW5kXG4gICAgY29uc3QgcGx1Z2lucyA9IHRoaXMucGx1Z2luc1RvSGFuZGxlQ21kKGNtZCwgc2Vzc2lvbklkKTtcblxuICAgIC8vIG5vdyB3ZSBkZWZpbmUgYSAnY21kSGFuZGxlZEJ5JyBvYmplY3Qgd2hpY2ggd2lsbCBrZWVwIHRyYWNrIG9mIHdoaWNoIHBsdWdpbnMgaGF2ZSBoYW5kbGVkIHRoaXNcbiAgICAvLyBjb21tYW5kLiB3ZSBjYXJlIGFib3V0IHRoaXMgYmVjYXVzZSAoYSkgbXVsdGlwbGUgcGx1Z2lucyBjYW4gaGFuZGxlIHRoZSBzYW1lIGNvbW1hbmQsIGFuZFxuICAgIC8vIChiKSB0aGVyZSdzIG5vIGd1YXJhbnRlZSB0aGF0IGEgcGx1Z2luIHdpbGwgYWN0dWFsbHkgY2FsbCB0aGUgbmV4dCgpIG1ldGhvZCB3aGljaCBydW5zIHRoZVxuICAgIC8vIG9yaWdpbmFsIGNvbW1hbmQgZXhlY3V0aW9uLiBUaGlzIHJlc3VsdHMgaW4gYSBzaXR1YXRpb24gd2hlcmUgdGhlIGNvbW1hbmQgbWlnaHQgYmUgaGFuZGxlZFxuICAgIC8vIGJ5IHNvbWUgYnV0IG5vdCBhbGwgcGx1Z2lucywgb3IgYnkgcGx1Z2luKHMpIGJ1dCBub3QgYnkgdGhlIGRlZmF1bHQgYmVoYXZpb3IuIFNvIHN0YXJ0IG91dFxuICAgIC8vIHRoaXMgb2JqZWN0IGRlY2xhcmluZyB0aGF0IHRoZSBkZWZhdWx0IGhhbmRsZXIgaGFzIG5vdCBiZWVuIGV4ZWN1dGVkLlxuICAgIGNvbnN0IGNtZEhhbmRsZWRCeSA9IHtkZWZhdWx0OiBmYWxzZX07XG5cbiAgICAvLyBub3cgd2UgZGVmaW5lIGFuIGFzeW5jIGZ1bmN0aW9uIHdoaWNoIHdpbGwgYmUgcGFzc2VkIHRvIHBsdWdpbnMsIGFuZCBzdWNjZXNzaXZlbHkgd3JhcHBlZFxuICAgIC8vIGlmIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgcGx1Z2luIHRoYXQgY2FuIGhhbmRsZSB0aGUgY29tbWFuZC4gVG8gc3RhcnQgb2ZmIHdpdGgsIHRoZSBhc3luY1xuICAgIC8vIGZ1bmN0aW9uIGlzIGRlZmluZWQgYXMgY2FsbGluZyB0aGUgZGVmYXVsdCBiZWhhdmlvciwgaS5lLiwgd2hpY2hldmVyIG9mIHRoZSAzIGNhc2VzIGFib3ZlIGlzXG4gICAgLy8gdGhlIGFwcHJvcHJpYXRlIG9uZVxuICAgIGNvbnN0IGRlZmF1bHRCZWhhdmlvciA9IGFzeW5jICgpID0+IHtcbiAgICAgIC8vIGlmIHdlJ3JlIHJ1bm5pbmcgd2l0aCBwbHVnaW5zLCBtYWtlIHN1cmUgd2UgbG9nIHRoYXQgdGhlIGRlZmF1bHQgYmVoYXZpb3IgaXMgYWN0dWFsbHlcbiAgICAgIC8vIGhhcHBlbmluZyBzbyB3ZSBjYW4gdGVsbCB3aGVuIHRoZSBwbHVnaW4gY2FsbCBjaGFpbiBpcyB1bndyYXBwaW5nIHRvIHRoZSBkZWZhdWx0IGJlaGF2aW9yXG4gICAgICAvLyBpZiB0aGF0J3Mgd2hhdCBoYXBwZW5zXG4gICAgICBwbHVnaW5zLmxlbmd0aCAmJiB0aGlzLmxvZy5pbmZvKGBFeGVjdXRpbmcgZGVmYXVsdCBoYW5kbGluZyBiZWhhdmlvciBmb3IgY29tbWFuZCAnJHtjbWR9J2ApO1xuXG4gICAgICAvLyBpZiB3ZSBtYWtlIGl0IGhlcmUsIHdlIGtub3cgdGhhdCB0aGUgZGVmYXVsdCBiZWhhdmlvciBpcyBoYW5kbGVkXG4gICAgICBjbWRIYW5kbGVkQnkuZGVmYXVsdCA9IHRydWU7XG5cbiAgICAgIGlmIChyZXFGb3JQcm94eSkge1xuICAgICAgICAvLyB3ZSB3b3VsZCBoYXZlIHByb3hpZWQgdGhpcyBjb21tYW5kIGhhZCBhIHBsdWdpbiBub3QgaGFuZGxlZCBpdCwgc28gdGhlIGRlZmF1bHQgYmVoYXZpb3JcbiAgICAgICAgLy8gaXMgdG8gZG8gdGhlIHByb3h5IGFuZCByZXRyaWV2ZSB0aGUgcmVzdWx0IGludGVybmFsbHkgc28gaXQgY2FuIGJlIHBhc3NlZCB0byB0aGUgcGx1Z2luXG4gICAgICAgIC8vIGluIGNhc2UgaXQgY2FsbHMgJ2F3YWl0IG5leHQoKScuIFRoaXMgcmVxdWlyZXMgdGhhdCB0aGUgZHJpdmVyIGhhdmUgZGVmaW5lZFxuICAgICAgICAvLyAncHJveHlDb21tYW5kJyBhbmQgbm90IGp1c3QgJ3Byb3h5UmVxUmVzJy5cbiAgICAgICAgaWYgKCFkc3RTZXNzaW9uLnByb3h5Q29tbWFuZCkge1xuICAgICAgICAgIHRocm93IG5ldyBOb0RyaXZlclByb3h5Q29tbWFuZEVycm9yKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGF3YWl0IGRzdFNlc3Npb24ucHJveHlDb21tYW5kKHJlcUZvclByb3h5Lm9yaWdpbmFsVXJsLCByZXFGb3JQcm94eS5tZXRob2QsXG4gICAgICAgICAgcmVxRm9yUHJveHkuYm9keSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChpc0dldFN0YXR1cykge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRTdGF0dXMoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGlzVW1icmVsbGFDbWQpIHtcbiAgICAgICAgLy8gc29tZSBjb21tYW5kcywgbGlrZSBkZWxldGVTZXNzaW9uLCB3ZSB3YW50IHRvIG1ha2Ugc3VyZSB0byBoYW5kbGUgb24gKnRoaXMqIGRyaXZlcixcbiAgICAgICAgLy8gbm90IHRoZSBwbGF0Zm9ybSBkcml2ZXJcbiAgICAgICAgcmV0dXJuIGF3YWl0IEJhc2VEcml2ZXIucHJvdG90eXBlLmV4ZWN1dGVDb21tYW5kLmNhbGwodGhpcywgY21kLCAuLi5hcmdzKTtcbiAgICAgIH1cblxuICAgICAgLy8gaGVyZSB3ZSBrbm93IHRoYXQgd2UgYXJlIGV4ZWN1dGluZyBhIHNlc3Npb24gY29tbWFuZCwgYW5kIGhhdmUgYSB2YWxpZCBzZXNzaW9uIGRyaXZlclxuICAgICAgcmV0dXJuIGF3YWl0IGRzdFNlc3Npb24uZXhlY3V0ZUNvbW1hbmQoY21kLCAuLi5hcmdzKTtcbiAgICB9O1xuXG4gICAgLy8gbm93IHRha2Ugb3VyIGRlZmF1bHQgYmVoYXZpb3IsIHdyYXAgaXQgd2l0aCBhbnkgbnVtYmVyIG9mIHBsdWdpbiBiZWhhdmlvcnMsIGFuZCBydW4gaXRcbiAgICBjb25zdCB3cmFwcGVkQ21kID0gdGhpcy53cmFwQ29tbWFuZFdpdGhQbHVnaW5zKHtcbiAgICAgIGRyaXZlciwgY21kLCBhcmdzLCBwbHVnaW5zLCBjbWRIYW5kbGVkQnksIG5leHQ6IGRlZmF1bHRCZWhhdmlvclxuICAgIH0pO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZXhlY3V0ZVdyYXBwZWRDb21tYW5kKHt3cmFwcGVkQ21kLCBwcm90b2NvbH0pO1xuXG4gICAgLy8gaWYgd2UgaGFkIHBsdWdpbnMsIG1ha2Ugc3VyZSB0byBsb2cgb3V0IHRoZSBoZWxwZnVsIHJlcG9ydCBhYm91dCB3aGljaCBwbHVnaW5zIGVuZGVkIHVwXG4gICAgLy8gaGFuZGxpbmcgdGhlIGNvbW1hbmQgYW5kIHdoaWNoIGRpZG4ndFxuICAgIHRoaXMubG9nUGx1Z2luSGFuZGxlclJlcG9ydChwbHVnaW5zLCB7Y21kLCBjbWRIYW5kbGVkQnl9KTtcblxuICAgIC8vIEFuZCBmaW5hbGx5LCBpZiB0aGUgY29tbWFuZCB3YXMgY3JlYXRlU2Vzc2lvbiwgd2Ugd2FudCB0byBtaWdyYXRlIGFueSBwbHVnaW5zIHdoaWNoIHdlcmVcbiAgICAvLyBwcmV2aW91c2x5IHNlc3Npb25sZXNzIHRvIHVzZSB0aGUgbmV3IHNlc3Npb25JZCwgc28gdGhhdCBwbHVnaW5zIGNhbiBzaGFyZSBzdGF0ZSBiZXR3ZWVuXG4gICAgLy8gdGhlaXIgY3JlYXRlU2Vzc2lvbiBtZXRob2QgYW5kIG90aGVyIGluc3RhbmNlIG1ldGhvZHNcbiAgICBpZiAoY21kID09PSBDUkVBVEVfU0VTU0lPTl9DT01NQU5EICYmIHRoaXMuc2Vzc2lvbmxlc3NQbHVnaW5zLmxlbmd0aCAmJiAhcmVzLmVycm9yKSB7XG4gICAgICBjb25zdCBzZXNzaW9uSWQgPSBfLmZpcnN0KHJlcy52YWx1ZSk7XG4gICAgICB0aGlzLmxvZy5pbmZvKGBQcm9tb3RpbmcgJHt0aGlzLnNlc3Npb25sZXNzUGx1Z2lucy5sZW5ndGh9IHNlc3Npb25sZXNzIHBsdWdpbnMgdG8gYmUgYXR0YWNoZWQgYCArXG4gICAgICAgIGB0byBzZXNzaW9uIElEICR7c2Vzc2lvbklkfWApO1xuICAgICAgdGhpcy5zZXNzaW9uUGx1Z2luc1tzZXNzaW9uSWRdID0gdGhpcy5zZXNzaW9ubGVzc1BsdWdpbnM7XG4gICAgICB0aGlzLnNlc3Npb25sZXNzUGx1Z2lucyA9IFtdO1xuICAgIH1cblxuICAgIHJldHVybiByZXM7XG4gIH1cblxuICB3cmFwQ29tbWFuZFdpdGhQbHVnaW5zICh7ZHJpdmVyLCBjbWQsIGFyZ3MsIG5leHQsIGNtZEhhbmRsZWRCeSwgcGx1Z2luc30pIHtcbiAgICBwbHVnaW5zLmxlbmd0aCAmJiB0aGlzLmxvZy5pbmZvKGBQbHVnaW5zIHdoaWNoIGNhbiBoYW5kbGUgY21kICcke2NtZH0nOiAke3BsdWdpbnMubWFwKChwKSA9PiBwLm5hbWUpfWApO1xuXG4gICAgLy8gbm93IHdlIGNhbiBnbyB0aHJvdWdoIGVhY2ggcGx1Z2luIGFuZCB3cmFwIGBuZXh0YCBhcm91bmQgaXRzIG93biBoYW5kbGVyLCBwYXNzaW5nIHRoZSAqb2xkKlxuICAgIC8vIG5leHQgaW4gc28gdGhhdCBpdCBjYW4gY2FsbCBpdCBpZiBpdCB3YW50cyB0b1xuICAgIGZvciAoY29uc3QgcGx1Z2luIG9mIHBsdWdpbnMpIHtcbiAgICAgIC8vIG5lZWQgYW4gSUlGRSBoZXJlIGJlY2F1c2Ugd2Ugd2FudCB0aGUgdmFsdWUgb2YgbmV4dCB0aGF0J3MgcGFzc2VkIHRvIHBsdWdpbi5oYW5kbGUgdG8gYmVcbiAgICAgIC8vIGV4YWN0bHkgdGhlIHZhbHVlIG9mIG5leHQgaGVyZSBiZWZvcmUgcmVhc3NpZ25tZW50OyB3ZSBkb24ndCB3YW50IGl0IHRvIGJlIGxhemlseVxuICAgICAgLy8gZXZhbHVhdGVkLCBvdGhlcndpc2Ugd2UgZW5kIHVwIHdpdGggaW5maW5pdGUgcmVjdXJzaW9uIG9mIHRoZSBsYXN0IGBuZXh0YCB0byBiZSBkZWZpbmVkLlxuICAgICAgY21kSGFuZGxlZEJ5W3BsdWdpbi5uYW1lXSA9IGZhbHNlOyAvLyB3ZSBzZWUgYSBuZXcgcGx1Z2luLCBzbyBhZGQgaXQgdG8gdGhlICdjbWRIYW5kbGVkQnknIG9iamVjdFxuICAgICAgbmV4dCA9ICgoX25leHQpID0+IGFzeW5jICgpID0+IHtcbiAgICAgICAgdGhpcy5sb2cuaW5mbyhgUGx1Z2luICR7cGx1Z2luLm5hbWV9IGlzIG5vdyBoYW5kbGluZyBjbWQgJyR7Y21kfSdgKTtcbiAgICAgICAgY21kSGFuZGxlZEJ5W3BsdWdpbi5uYW1lXSA9IHRydWU7IC8vIGlmIHdlIG1ha2UgaXQgaGVyZSwgdGhpcyBwbHVnaW4gaGFzIGF0dGVtcHRlZCB0byBoYW5kbGUgY21kXG4gICAgICAgIC8vIGZpcnN0IGF0dGVtcHQgdG8gaGFuZGxlIHRoZSBjb21tYW5kIHZpYSBhIGNvbW1hbmQtc3BlY2lmaWMgaGFuZGxlciBvbiB0aGUgcGx1Z2luXG4gICAgICAgIGlmIChwbHVnaW5bY21kXSkge1xuICAgICAgICAgIHJldHVybiBhd2FpdCBwbHVnaW5bY21kXShfbmV4dCwgZHJpdmVyLCAuLi5hcmdzKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBvdGhlcndpc2UsIGNhbGwgdGhlIGdlbmVyaWMgJ2hhbmRsZScgbWV0aG9kXG4gICAgICAgIHJldHVybiBhd2FpdCBwbHVnaW4uaGFuZGxlKF9uZXh0LCBkcml2ZXIsIGNtZCwgLi4uYXJncyk7XG4gICAgICB9KShuZXh0KTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV4dDtcbiAgfVxuXG4gIGxvZ1BsdWdpbkhhbmRsZXJSZXBvcnQgKHBsdWdpbnMsIHtjbWQsIGNtZEhhbmRsZWRCeX0pIHtcbiAgICBpZiAoIXBsdWdpbnMubGVuZ3RoKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gYXQgdGhlIGVuZCBvZiB0aGUgZGF5LCB3ZSBoYXZlIGFuIG9iamVjdCByZXByZXNlbnRpbmcgd2hpY2ggcGx1Z2lucyBlbmRlZCB1cCBnZXR0aW5nXG4gICAgLy8gdGhlaXIgY29kZSBydW4gYXMgcGFydCBvZiBoYW5kbGluZyB0aGlzIGNvbW1hbmQuIEJlY2F1c2UgcGx1Z2lucyBjYW4gY2hvb3NlICpub3QqIHRvXG4gICAgLy8gcGFzcyBjb250cm9sIHRvIG90aGVyIHBsdWdpbnMgb3IgdG8gdGhlIGRlZmF1bHQgZHJpdmVyIGJlaGF2aW9yLCB0aGlzIGlzIGluZm9ybWF0aW9uXG4gICAgLy8gd2hpY2ggaXMgcHJvYmFibHkgdXNlZnVsIHRvIHRoZSB1c2VyIChlc3BlY2lhbGx5IGluIHNpdHVhdGlvbnMgd2hlcmUgcGx1Z2lucyBtaWdodCBub3RcbiAgICAvLyBpbnRlcmFjdCB3ZWxsIHRvZ2V0aGVyLCBhbmQgaXQgd291bGQgYmUgaGFyZCB0byBkZWJ1ZyBvdGhlcndpc2Ugd2l0aG91dCB0aGlzIGtpbmQgb2ZcbiAgICAvLyBtZXNzYWdlKS5cbiAgICBjb25zdCBkaWRIYW5kbGUgPSBPYmplY3Qua2V5cyhjbWRIYW5kbGVkQnkpLmZpbHRlcigoaykgPT4gY21kSGFuZGxlZEJ5W2tdKTtcbiAgICBjb25zdCBkaWRudEhhbmRsZSA9IE9iamVjdC5rZXlzKGNtZEhhbmRsZWRCeSkuZmlsdGVyKChrKSA9PiAhY21kSGFuZGxlZEJ5W2tdKTtcbiAgICBpZiAoZGlkbnRIYW5kbGUubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5sb2cuaW5mbyhgQ29tbWFuZCAnJHtjbWR9JyB3YXMgKm5vdCogaGFuZGxlZCBieSB0aGUgZm9sbG93aW5nIGJlaGF2aW91cnMgb3IgcGx1Z2lucywgZXZlbiBgICtcbiAgICAgICAgYHRob3VnaCB0aGV5IHdlcmUgcmVnaXN0ZXJlZCB0byBoYW5kbGUgaXQ6ICR7SlNPTi5zdHJpbmdpZnkoZGlkbnRIYW5kbGUpfS4gVGhlIGAgK1xuICAgICAgICBgY29tbWFuZCAqd2FzKiBoYW5kbGVkIGJ5IHRoZXNlOiAke0pTT04uc3RyaW5naWZ5KGRpZEhhbmRsZSl9LmApO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGVXcmFwcGVkQ29tbWFuZCAoe3dyYXBwZWRDbWQsIHByb3RvY29sfSkge1xuICAgIGxldCBjbWRSZXMsIGNtZEVyciwgcmVzID0ge307XG4gICAgdHJ5IHtcbiAgICAgIC8vIEF0IHRoaXMgcG9pbnQsIGB3cmFwcGVkQ21kYCBkZWZpbmVzIGEgd2hvbGUgc2VxdWVuY2Ugb2YgcGx1Z2luIGhhbmRsZXJzLCBjdWxtaW5hdGluZyBpblxuICAgICAgLy8gb3VyIGRlZmF1bHQgaGFuZGxlci4gV2hhdGV2ZXIgaXQgcmV0dXJucyBpcyB3aGF0IHdlJ3JlIGdvaW5nIHRvIHdhbnQgdG8gc2VuZCBiYWNrIHRvIHRoZVxuICAgICAgLy8gdXNlci5cbiAgICAgIGNtZFJlcyA9IGF3YWl0IHdyYXBwZWRDbWQoKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjbWRFcnIgPSBlO1xuICAgIH1cblxuICAgIC8vIFNhZGx5LCB3ZSBkb24ndCBrbm93IGV4YWN0bHkgd2hhdCBraW5kIG9mIG9iamVjdCB3aWxsIGJlIHJldHVybmVkLiBJdCB3aWxsIGVpdGhlciBiZSBhIGJhcmVcbiAgICAvLyBvYmplY3QsIG9yIGEgcHJvdG9jb2wtYXdhcmUgb2JqZWN0IHdpdGggcHJvdG9jb2wgYW5kIGVycm9yL3ZhbHVlIGtleXMuIFNvIHdlIG5lZWQgdG8gc25pZmZcbiAgICAvLyBpdCBhbmQgbWFrZSBzdXJlIHdlIGRvbid0IGRvdWJsZS13cmFwIGl0IGlmIGl0J3MgdGhlIGxhdHRlciBraW5kLlxuICAgIGlmIChfLmlzUGxhaW5PYmplY3QoY21kUmVzKSAmJiBfLmhhcyhjbWRSZXMsICdwcm90b2NvbCcpKSB7XG4gICAgICByZXMgPSBjbWRSZXM7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlcy52YWx1ZSA9IGNtZFJlcztcbiAgICAgIHJlcy5lcnJvciA9IGNtZEVycjtcbiAgICAgIHJlcy5wcm90b2NvbCA9IHByb3RvY29sO1xuICAgIH1cbiAgICByZXR1cm4gcmVzO1xuICB9XG5cbiAgcHJveHlBY3RpdmUgKHNlc3Npb25JZCkge1xuICAgIGNvbnN0IGRzdFNlc3Npb24gPSB0aGlzLnNlc3Npb25zW3Nlc3Npb25JZF07XG4gICAgcmV0dXJuIGRzdFNlc3Npb24gJiYgXy5pc0Z1bmN0aW9uKGRzdFNlc3Npb24ucHJveHlBY3RpdmUpICYmIGRzdFNlc3Npb24ucHJveHlBY3RpdmUoc2Vzc2lvbklkKTtcbiAgfVxuXG4gIGdldFByb3h5QXZvaWRMaXN0IChzZXNzaW9uSWQpIHtcbiAgICBjb25zdCBkc3RTZXNzaW9uID0gdGhpcy5zZXNzaW9uc1tzZXNzaW9uSWRdO1xuICAgIHJldHVybiBkc3RTZXNzaW9uID8gZHN0U2Vzc2lvbi5nZXRQcm94eUF2b2lkTGlzdCgpIDogW107XG4gIH1cblxuICBjYW5Qcm94eSAoc2Vzc2lvbklkKSB7XG4gICAgY29uc3QgZHN0U2Vzc2lvbiA9IHRoaXMuc2Vzc2lvbnNbc2Vzc2lvbklkXTtcbiAgICByZXR1cm4gZHN0U2Vzc2lvbiAmJiBkc3RTZXNzaW9uLmNhblByb3h5KHNlc3Npb25JZCk7XG4gIH1cbn1cblxuLy8gaGVscCBkZWNpZGUgd2hpY2ggY29tbWFuZHMgc2hvdWxkIGJlIHByb3hpZWQgdG8gc3ViLWRyaXZlcnMgYW5kIHdoaWNoXG4vLyBzaG91bGQgYmUgaGFuZGxlZCBieSB0aGlzLCBvdXIgdW1icmVsbGEgZHJpdmVyXG5mdW5jdGlvbiBpc0FwcGl1bURyaXZlckNvbW1hbmQgKGNtZCkge1xuICByZXR1cm4gIWlzU2Vzc2lvbkNvbW1hbmQoY21kKSB8fCBjbWQgPT09IERFTEVURV9TRVNTSU9OX0NPTU1BTkQ7XG59XG5cbi8qKlxuICogVGhyb3duIHdoZW4gQXBwaXVtIHRyaWVkIHRvIHByb3h5IGEgY29tbWFuZCB1c2luZyBhIGRyaXZlcidzIGBwcm94eUNvbW1hbmRgIG1ldGhvZCBidXQgdGhlXG4gKiBtZXRob2QgZGlkIG5vdCBleGlzdFxuICovXG5leHBvcnQgY2xhc3MgTm9Ecml2ZXJQcm94eUNvbW1hbmRFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgLyoqXG4gICAqIEB0eXBlIHtSZWFkb25seTxzdHJpbmc+fVxuICAgKi9cbiAgY29kZSA9ICdBUFBJVU1FUlJfTk9fRFJJVkVSX1BST1hZQ09NTUFORCc7XG5cbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHN1cGVyKGBUaGUgZGVmYXVsdCBiZWhhdmlvciBmb3IgdGhpcyBjb21tYW5kIHdhcyB0byBwcm94eSwgYnV0IHRoZSBkcml2ZXIgYCArXG4gICAgICAgICAgYGRpZCBub3QgaGF2ZSB0aGUgJ3Byb3h5Q29tbWFuZCcgbWV0aG9kIGRlZmluZWQuIFRvIGZ1bGx5IHN1cHBvcnQgYCArXG4gICAgICAgICAgYHBsdWdpbnMsIGRyaXZlcnMgc2hvdWxkIGhhdmUgJ3Byb3h5Q29tbWFuZCcgc2V0IHRvIGEgandwUHJveHkgb2JqZWN0J3MgYCArXG4gICAgICAgICAgYCdjb21tYW5kKCknIG1ldGhvZCwgaW4gYWRkaXRpb24gdG8gdGhlIG5vcm1hbCAncHJveHlSZXFSZXMnYCk7XG4gIH1cbn1cblxuZXhwb3J0IHsgQXBwaXVtRHJpdmVyIH07XG5cbi8qKlxuICogQHR5cGVkZWYge2ltcG9ydCgnQGFwcGl1bS90eXBlcycpLkV4dGVybmFsRHJpdmVyfSBFeHRlcm5hbERyaXZlclxuICogQHR5cGVkZWYge2ltcG9ydCgnQGFwcGl1bS90eXBlcycpLlczQ0NhcGFiaWxpdGllc30gVzNDQ2FwYWJpbGl0aWVzXG4gKiBAdHlwZWRlZiB7aW1wb3J0KCdAYXBwaXVtL3R5cGVzJykuRHJpdmVyRGF0YX0gRHJpdmVyRGF0YVxuICogQHR5cGVkZWYge2ltcG9ydCgnQGFwcGl1bS90eXBlcycpLlNlcnZlckFyZ3N9IERyaXZlck9wdHNcbiAqIEB0eXBlZGVmIHtpbXBvcnQoJ0BhcHBpdW0vdHlwZXMnKS5Db25zdHJhaW50c30gQ29uc3RyYWludHNcbiAqIEB0eXBlZGVmIHtpbXBvcnQoJ0BhcHBpdW0vdHlwZXMnKS5BcHBpdW1TZXJ2ZXJ9IEFwcGl1bVNlcnZlclxuICogQHR5cGVkZWYge2ltcG9ydCgnLi4vdHlwZXMnKS5FeHRlbnNpb25UeXBlfSBFeHRlbnNpb25UeXBlXG4gKiBAdHlwZWRlZiB7aW1wb3J0KCcuLi90eXBlcy9leHRlbnNpb24nKS5QbHVnaW5DbGFzc30gUGx1Z2luQ2xhc3NcbiAqIEB0eXBlZGVmIHtpbXBvcnQoJy4vZXh0ZW5zaW9uL2RyaXZlci1jb25maWcnKS5Ecml2ZXJDb25maWd9IERyaXZlckNvbmZpZ1xuICovXG5cbi8qKlxuICogVXNlZCBieSB7QGxpbmtjb2RlIEFwcGl1bURyaXZlci5jcmVhdGVTZXNzaW9ufSBhbmQge0BsaW5rY29kZSBBcHBpdW1Ecml2ZXIuZGVsZXRlU2Vzc2lvbn0gdG8gZGVzY3JpYmVcbiAqIHJlc3VsdC5cbiAqIEB0ZW1wbGF0ZSBWXG4gKiBAdHlwZWRlZiBTZXNzaW9uSGFuZGxlclJlc3VsdFxuICogQHByb3BlcnR5IHtWfSBbdmFsdWVdXG4gKiBAcHJvcGVydHkge0Vycm9yfSBbZXJyb3JdXG4gKiBAcHJvcGVydHkge3N0cmluZ30gW3Byb3RvY29sXVxuICovXG5cbi8qKlxuICogQHR5cGVkZWYge2ltcG9ydCgnQGFwcGl1bS90eXBlcycpLlNlc3Npb25IYW5kbGVyPFNlc3Npb25IYW5kbGVyUmVzdWx0PGFueVtdPixTZXNzaW9uSGFuZGxlclJlc3VsdDx2b2lkPj59IFNlc3Npb25IYW5kbGVyXG4gKi9cbiJdfQ==