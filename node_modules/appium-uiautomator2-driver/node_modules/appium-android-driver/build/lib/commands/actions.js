"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.helpers = exports.default = exports.commands = void 0;

require("source-map-support/register");

var _androidHelpers = _interopRequireDefault(require("../android-helpers"));

var _support = require("@appium/support");

var _path = _interopRequireDefault(require("path"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _jimp = _interopRequireDefault(require("jimp"));

var _teen_process = require("teen_process");

const swipeStepsPerSec = 28;
const dragStepsPerSec = 40;
let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

commands.keyevent = async function keyevent(keycode, metastate = null) {
  this.log.warn('keyevent will be deprecated use pressKeyCode');
  return await this.pressKeyCode(keycode, metastate);
};

commands.pressKeyCode = async function pressKeyCode(keycode, metastate = null) {
  return await this.bootstrap.sendAction('pressKeyCode', {
    keycode,
    metastate
  });
};

commands.longPressKeyCode = async function longPressKeyCode(keycode, metastate = null) {
  return await this.bootstrap.sendAction('longPressKeyCode', {
    keycode,
    metastate
  });
};

commands.getOrientation = async function getOrientation() {
  let params = {
    naturalOrientation: !!this.opts.androidNaturalOrientation
  };
  let orientation = await this.bootstrap.sendAction('orientation', params);
  return orientation.toUpperCase();
};

commands.setOrientation = async function setOrientation(orientation) {
  orientation = orientation.toUpperCase();
  let params = {
    orientation,
    naturalOrientation: !!this.opts.androidNaturalOrientation
  };
  return await this.bootstrap.sendAction('orientation', params);
};

commands.fakeFlick = async function fakeFlick(xSpeed, ySpeed) {
  return await this.bootstrap.sendAction('flick', {
    xSpeed,
    ySpeed
  });
};

commands.fakeFlickElement = async function fakeFlickElement(elementId, xoffset, yoffset, speed) {
  let params = {
    xoffset,
    yoffset,
    speed,
    elementId
  };
  return await this.bootstrap.sendAction('element:flick', params);
};

commands.swipe = async function swipe(startX, startY, endX, endY, duration, touchCount, elId) {
  if (startX === 'null') {
    startX = 0.5;
  }

  if (startY === 'null') {
    startY = 0.5;
  }

  let swipeOpts = {
    startX,
    startY,
    endX,
    endY,
    steps: Math.round(duration * swipeStepsPerSec)
  };

  if (_support.util.hasValue(elId)) {
    swipeOpts.elementId = elId;
  }

  return await this.doSwipe(swipeOpts);
};

commands.doSwipe = async function doSwipe(swipeOpts) {
  if (_support.util.hasValue(swipeOpts.elementId)) {
    return await this.bootstrap.sendAction('element:swipe', swipeOpts);
  } else {
    return await this.bootstrap.sendAction('swipe', swipeOpts);
  }
};

commands.pinchClose = async function pinchClose(startX, startY, endX, endY, duration, percent, steps, elId) {
  let pinchOpts = {
    direction: 'in',
    elementId: elId,
    percent,
    steps
  };
  return await this.bootstrap.sendAction('element:pinch', pinchOpts);
};

commands.pinchOpen = async function pinchOpen(startX, startY, endX, endY, duration, percent, steps, elId) {
  let pinchOpts = {
    direction: 'out',
    elementId: elId,
    percent,
    steps
  };
  return await this.bootstrap.sendAction('element:pinch', pinchOpts);
};

commands.flick = async function flick(element, xSpeed, ySpeed, xOffset, yOffset, speed) {
  if (element) {
    await this.fakeFlickElement(element, xOffset, yOffset, speed);
  } else {
    await this.fakeFlick(xSpeed, ySpeed);
  }
};

commands.drag = async function drag(startX, startY, endX, endY, duration, touchCount, elementId, destElId) {
  let dragOpts = {
    elementId,
    destElId,
    startX,
    startY,
    endX,
    endY,
    steps: Math.round(duration * dragStepsPerSec)
  };
  return await this.doDrag(dragOpts);
};

commands.doDrag = async function doDrag(dragOpts) {
  if (_support.util.hasValue(dragOpts.elementId)) {
    return await this.bootstrap.sendAction('element:drag', dragOpts);
  } else {
    return await this.bootstrap.sendAction('drag', dragOpts);
  }
};

commands.lock = async function lock(seconds) {
  await this.adb.lock();

  if (isNaN(seconds)) {
    return;
  }

  const floatSeconds = parseFloat(seconds);

  if (floatSeconds <= 0) {
    return;
  }

  await _bluebird.default.delay(1000 * floatSeconds);
  await this.unlock();
};

commands.isLocked = async function isLocked() {
  return await this.adb.isScreenLocked();
};

commands.unlock = async function unlock() {
  return await _androidHelpers.default.unlock(this, this.adb, this.caps);
};

commands.openNotifications = async function openNotifications() {
  return await this.bootstrap.sendAction('openNotification');
};

commands.setLocation = async function setLocation(latitude, longitude) {
  return await this.adb.sendTelnetCommand(`geo fix ${longitude} ${latitude}`);
};

commands.fingerprint = async function fingerprint(fingerprintId) {
  if (!this.isEmulator()) {
    this.log.errorAndThrow('fingerprint method is only available for emulators');
  }

  await this.adb.fingerprint(fingerprintId);
};

commands.sendSMS = async function sendSMS(phoneNumber, message) {
  if (!this.isEmulator()) {
    this.log.errorAndThrow('sendSMS method is only available for emulators');
  }

  await this.adb.sendSMS(phoneNumber, message);
};

commands.gsmCall = async function gsmCall(phoneNumber, action) {
  if (!this.isEmulator()) {
    this.log.errorAndThrow('gsmCall method is only available for emulators');
  }

  await this.adb.gsmCall(phoneNumber, action);
};

commands.gsmSignal = async function gsmSignal(signalStrengh) {
  if (!this.isEmulator()) {
    this.log.errorAndThrow('gsmSignal method is only available for emulators');
  }

  await this.adb.gsmSignal(signalStrengh);
};

commands.gsmVoice = async function gsmVoice(state) {
  if (!this.isEmulator()) {
    this.log.errorAndThrow('gsmVoice method is only available for emulators');
  }

  await this.adb.gsmVoice(state);
};

commands.powerAC = async function powerAC(state) {
  if (!this.isEmulator()) {
    this.log.errorAndThrow('powerAC method is only available for emulators');
  }

  await this.adb.powerAC(state);
};

commands.powerCapacity = async function powerCapacity(batteryPercent) {
  if (!this.isEmulator()) {
    this.log.errorAndThrow('powerCapacity method is only available for emulators');
  }

  await this.adb.powerCapacity(batteryPercent);
};

commands.networkSpeed = async function networkSpeed(networkSpeed) {
  if (!this.isEmulator()) {
    this.log.errorAndThrow('networkSpeed method is only available for emulators');
  }

  await this.adb.networkSpeed(networkSpeed);
};

commands.sensorSet = async function sensorSet(sensor = {}) {
  const {
    sensorType,
    value
  } = sensor;

  if (!_support.util.hasValue(sensorType)) {
    this.log.errorAndThrow(`'sensorType' argument is required`);
  }

  if (!_support.util.hasValue(value)) {
    this.log.errorAndThrow(`'value' argument is required`);
  }

  if (!this.isEmulator()) {
    this.log.errorAndThrow('sensorSet method is only available for emulators');
  }

  await this.adb.sensorSet(sensorType, value);
};

helpers.getScreenshotDataWithAdbShell = async function getScreenshotDataWithAdbShell(adb, opts) {
  const localFile = await _support.tempDir.path({
    prefix: 'appium',
    suffix: '.png'
  });

  if (await _support.fs.exists(localFile)) {
    await _support.fs.unlink(localFile);
  }

  try {
    const pngDir = opts.androidScreenshotPath || '/data/local/tmp/';

    const png = _path.default.posix.resolve(pngDir, 'screenshot.png');

    const cmd = ['/system/bin/rm', `${png};`, '/system/bin/screencap', '-p', png];
    await adb.shell(cmd);

    if (!(await adb.fileSize(png))) {
      throw new Error('The size of the taken screenshot equals to zero.');
    }

    await adb.pull(png, localFile);
    return await _jimp.default.read(localFile);
  } finally {
    if (await _support.fs.exists(localFile)) {
      await _support.fs.unlink(localFile);
    }
  }
};

helpers.getScreenshotDataWithAdbExecOut = async function getScreenshotDataWithAdbExecOut(adb) {
  let {
    stdout,
    stderr,
    code
  } = await (0, _teen_process.exec)(adb.executable.path, adb.executable.defaultArgs.concat(['exec-out', '/system/bin/screencap', '-p']), {
    encoding: 'binary',
    isBuffer: true
  });

  if (code || stderr.length) {
    throw new Error(`Screenshot returned error, code: '${code}', stderr: '${stderr.toString()}'`);
  }

  if (!stdout.length) {
    throw new Error('Screenshot returned no data');
  }

  return await _jimp.default.read(stdout);
};

commands.getScreenshot = async function getScreenshot() {
  const apiLevel = await this.adb.getApiLevel();
  let image = null;

  if (apiLevel > 20) {
    try {
      image = await this.getScreenshotDataWithAdbExecOut(this.adb);
    } catch (e) {
      this.log.info(`Cannot get screenshot data with 'adb exec-out' because of '${e.message}'. ` + `Defaulting to 'adb shell' call`);
    }
  }

  if (!image) {
    try {
      image = await this.getScreenshotDataWithAdbShell(this.adb, this.opts);
    } catch (e) {
      const err = `Cannot get screenshot data because of '${e.message}'. ` + `Make sure the 'LayoutParams.FLAG_SECURE' is not set for ` + `the current view`;
      this.log.errorAndThrow(err);
    }
  }

  if (apiLevel < 23) {
    let screenOrientation = await this.adb.getScreenOrientation();

    try {
      image = await image.rotate(-90 * screenOrientation);
    } catch (err) {
      this.log.warn(`Could not rotate screenshot due to error: ${err}`);
    }
  }

  const getBuffer = _bluebird.default.promisify(image.getBuffer, {
    context: image
  });

  const imgBuffer = await getBuffer(_jimp.default.MIME_PNG);
  return imgBuffer.toString('base64');
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9hY3Rpb25zLmpzIl0sIm5hbWVzIjpbInN3aXBlU3RlcHNQZXJTZWMiLCJkcmFnU3RlcHNQZXJTZWMiLCJjb21tYW5kcyIsImhlbHBlcnMiLCJleHRlbnNpb25zIiwia2V5ZXZlbnQiLCJrZXljb2RlIiwibWV0YXN0YXRlIiwibG9nIiwid2FybiIsInByZXNzS2V5Q29kZSIsImJvb3RzdHJhcCIsInNlbmRBY3Rpb24iLCJsb25nUHJlc3NLZXlDb2RlIiwiZ2V0T3JpZW50YXRpb24iLCJwYXJhbXMiLCJuYXR1cmFsT3JpZW50YXRpb24iLCJvcHRzIiwiYW5kcm9pZE5hdHVyYWxPcmllbnRhdGlvbiIsIm9yaWVudGF0aW9uIiwidG9VcHBlckNhc2UiLCJzZXRPcmllbnRhdGlvbiIsImZha2VGbGljayIsInhTcGVlZCIsInlTcGVlZCIsImZha2VGbGlja0VsZW1lbnQiLCJlbGVtZW50SWQiLCJ4b2Zmc2V0IiwieW9mZnNldCIsInNwZWVkIiwic3dpcGUiLCJzdGFydFgiLCJzdGFydFkiLCJlbmRYIiwiZW5kWSIsImR1cmF0aW9uIiwidG91Y2hDb3VudCIsImVsSWQiLCJzd2lwZU9wdHMiLCJzdGVwcyIsIk1hdGgiLCJyb3VuZCIsInV0aWwiLCJoYXNWYWx1ZSIsImRvU3dpcGUiLCJwaW5jaENsb3NlIiwicGVyY2VudCIsInBpbmNoT3B0cyIsImRpcmVjdGlvbiIsInBpbmNoT3BlbiIsImZsaWNrIiwiZWxlbWVudCIsInhPZmZzZXQiLCJ5T2Zmc2V0IiwiZHJhZyIsImRlc3RFbElkIiwiZHJhZ09wdHMiLCJkb0RyYWciLCJsb2NrIiwic2Vjb25kcyIsImFkYiIsImlzTmFOIiwiZmxvYXRTZWNvbmRzIiwicGFyc2VGbG9hdCIsIkIiLCJkZWxheSIsInVubG9jayIsImlzTG9ja2VkIiwiaXNTY3JlZW5Mb2NrZWQiLCJhbmRyb2lkSGVscGVycyIsImNhcHMiLCJvcGVuTm90aWZpY2F0aW9ucyIsInNldExvY2F0aW9uIiwibGF0aXR1ZGUiLCJsb25naXR1ZGUiLCJzZW5kVGVsbmV0Q29tbWFuZCIsImZpbmdlcnByaW50IiwiZmluZ2VycHJpbnRJZCIsImlzRW11bGF0b3IiLCJlcnJvckFuZFRocm93Iiwic2VuZFNNUyIsInBob25lTnVtYmVyIiwibWVzc2FnZSIsImdzbUNhbGwiLCJhY3Rpb24iLCJnc21TaWduYWwiLCJzaWduYWxTdHJlbmdoIiwiZ3NtVm9pY2UiLCJzdGF0ZSIsInBvd2VyQUMiLCJwb3dlckNhcGFjaXR5IiwiYmF0dGVyeVBlcmNlbnQiLCJuZXR3b3JrU3BlZWQiLCJzZW5zb3JTZXQiLCJzZW5zb3IiLCJzZW5zb3JUeXBlIiwidmFsdWUiLCJnZXRTY3JlZW5zaG90RGF0YVdpdGhBZGJTaGVsbCIsImxvY2FsRmlsZSIsInRlbXBEaXIiLCJwYXRoIiwicHJlZml4Iiwic3VmZml4IiwiZnMiLCJleGlzdHMiLCJ1bmxpbmsiLCJwbmdEaXIiLCJhbmRyb2lkU2NyZWVuc2hvdFBhdGgiLCJwbmciLCJwb3NpeCIsInJlc29sdmUiLCJjbWQiLCJzaGVsbCIsImZpbGVTaXplIiwiRXJyb3IiLCJwdWxsIiwiamltcCIsInJlYWQiLCJnZXRTY3JlZW5zaG90RGF0YVdpdGhBZGJFeGVjT3V0Iiwic3Rkb3V0Iiwic3RkZXJyIiwiY29kZSIsImV4ZWN1dGFibGUiLCJkZWZhdWx0QXJncyIsImNvbmNhdCIsImVuY29kaW5nIiwiaXNCdWZmZXIiLCJsZW5ndGgiLCJ0b1N0cmluZyIsImdldFNjcmVlbnNob3QiLCJhcGlMZXZlbCIsImdldEFwaUxldmVsIiwiaW1hZ2UiLCJlIiwiaW5mbyIsImVyciIsInNjcmVlbk9yaWVudGF0aW9uIiwiZ2V0U2NyZWVuT3JpZW50YXRpb24iLCJyb3RhdGUiLCJnZXRCdWZmZXIiLCJwcm9taXNpZnkiLCJjb250ZXh0IiwiaW1nQnVmZmVyIiwiTUlNRV9QTkciLCJPYmplY3QiLCJhc3NpZ24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsTUFBTUEsZ0JBQWdCLEdBQUcsRUFBekI7QUFDQSxNQUFNQyxlQUFlLEdBQUcsRUFBeEI7QUFFQSxJQUFJQyxRQUFRLEdBQUcsRUFBZjtBQUFBLElBQW1CQyxPQUFPLEdBQUcsRUFBN0I7QUFBQSxJQUFpQ0MsVUFBVSxHQUFHLEVBQTlDOzs7O0FBRUFGLFFBQVEsQ0FBQ0csUUFBVCxHQUFvQixlQUFlQSxRQUFmLENBQXlCQyxPQUF6QixFQUFrQ0MsU0FBUyxHQUFHLElBQTlDLEVBQW9EO0FBRXRFLE9BQUtDLEdBQUwsQ0FBU0MsSUFBVCxDQUFjLDhDQUFkO0FBQ0EsU0FBTyxNQUFNLEtBQUtDLFlBQUwsQ0FBa0JKLE9BQWxCLEVBQTJCQyxTQUEzQixDQUFiO0FBQ0QsQ0FKRDs7QUFNQUwsUUFBUSxDQUFDUSxZQUFULEdBQXdCLGVBQWVBLFlBQWYsQ0FBNkJKLE9BQTdCLEVBQXNDQyxTQUFTLEdBQUcsSUFBbEQsRUFBd0Q7QUFDOUUsU0FBTyxNQUFNLEtBQUtJLFNBQUwsQ0FBZUMsVUFBZixDQUEwQixjQUExQixFQUEwQztBQUFDTixJQUFBQSxPQUFEO0FBQVVDLElBQUFBO0FBQVYsR0FBMUMsQ0FBYjtBQUNELENBRkQ7O0FBSUFMLFFBQVEsQ0FBQ1csZ0JBQVQsR0FBNEIsZUFBZUEsZ0JBQWYsQ0FBaUNQLE9BQWpDLEVBQTBDQyxTQUFTLEdBQUcsSUFBdEQsRUFBNEQ7QUFDdEYsU0FBTyxNQUFNLEtBQUtJLFNBQUwsQ0FBZUMsVUFBZixDQUEwQixrQkFBMUIsRUFBOEM7QUFBQ04sSUFBQUEsT0FBRDtBQUFVQyxJQUFBQTtBQUFWLEdBQTlDLENBQWI7QUFDRCxDQUZEOztBQUlBTCxRQUFRLENBQUNZLGNBQVQsR0FBMEIsZUFBZUEsY0FBZixHQUFpQztBQUN6RCxNQUFJQyxNQUFNLEdBQUc7QUFDWEMsSUFBQUEsa0JBQWtCLEVBQUUsQ0FBQyxDQUFDLEtBQUtDLElBQUwsQ0FBVUM7QUFEckIsR0FBYjtBQUdBLE1BQUlDLFdBQVcsR0FBRyxNQUFNLEtBQUtSLFNBQUwsQ0FBZUMsVUFBZixDQUEwQixhQUExQixFQUF5Q0csTUFBekMsQ0FBeEI7QUFDQSxTQUFPSSxXQUFXLENBQUNDLFdBQVosRUFBUDtBQUNELENBTkQ7O0FBUUFsQixRQUFRLENBQUNtQixjQUFULEdBQTBCLGVBQWVBLGNBQWYsQ0FBK0JGLFdBQS9CLEVBQTRDO0FBQ3BFQSxFQUFBQSxXQUFXLEdBQUdBLFdBQVcsQ0FBQ0MsV0FBWixFQUFkO0FBQ0EsTUFBSUwsTUFBTSxHQUFHO0FBQ1hJLElBQUFBLFdBRFc7QUFFWEgsSUFBQUEsa0JBQWtCLEVBQUUsQ0FBQyxDQUFDLEtBQUtDLElBQUwsQ0FBVUM7QUFGckIsR0FBYjtBQUlBLFNBQU8sTUFBTSxLQUFLUCxTQUFMLENBQWVDLFVBQWYsQ0FBMEIsYUFBMUIsRUFBeUNHLE1BQXpDLENBQWI7QUFDRCxDQVBEOztBQVNBYixRQUFRLENBQUNvQixTQUFULEdBQXFCLGVBQWVBLFNBQWYsQ0FBMEJDLE1BQTFCLEVBQWtDQyxNQUFsQyxFQUEwQztBQUM3RCxTQUFPLE1BQU0sS0FBS2IsU0FBTCxDQUFlQyxVQUFmLENBQTBCLE9BQTFCLEVBQW1DO0FBQUNXLElBQUFBLE1BQUQ7QUFBU0MsSUFBQUE7QUFBVCxHQUFuQyxDQUFiO0FBQ0QsQ0FGRDs7QUFJQXRCLFFBQVEsQ0FBQ3VCLGdCQUFULEdBQTRCLGVBQWVBLGdCQUFmLENBQWlDQyxTQUFqQyxFQUE0Q0MsT0FBNUMsRUFBcURDLE9BQXJELEVBQThEQyxLQUE5RCxFQUFxRTtBQUMvRixNQUFJZCxNQUFNLEdBQUc7QUFBQ1ksSUFBQUEsT0FBRDtBQUFVQyxJQUFBQSxPQUFWO0FBQW1CQyxJQUFBQSxLQUFuQjtBQUEwQkgsSUFBQUE7QUFBMUIsR0FBYjtBQUNBLFNBQU8sTUFBTSxLQUFLZixTQUFMLENBQWVDLFVBQWYsQ0FBMEIsZUFBMUIsRUFBMkNHLE1BQTNDLENBQWI7QUFDRCxDQUhEOztBQUtBYixRQUFRLENBQUM0QixLQUFULEdBQWlCLGVBQWVBLEtBQWYsQ0FBc0JDLE1BQXRCLEVBQThCQyxNQUE5QixFQUFzQ0MsSUFBdEMsRUFBNENDLElBQTVDLEVBQWtEQyxRQUFsRCxFQUE0REMsVUFBNUQsRUFBd0VDLElBQXhFLEVBQThFO0FBQzdGLE1BQUlOLE1BQU0sS0FBSyxNQUFmLEVBQXVCO0FBQ3JCQSxJQUFBQSxNQUFNLEdBQUcsR0FBVDtBQUNEOztBQUNELE1BQUlDLE1BQU0sS0FBSyxNQUFmLEVBQXVCO0FBQ3JCQSxJQUFBQSxNQUFNLEdBQUcsR0FBVDtBQUNEOztBQUNELE1BQUlNLFNBQVMsR0FBRztBQUFDUCxJQUFBQSxNQUFEO0FBQVNDLElBQUFBLE1BQVQ7QUFBaUJDLElBQUFBLElBQWpCO0FBQXVCQyxJQUFBQSxJQUF2QjtBQUNDSyxJQUFBQSxLQUFLLEVBQUVDLElBQUksQ0FBQ0MsS0FBTCxDQUFXTixRQUFRLEdBQUduQyxnQkFBdEI7QUFEUixHQUFoQjs7QUFJQSxNQUFJMEMsY0FBS0MsUUFBTCxDQUFjTixJQUFkLENBQUosRUFBeUI7QUFDdkJDLElBQUFBLFNBQVMsQ0FBQ1osU0FBVixHQUFzQlcsSUFBdEI7QUFDRDs7QUFDRCxTQUFPLE1BQU0sS0FBS08sT0FBTCxDQUFhTixTQUFiLENBQWI7QUFDRCxDQWZEOztBQWlCQXBDLFFBQVEsQ0FBQzBDLE9BQVQsR0FBbUIsZUFBZUEsT0FBZixDQUF3Qk4sU0FBeEIsRUFBbUM7QUFDcEQsTUFBSUksY0FBS0MsUUFBTCxDQUFjTCxTQUFTLENBQUNaLFNBQXhCLENBQUosRUFBd0M7QUFDdEMsV0FBTyxNQUFNLEtBQUtmLFNBQUwsQ0FBZUMsVUFBZixDQUEwQixlQUExQixFQUEyQzBCLFNBQTNDLENBQWI7QUFDRCxHQUZELE1BRU87QUFDTCxXQUFPLE1BQU0sS0FBSzNCLFNBQUwsQ0FBZUMsVUFBZixDQUEwQixPQUExQixFQUFtQzBCLFNBQW5DLENBQWI7QUFDRDtBQUNGLENBTkQ7O0FBUUFwQyxRQUFRLENBQUMyQyxVQUFULEdBQXNCLGVBQWVBLFVBQWYsQ0FBMkJkLE1BQTNCLEVBQW1DQyxNQUFuQyxFQUEyQ0MsSUFBM0MsRUFBaURDLElBQWpELEVBQXVEQyxRQUF2RCxFQUFpRVcsT0FBakUsRUFBMEVQLEtBQTFFLEVBQWlGRixJQUFqRixFQUF1RjtBQUMzRyxNQUFJVSxTQUFTLEdBQUc7QUFDZEMsSUFBQUEsU0FBUyxFQUFFLElBREc7QUFFZHRCLElBQUFBLFNBQVMsRUFBRVcsSUFGRztBQUdkUyxJQUFBQSxPQUhjO0FBSWRQLElBQUFBO0FBSmMsR0FBaEI7QUFNQSxTQUFPLE1BQU0sS0FBSzVCLFNBQUwsQ0FBZUMsVUFBZixDQUEwQixlQUExQixFQUEyQ21DLFNBQTNDLENBQWI7QUFDRCxDQVJEOztBQVVBN0MsUUFBUSxDQUFDK0MsU0FBVCxHQUFxQixlQUFlQSxTQUFmLENBQTBCbEIsTUFBMUIsRUFBa0NDLE1BQWxDLEVBQTBDQyxJQUExQyxFQUFnREMsSUFBaEQsRUFBc0RDLFFBQXRELEVBQWdFVyxPQUFoRSxFQUF5RVAsS0FBekUsRUFBZ0ZGLElBQWhGLEVBQXNGO0FBQ3pHLE1BQUlVLFNBQVMsR0FBRztBQUFDQyxJQUFBQSxTQUFTLEVBQUUsS0FBWjtBQUFtQnRCLElBQUFBLFNBQVMsRUFBRVcsSUFBOUI7QUFBb0NTLElBQUFBLE9BQXBDO0FBQTZDUCxJQUFBQTtBQUE3QyxHQUFoQjtBQUNBLFNBQU8sTUFBTSxLQUFLNUIsU0FBTCxDQUFlQyxVQUFmLENBQTBCLGVBQTFCLEVBQTJDbUMsU0FBM0MsQ0FBYjtBQUNELENBSEQ7O0FBS0E3QyxRQUFRLENBQUNnRCxLQUFULEdBQWlCLGVBQWVBLEtBQWYsQ0FBc0JDLE9BQXRCLEVBQStCNUIsTUFBL0IsRUFBdUNDLE1BQXZDLEVBQStDNEIsT0FBL0MsRUFBd0RDLE9BQXhELEVBQWlFeEIsS0FBakUsRUFBd0U7QUFDdkYsTUFBSXNCLE9BQUosRUFBYTtBQUNYLFVBQU0sS0FBSzFCLGdCQUFMLENBQXNCMEIsT0FBdEIsRUFBK0JDLE9BQS9CLEVBQXdDQyxPQUF4QyxFQUFpRHhCLEtBQWpELENBQU47QUFDRCxHQUZELE1BRU87QUFDTCxVQUFNLEtBQUtQLFNBQUwsQ0FBZUMsTUFBZixFQUF1QkMsTUFBdkIsQ0FBTjtBQUNEO0FBQ0YsQ0FORDs7QUFRQXRCLFFBQVEsQ0FBQ29ELElBQVQsR0FBZ0IsZUFBZUEsSUFBZixDQUFxQnZCLE1BQXJCLEVBQTZCQyxNQUE3QixFQUFxQ0MsSUFBckMsRUFBMkNDLElBQTNDLEVBQWlEQyxRQUFqRCxFQUEyREMsVUFBM0QsRUFBdUVWLFNBQXZFLEVBQWtGNkIsUUFBbEYsRUFBNEY7QUFDMUcsTUFBSUMsUUFBUSxHQUFHO0FBQ2I5QixJQUFBQSxTQURhO0FBQ0Y2QixJQUFBQSxRQURFO0FBQ1F4QixJQUFBQSxNQURSO0FBQ2dCQyxJQUFBQSxNQURoQjtBQUN3QkMsSUFBQUEsSUFEeEI7QUFDOEJDLElBQUFBLElBRDlCO0FBRWJLLElBQUFBLEtBQUssRUFBRUMsSUFBSSxDQUFDQyxLQUFMLENBQVdOLFFBQVEsR0FBR2xDLGVBQXRCO0FBRk0sR0FBZjtBQUlBLFNBQU8sTUFBTSxLQUFLd0QsTUFBTCxDQUFZRCxRQUFaLENBQWI7QUFFRCxDQVBEOztBQVNBdEQsUUFBUSxDQUFDdUQsTUFBVCxHQUFrQixlQUFlQSxNQUFmLENBQXVCRCxRQUF2QixFQUFpQztBQUNqRCxNQUFJZCxjQUFLQyxRQUFMLENBQWNhLFFBQVEsQ0FBQzlCLFNBQXZCLENBQUosRUFBdUM7QUFDckMsV0FBTyxNQUFNLEtBQUtmLFNBQUwsQ0FBZUMsVUFBZixDQUEwQixjQUExQixFQUEwQzRDLFFBQTFDLENBQWI7QUFDRCxHQUZELE1BRU87QUFDTCxXQUFPLE1BQU0sS0FBSzdDLFNBQUwsQ0FBZUMsVUFBZixDQUEwQixNQUExQixFQUFrQzRDLFFBQWxDLENBQWI7QUFDRDtBQUNGLENBTkQ7O0FBUUF0RCxRQUFRLENBQUN3RCxJQUFULEdBQWdCLGVBQWVBLElBQWYsQ0FBcUJDLE9BQXJCLEVBQThCO0FBQzVDLFFBQU0sS0FBS0MsR0FBTCxDQUFTRixJQUFULEVBQU47O0FBQ0EsTUFBSUcsS0FBSyxDQUFDRixPQUFELENBQVQsRUFBb0I7QUFDbEI7QUFDRDs7QUFFRCxRQUFNRyxZQUFZLEdBQUdDLFVBQVUsQ0FBQ0osT0FBRCxDQUEvQjs7QUFDQSxNQUFJRyxZQUFZLElBQUksQ0FBcEIsRUFBdUI7QUFDckI7QUFDRDs7QUFDRCxRQUFNRSxrQkFBRUMsS0FBRixDQUFRLE9BQU9ILFlBQWYsQ0FBTjtBQUNBLFFBQU0sS0FBS0ksTUFBTCxFQUFOO0FBQ0QsQ0FaRDs7QUFjQWhFLFFBQVEsQ0FBQ2lFLFFBQVQsR0FBb0IsZUFBZUEsUUFBZixHQUEyQjtBQUM3QyxTQUFPLE1BQU0sS0FBS1AsR0FBTCxDQUFTUSxjQUFULEVBQWI7QUFDRCxDQUZEOztBQUlBbEUsUUFBUSxDQUFDZ0UsTUFBVCxHQUFrQixlQUFlQSxNQUFmLEdBQXlCO0FBQ3pDLFNBQU8sTUFBTUcsd0JBQWVILE1BQWYsQ0FBc0IsSUFBdEIsRUFBNEIsS0FBS04sR0FBakMsRUFBc0MsS0FBS1UsSUFBM0MsQ0FBYjtBQUNELENBRkQ7O0FBSUFwRSxRQUFRLENBQUNxRSxpQkFBVCxHQUE2QixlQUFlQSxpQkFBZixHQUFvQztBQUMvRCxTQUFPLE1BQU0sS0FBSzVELFNBQUwsQ0FBZUMsVUFBZixDQUEwQixrQkFBMUIsQ0FBYjtBQUNELENBRkQ7O0FBSUFWLFFBQVEsQ0FBQ3NFLFdBQVQsR0FBdUIsZUFBZUEsV0FBZixDQUE0QkMsUUFBNUIsRUFBc0NDLFNBQXRDLEVBQWlEO0FBQ3RFLFNBQU8sTUFBTSxLQUFLZCxHQUFMLENBQVNlLGlCQUFULENBQTRCLFdBQVVELFNBQVUsSUFBR0QsUUFBUyxFQUE1RCxDQUFiO0FBQ0QsQ0FGRDs7QUFJQXZFLFFBQVEsQ0FBQzBFLFdBQVQsR0FBdUIsZUFBZUEsV0FBZixDQUE0QkMsYUFBNUIsRUFBMkM7QUFDaEUsTUFBSSxDQUFDLEtBQUtDLFVBQUwsRUFBTCxFQUF3QjtBQUN0QixTQUFLdEUsR0FBTCxDQUFTdUUsYUFBVCxDQUF1QixvREFBdkI7QUFDRDs7QUFDRCxRQUFNLEtBQUtuQixHQUFMLENBQVNnQixXQUFULENBQXFCQyxhQUFyQixDQUFOO0FBQ0QsQ0FMRDs7QUFPQTNFLFFBQVEsQ0FBQzhFLE9BQVQsR0FBbUIsZUFBZUEsT0FBZixDQUF3QkMsV0FBeEIsRUFBcUNDLE9BQXJDLEVBQThDO0FBQy9ELE1BQUksQ0FBQyxLQUFLSixVQUFMLEVBQUwsRUFBd0I7QUFDdEIsU0FBS3RFLEdBQUwsQ0FBU3VFLGFBQVQsQ0FBdUIsZ0RBQXZCO0FBQ0Q7O0FBQ0QsUUFBTSxLQUFLbkIsR0FBTCxDQUFTb0IsT0FBVCxDQUFpQkMsV0FBakIsRUFBOEJDLE9BQTlCLENBQU47QUFDRCxDQUxEOztBQU9BaEYsUUFBUSxDQUFDaUYsT0FBVCxHQUFtQixlQUFlQSxPQUFmLENBQXdCRixXQUF4QixFQUFxQ0csTUFBckMsRUFBNkM7QUFDOUQsTUFBSSxDQUFDLEtBQUtOLFVBQUwsRUFBTCxFQUF3QjtBQUN0QixTQUFLdEUsR0FBTCxDQUFTdUUsYUFBVCxDQUF1QixnREFBdkI7QUFDRDs7QUFDRCxRQUFNLEtBQUtuQixHQUFMLENBQVN1QixPQUFULENBQWlCRixXQUFqQixFQUE4QkcsTUFBOUIsQ0FBTjtBQUNELENBTEQ7O0FBT0FsRixRQUFRLENBQUNtRixTQUFULEdBQXFCLGVBQWVBLFNBQWYsQ0FBMEJDLGFBQTFCLEVBQXlDO0FBQzVELE1BQUksQ0FBQyxLQUFLUixVQUFMLEVBQUwsRUFBd0I7QUFDdEIsU0FBS3RFLEdBQUwsQ0FBU3VFLGFBQVQsQ0FBdUIsa0RBQXZCO0FBQ0Q7O0FBQ0QsUUFBTSxLQUFLbkIsR0FBTCxDQUFTeUIsU0FBVCxDQUFtQkMsYUFBbkIsQ0FBTjtBQUNELENBTEQ7O0FBT0FwRixRQUFRLENBQUNxRixRQUFULEdBQW9CLGVBQWVBLFFBQWYsQ0FBeUJDLEtBQXpCLEVBQWdDO0FBQ2xELE1BQUksQ0FBQyxLQUFLVixVQUFMLEVBQUwsRUFBd0I7QUFDdEIsU0FBS3RFLEdBQUwsQ0FBU3VFLGFBQVQsQ0FBdUIsaURBQXZCO0FBQ0Q7O0FBQ0QsUUFBTSxLQUFLbkIsR0FBTCxDQUFTMkIsUUFBVCxDQUFrQkMsS0FBbEIsQ0FBTjtBQUNELENBTEQ7O0FBT0F0RixRQUFRLENBQUN1RixPQUFULEdBQW1CLGVBQWVBLE9BQWYsQ0FBd0JELEtBQXhCLEVBQStCO0FBQ2hELE1BQUksQ0FBQyxLQUFLVixVQUFMLEVBQUwsRUFBd0I7QUFDdEIsU0FBS3RFLEdBQUwsQ0FBU3VFLGFBQVQsQ0FBdUIsZ0RBQXZCO0FBQ0Q7O0FBQ0QsUUFBTSxLQUFLbkIsR0FBTCxDQUFTNkIsT0FBVCxDQUFpQkQsS0FBakIsQ0FBTjtBQUNELENBTEQ7O0FBT0F0RixRQUFRLENBQUN3RixhQUFULEdBQXlCLGVBQWVBLGFBQWYsQ0FBOEJDLGNBQTlCLEVBQThDO0FBQ3JFLE1BQUksQ0FBQyxLQUFLYixVQUFMLEVBQUwsRUFBd0I7QUFDdEIsU0FBS3RFLEdBQUwsQ0FBU3VFLGFBQVQsQ0FBdUIsc0RBQXZCO0FBQ0Q7O0FBQ0QsUUFBTSxLQUFLbkIsR0FBTCxDQUFTOEIsYUFBVCxDQUF1QkMsY0FBdkIsQ0FBTjtBQUNELENBTEQ7O0FBT0F6RixRQUFRLENBQUMwRixZQUFULEdBQXdCLGVBQWVBLFlBQWYsQ0FBNkJBLFlBQTdCLEVBQTJDO0FBQ2pFLE1BQUksQ0FBQyxLQUFLZCxVQUFMLEVBQUwsRUFBd0I7QUFDdEIsU0FBS3RFLEdBQUwsQ0FBU3VFLGFBQVQsQ0FBdUIscURBQXZCO0FBQ0Q7O0FBQ0QsUUFBTSxLQUFLbkIsR0FBTCxDQUFTZ0MsWUFBVCxDQUFzQkEsWUFBdEIsQ0FBTjtBQUNELENBTEQ7O0FBbUJBMUYsUUFBUSxDQUFDMkYsU0FBVCxHQUFxQixlQUFlQSxTQUFmLENBQTBCQyxNQUFNLEdBQUcsRUFBbkMsRUFBdUM7QUFDMUQsUUFBTTtBQUFDQyxJQUFBQSxVQUFEO0FBQWFDLElBQUFBO0FBQWIsTUFBc0JGLE1BQTVCOztBQUNBLE1BQUksQ0FBQ3BELGNBQUtDLFFBQUwsQ0FBY29ELFVBQWQsQ0FBTCxFQUFnQztBQUM5QixTQUFLdkYsR0FBTCxDQUFTdUUsYUFBVCxDQUF3QixtQ0FBeEI7QUFDRDs7QUFDRCxNQUFJLENBQUNyQyxjQUFLQyxRQUFMLENBQWNxRCxLQUFkLENBQUwsRUFBMkI7QUFDekIsU0FBS3hGLEdBQUwsQ0FBU3VFLGFBQVQsQ0FBd0IsOEJBQXhCO0FBQ0Q7O0FBQ0QsTUFBSSxDQUFDLEtBQUtELFVBQUwsRUFBTCxFQUF3QjtBQUN0QixTQUFLdEUsR0FBTCxDQUFTdUUsYUFBVCxDQUF1QixrREFBdkI7QUFDRDs7QUFDRCxRQUFNLEtBQUtuQixHQUFMLENBQVNpQyxTQUFULENBQW1CRSxVQUFuQixFQUErQkMsS0FBL0IsQ0FBTjtBQUNELENBWkQ7O0FBY0E3RixPQUFPLENBQUM4Riw2QkFBUixHQUF3QyxlQUFlQSw2QkFBZixDQUE4Q3JDLEdBQTlDLEVBQW1EM0MsSUFBbkQsRUFBeUQ7QUFDL0YsUUFBTWlGLFNBQVMsR0FBRyxNQUFNQyxpQkFBUUMsSUFBUixDQUFhO0FBQUNDLElBQUFBLE1BQU0sRUFBRSxRQUFUO0FBQW1CQyxJQUFBQSxNQUFNLEVBQUU7QUFBM0IsR0FBYixDQUF4Qjs7QUFDQSxNQUFJLE1BQU1DLFlBQUdDLE1BQUgsQ0FBVU4sU0FBVixDQUFWLEVBQWdDO0FBQzlCLFVBQU1LLFlBQUdFLE1BQUgsQ0FBVVAsU0FBVixDQUFOO0FBQ0Q7O0FBQ0QsTUFBSTtBQUNGLFVBQU1RLE1BQU0sR0FBR3pGLElBQUksQ0FBQzBGLHFCQUFMLElBQThCLGtCQUE3Qzs7QUFDQSxVQUFNQyxHQUFHLEdBQUdSLGNBQUtTLEtBQUwsQ0FBV0MsT0FBWCxDQUFtQkosTUFBbkIsRUFBMkIsZ0JBQTNCLENBQVo7O0FBQ0EsVUFBTUssR0FBRyxHQUFHLENBQUMsZ0JBQUQsRUFBb0IsR0FBRUgsR0FBSSxHQUExQixFQUE4Qix1QkFBOUIsRUFBdUQsSUFBdkQsRUFBNkRBLEdBQTdELENBQVo7QUFDQSxVQUFNaEQsR0FBRyxDQUFDb0QsS0FBSixDQUFVRCxHQUFWLENBQU47O0FBQ0EsUUFBSSxFQUFDLE1BQU1uRCxHQUFHLENBQUNxRCxRQUFKLENBQWFMLEdBQWIsQ0FBUCxDQUFKLEVBQThCO0FBQzVCLFlBQU0sSUFBSU0sS0FBSixDQUFVLGtEQUFWLENBQU47QUFDRDs7QUFDRCxVQUFNdEQsR0FBRyxDQUFDdUQsSUFBSixDQUFTUCxHQUFULEVBQWNWLFNBQWQsQ0FBTjtBQUNBLFdBQU8sTUFBTWtCLGNBQUtDLElBQUwsQ0FBVW5CLFNBQVYsQ0FBYjtBQUNELEdBVkQsU0FVVTtBQUNSLFFBQUksTUFBTUssWUFBR0MsTUFBSCxDQUFVTixTQUFWLENBQVYsRUFBZ0M7QUFDOUIsWUFBTUssWUFBR0UsTUFBSCxDQUFVUCxTQUFWLENBQU47QUFDRDtBQUNGO0FBQ0YsQ0FwQkQ7O0FBc0JBL0YsT0FBTyxDQUFDbUgsK0JBQVIsR0FBMEMsZUFBZUEsK0JBQWYsQ0FBZ0QxRCxHQUFoRCxFQUFxRDtBQUM3RixNQUFJO0FBQUMyRCxJQUFBQSxNQUFEO0FBQVNDLElBQUFBLE1BQVQ7QUFBaUJDLElBQUFBO0FBQWpCLE1BQXlCLE1BQU0sd0JBQUs3RCxHQUFHLENBQUM4RCxVQUFKLENBQWV0QixJQUFwQixFQUNEeEMsR0FBRyxDQUFDOEQsVUFBSixDQUFlQyxXQUFmLENBQ0dDLE1BREgsQ0FDVSxDQUFDLFVBQUQsRUFBYSx1QkFBYixFQUFzQyxJQUF0QyxDQURWLENBREMsRUFHRDtBQUFDQyxJQUFBQSxRQUFRLEVBQUUsUUFBWDtBQUFxQkMsSUFBQUEsUUFBUSxFQUFFO0FBQS9CLEdBSEMsQ0FBbkM7O0FBS0EsTUFBSUwsSUFBSSxJQUFJRCxNQUFNLENBQUNPLE1BQW5CLEVBQTJCO0FBQ3pCLFVBQU0sSUFBSWIsS0FBSixDQUFXLHFDQUFvQ08sSUFBSyxlQUFjRCxNQUFNLENBQUNRLFFBQVAsRUFBa0IsR0FBcEYsQ0FBTjtBQUNEOztBQUVELE1BQUksQ0FBQ1QsTUFBTSxDQUFDUSxNQUFaLEVBQW9CO0FBQ2xCLFVBQU0sSUFBSWIsS0FBSixDQUFVLDZCQUFWLENBQU47QUFDRDs7QUFFRCxTQUFPLE1BQU1FLGNBQUtDLElBQUwsQ0FBVUUsTUFBVixDQUFiO0FBQ0QsQ0FmRDs7QUFpQkFySCxRQUFRLENBQUMrSCxhQUFULEdBQXlCLGVBQWVBLGFBQWYsR0FBZ0M7QUFDdkQsUUFBTUMsUUFBUSxHQUFHLE1BQU0sS0FBS3RFLEdBQUwsQ0FBU3VFLFdBQVQsRUFBdkI7QUFDQSxNQUFJQyxLQUFLLEdBQUcsSUFBWjs7QUFDQSxNQUFJRixRQUFRLEdBQUcsRUFBZixFQUFtQjtBQUNqQixRQUFJO0FBR0ZFLE1BQUFBLEtBQUssR0FBRyxNQUFNLEtBQUtkLCtCQUFMLENBQXFDLEtBQUsxRCxHQUExQyxDQUFkO0FBQ0QsS0FKRCxDQUlFLE9BQU95RSxDQUFQLEVBQVU7QUFDVixXQUFLN0gsR0FBTCxDQUFTOEgsSUFBVCxDQUFlLDhEQUE2REQsQ0FBQyxDQUFDbkQsT0FBUSxLQUF4RSxHQUNYLGdDQURIO0FBRUQ7QUFDRjs7QUFDRCxNQUFJLENBQUNrRCxLQUFMLEVBQVk7QUFDVixRQUFJO0FBQ0ZBLE1BQUFBLEtBQUssR0FBRyxNQUFNLEtBQUtuQyw2QkFBTCxDQUFtQyxLQUFLckMsR0FBeEMsRUFBNkMsS0FBSzNDLElBQWxELENBQWQ7QUFDRCxLQUZELENBRUUsT0FBT29ILENBQVAsRUFBVTtBQUNWLFlBQU1FLEdBQUcsR0FBSSwwQ0FBeUNGLENBQUMsQ0FBQ25ELE9BQVEsS0FBcEQsR0FDVCwwREFEUyxHQUVULGtCQUZIO0FBR0EsV0FBSzFFLEdBQUwsQ0FBU3VFLGFBQVQsQ0FBdUJ3RCxHQUF2QjtBQUNEO0FBQ0Y7O0FBQ0QsTUFBSUwsUUFBUSxHQUFHLEVBQWYsRUFBbUI7QUFFakIsUUFBSU0saUJBQWlCLEdBQUcsTUFBTSxLQUFLNUUsR0FBTCxDQUFTNkUsb0JBQVQsRUFBOUI7O0FBQ0EsUUFBSTtBQUNGTCxNQUFBQSxLQUFLLEdBQUcsTUFBTUEsS0FBSyxDQUFDTSxNQUFOLENBQWEsQ0FBQyxFQUFELEdBQU1GLGlCQUFuQixDQUFkO0FBQ0QsS0FGRCxDQUVFLE9BQU9ELEdBQVAsRUFBWTtBQUNaLFdBQUsvSCxHQUFMLENBQVNDLElBQVQsQ0FBZSw2Q0FBNEM4SCxHQUFJLEVBQS9EO0FBQ0Q7QUFDRjs7QUFDRCxRQUFNSSxTQUFTLEdBQUczRSxrQkFBRTRFLFNBQUYsQ0FBWVIsS0FBSyxDQUFDTyxTQUFsQixFQUE2QjtBQUFDRSxJQUFBQSxPQUFPLEVBQUVUO0FBQVYsR0FBN0IsQ0FBbEI7O0FBQ0EsUUFBTVUsU0FBUyxHQUFHLE1BQU1ILFNBQVMsQ0FBQ3ZCLGNBQUsyQixRQUFOLENBQWpDO0FBQ0EsU0FBT0QsU0FBUyxDQUFDZCxRQUFWLENBQW1CLFFBQW5CLENBQVA7QUFDRCxDQW5DRDs7QUFxQ0FnQixNQUFNLENBQUNDLE1BQVAsQ0FBYzdJLFVBQWQsRUFBMEJGLFFBQTFCLEVBQW9DQyxPQUFwQztlQUVlQyxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGFuZHJvaWRIZWxwZXJzIGZyb20gJy4uL2FuZHJvaWQtaGVscGVycyc7XG5pbXBvcnQgeyBmcywgdXRpbCwgdGVtcERpcn0gZnJvbSAnQGFwcGl1bS9zdXBwb3J0JztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IGppbXAgZnJvbSAnamltcCc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcblxuY29uc3Qgc3dpcGVTdGVwc1BlclNlYyA9IDI4O1xuY29uc3QgZHJhZ1N0ZXBzUGVyU2VjID0gNDA7XG5cbmxldCBjb21tYW5kcyA9IHt9LCBoZWxwZXJzID0ge30sIGV4dGVuc2lvbnMgPSB7fTtcblxuY29tbWFuZHMua2V5ZXZlbnQgPSBhc3luYyBmdW5jdGlvbiBrZXlldmVudCAoa2V5Y29kZSwgbWV0YXN0YXRlID0gbnVsbCkge1xuICAvLyBUT0RPIGRlcHJlY2F0ZSBrZXlldmVudDsgY3VycmVudGx5IHdkIG9ubHkgaW1wbGVtZW50cyBrZXlldmVudFxuICB0aGlzLmxvZy53YXJuKCdrZXlldmVudCB3aWxsIGJlIGRlcHJlY2F0ZWQgdXNlIHByZXNzS2V5Q29kZScpO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcmVzc0tleUNvZGUoa2V5Y29kZSwgbWV0YXN0YXRlKTtcbn07XG5cbmNvbW1hbmRzLnByZXNzS2V5Q29kZSA9IGFzeW5jIGZ1bmN0aW9uIHByZXNzS2V5Q29kZSAoa2V5Y29kZSwgbWV0YXN0YXRlID0gbnVsbCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbigncHJlc3NLZXlDb2RlJywge2tleWNvZGUsIG1ldGFzdGF0ZX0pO1xufTtcblxuY29tbWFuZHMubG9uZ1ByZXNzS2V5Q29kZSA9IGFzeW5jIGZ1bmN0aW9uIGxvbmdQcmVzc0tleUNvZGUgKGtleWNvZGUsIG1ldGFzdGF0ZSA9IG51bGwpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ2xvbmdQcmVzc0tleUNvZGUnLCB7a2V5Y29kZSwgbWV0YXN0YXRlfSk7XG59O1xuXG5jb21tYW5kcy5nZXRPcmllbnRhdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIGdldE9yaWVudGF0aW9uICgpIHtcbiAgbGV0IHBhcmFtcyA9IHtcbiAgICBuYXR1cmFsT3JpZW50YXRpb246ICEhdGhpcy5vcHRzLmFuZHJvaWROYXR1cmFsT3JpZW50YXRpb24sXG4gIH07XG4gIGxldCBvcmllbnRhdGlvbiA9IGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ29yaWVudGF0aW9uJywgcGFyYW1zKTtcbiAgcmV0dXJuIG9yaWVudGF0aW9uLnRvVXBwZXJDYXNlKCk7XG59O1xuXG5jb21tYW5kcy5zZXRPcmllbnRhdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIHNldE9yaWVudGF0aW9uIChvcmllbnRhdGlvbikge1xuICBvcmllbnRhdGlvbiA9IG9yaWVudGF0aW9uLnRvVXBwZXJDYXNlKCk7XG4gIGxldCBwYXJhbXMgPSB7XG4gICAgb3JpZW50YXRpb24sXG4gICAgbmF0dXJhbE9yaWVudGF0aW9uOiAhIXRoaXMub3B0cy5hbmRyb2lkTmF0dXJhbE9yaWVudGF0aW9uLFxuICB9O1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignb3JpZW50YXRpb24nLCBwYXJhbXMpO1xufTtcblxuY29tbWFuZHMuZmFrZUZsaWNrID0gYXN5bmMgZnVuY3Rpb24gZmFrZUZsaWNrICh4U3BlZWQsIHlTcGVlZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignZmxpY2snLCB7eFNwZWVkLCB5U3BlZWR9KTtcbn07XG5cbmNvbW1hbmRzLmZha2VGbGlja0VsZW1lbnQgPSBhc3luYyBmdW5jdGlvbiBmYWtlRmxpY2tFbGVtZW50IChlbGVtZW50SWQsIHhvZmZzZXQsIHlvZmZzZXQsIHNwZWVkKSB7XG4gIGxldCBwYXJhbXMgPSB7eG9mZnNldCwgeW9mZnNldCwgc3BlZWQsIGVsZW1lbnRJZH07XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdlbGVtZW50OmZsaWNrJywgcGFyYW1zKTtcbn07XG5cbmNvbW1hbmRzLnN3aXBlID0gYXN5bmMgZnVuY3Rpb24gc3dpcGUgKHN0YXJ0WCwgc3RhcnRZLCBlbmRYLCBlbmRZLCBkdXJhdGlvbiwgdG91Y2hDb3VudCwgZWxJZCkge1xuICBpZiAoc3RhcnRYID09PSAnbnVsbCcpIHtcbiAgICBzdGFydFggPSAwLjU7XG4gIH1cbiAgaWYgKHN0YXJ0WSA9PT0gJ251bGwnKSB7XG4gICAgc3RhcnRZID0gMC41O1xuICB9XG4gIGxldCBzd2lwZU9wdHMgPSB7c3RhcnRYLCBzdGFydFksIGVuZFgsIGVuZFksXG4gICAgICAgICAgICAgICAgICAgc3RlcHM6IE1hdGgucm91bmQoZHVyYXRpb24gKiBzd2lwZVN0ZXBzUGVyU2VjKX07XG4gIC8vIGdvaW5nIHRoZSBsb25nIHdheSBhbmQgY2hlY2tpbmcgZm9yIHVuZGVmaW5lZCBhbmQgbnVsbCBzaW5jZVxuICAvLyB3ZSBjYW4ndCBiZSBhc3N1cmVkIGBlbElkYCBpcyBhIHN0cmluZyBhbmQgbm90IGFuIGludFxuICBpZiAodXRpbC5oYXNWYWx1ZShlbElkKSkge1xuICAgIHN3aXBlT3B0cy5lbGVtZW50SWQgPSBlbElkO1xuICB9XG4gIHJldHVybiBhd2FpdCB0aGlzLmRvU3dpcGUoc3dpcGVPcHRzKTtcbn07XG5cbmNvbW1hbmRzLmRvU3dpcGUgPSBhc3luYyBmdW5jdGlvbiBkb1N3aXBlIChzd2lwZU9wdHMpIHtcbiAgaWYgKHV0aWwuaGFzVmFsdWUoc3dpcGVPcHRzLmVsZW1lbnRJZCkpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignZWxlbWVudDpzd2lwZScsIHN3aXBlT3B0cyk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ3N3aXBlJywgc3dpcGVPcHRzKTtcbiAgfVxufTtcblxuY29tbWFuZHMucGluY2hDbG9zZSA9IGFzeW5jIGZ1bmN0aW9uIHBpbmNoQ2xvc2UgKHN0YXJ0WCwgc3RhcnRZLCBlbmRYLCBlbmRZLCBkdXJhdGlvbiwgcGVyY2VudCwgc3RlcHMsIGVsSWQpIHtcbiAgbGV0IHBpbmNoT3B0cyA9IHtcbiAgICBkaXJlY3Rpb246ICdpbicsXG4gICAgZWxlbWVudElkOiBlbElkLFxuICAgIHBlcmNlbnQsXG4gICAgc3RlcHNcbiAgfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ2VsZW1lbnQ6cGluY2gnLCBwaW5jaE9wdHMpO1xufTtcblxuY29tbWFuZHMucGluY2hPcGVuID0gYXN5bmMgZnVuY3Rpb24gcGluY2hPcGVuIChzdGFydFgsIHN0YXJ0WSwgZW5kWCwgZW5kWSwgZHVyYXRpb24sIHBlcmNlbnQsIHN0ZXBzLCBlbElkKSB7XG4gIGxldCBwaW5jaE9wdHMgPSB7ZGlyZWN0aW9uOiAnb3V0JywgZWxlbWVudElkOiBlbElkLCBwZXJjZW50LCBzdGVwc307XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdlbGVtZW50OnBpbmNoJywgcGluY2hPcHRzKTtcbn07XG5cbmNvbW1hbmRzLmZsaWNrID0gYXN5bmMgZnVuY3Rpb24gZmxpY2sgKGVsZW1lbnQsIHhTcGVlZCwgeVNwZWVkLCB4T2Zmc2V0LCB5T2Zmc2V0LCBzcGVlZCkge1xuICBpZiAoZWxlbWVudCkge1xuICAgIGF3YWl0IHRoaXMuZmFrZUZsaWNrRWxlbWVudChlbGVtZW50LCB4T2Zmc2V0LCB5T2Zmc2V0LCBzcGVlZCk7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgdGhpcy5mYWtlRmxpY2soeFNwZWVkLCB5U3BlZWQpO1xuICB9XG59O1xuXG5jb21tYW5kcy5kcmFnID0gYXN5bmMgZnVuY3Rpb24gZHJhZyAoc3RhcnRYLCBzdGFydFksIGVuZFgsIGVuZFksIGR1cmF0aW9uLCB0b3VjaENvdW50LCBlbGVtZW50SWQsIGRlc3RFbElkKSB7XG4gIGxldCBkcmFnT3B0cyA9IHtcbiAgICBlbGVtZW50SWQsIGRlc3RFbElkLCBzdGFydFgsIHN0YXJ0WSwgZW5kWCwgZW5kWSxcbiAgICBzdGVwczogTWF0aC5yb3VuZChkdXJhdGlvbiAqIGRyYWdTdGVwc1BlclNlYylcbiAgfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuZG9EcmFnKGRyYWdPcHRzKTtcblxufTtcblxuY29tbWFuZHMuZG9EcmFnID0gYXN5bmMgZnVuY3Rpb24gZG9EcmFnIChkcmFnT3B0cykge1xuICBpZiAodXRpbC5oYXNWYWx1ZShkcmFnT3B0cy5lbGVtZW50SWQpKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ2VsZW1lbnQ6ZHJhZycsIGRyYWdPcHRzKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignZHJhZycsIGRyYWdPcHRzKTtcbiAgfVxufTtcblxuY29tbWFuZHMubG9jayA9IGFzeW5jIGZ1bmN0aW9uIGxvY2sgKHNlY29uZHMpIHtcbiAgYXdhaXQgdGhpcy5hZGIubG9jaygpO1xuICBpZiAoaXNOYU4oc2Vjb25kcykpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBmbG9hdFNlY29uZHMgPSBwYXJzZUZsb2F0KHNlY29uZHMpO1xuICBpZiAoZmxvYXRTZWNvbmRzIDw9IDApIHtcbiAgICByZXR1cm47XG4gIH1cbiAgYXdhaXQgQi5kZWxheSgxMDAwICogZmxvYXRTZWNvbmRzKTtcbiAgYXdhaXQgdGhpcy51bmxvY2soKTtcbn07XG5cbmNvbW1hbmRzLmlzTG9ja2VkID0gYXN5bmMgZnVuY3Rpb24gaXNMb2NrZWQgKCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5hZGIuaXNTY3JlZW5Mb2NrZWQoKTtcbn07XG5cbmNvbW1hbmRzLnVubG9jayA9IGFzeW5jIGZ1bmN0aW9uIHVubG9jayAoKSB7XG4gIHJldHVybiBhd2FpdCBhbmRyb2lkSGVscGVycy51bmxvY2sodGhpcywgdGhpcy5hZGIsIHRoaXMuY2Fwcyk7XG59O1xuXG5jb21tYW5kcy5vcGVuTm90aWZpY2F0aW9ucyA9IGFzeW5jIGZ1bmN0aW9uIG9wZW5Ob3RpZmljYXRpb25zICgpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ29wZW5Ob3RpZmljYXRpb24nKTtcbn07XG5cbmNvbW1hbmRzLnNldExvY2F0aW9uID0gYXN5bmMgZnVuY3Rpb24gc2V0TG9jYXRpb24gKGxhdGl0dWRlLCBsb25naXR1ZGUpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYWRiLnNlbmRUZWxuZXRDb21tYW5kKGBnZW8gZml4ICR7bG9uZ2l0dWRlfSAke2xhdGl0dWRlfWApO1xufTtcblxuY29tbWFuZHMuZmluZ2VycHJpbnQgPSBhc3luYyBmdW5jdGlvbiBmaW5nZXJwcmludCAoZmluZ2VycHJpbnRJZCkge1xuICBpZiAoIXRoaXMuaXNFbXVsYXRvcigpKSB7XG4gICAgdGhpcy5sb2cuZXJyb3JBbmRUaHJvdygnZmluZ2VycHJpbnQgbWV0aG9kIGlzIG9ubHkgYXZhaWxhYmxlIGZvciBlbXVsYXRvcnMnKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYi5maW5nZXJwcmludChmaW5nZXJwcmludElkKTtcbn07XG5cbmNvbW1hbmRzLnNlbmRTTVMgPSBhc3luYyBmdW5jdGlvbiBzZW5kU01TIChwaG9uZU51bWJlciwgbWVzc2FnZSkge1xuICBpZiAoIXRoaXMuaXNFbXVsYXRvcigpKSB7XG4gICAgdGhpcy5sb2cuZXJyb3JBbmRUaHJvdygnc2VuZFNNUyBtZXRob2QgaXMgb25seSBhdmFpbGFibGUgZm9yIGVtdWxhdG9ycycpO1xuICB9XG4gIGF3YWl0IHRoaXMuYWRiLnNlbmRTTVMocGhvbmVOdW1iZXIsIG1lc3NhZ2UpO1xufTtcblxuY29tbWFuZHMuZ3NtQ2FsbCA9IGFzeW5jIGZ1bmN0aW9uIGdzbUNhbGwgKHBob25lTnVtYmVyLCBhY3Rpb24pIHtcbiAgaWYgKCF0aGlzLmlzRW11bGF0b3IoKSkge1xuICAgIHRoaXMubG9nLmVycm9yQW5kVGhyb3coJ2dzbUNhbGwgbWV0aG9kIGlzIG9ubHkgYXZhaWxhYmxlIGZvciBlbXVsYXRvcnMnKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYi5nc21DYWxsKHBob25lTnVtYmVyLCBhY3Rpb24pO1xufTtcblxuY29tbWFuZHMuZ3NtU2lnbmFsID0gYXN5bmMgZnVuY3Rpb24gZ3NtU2lnbmFsIChzaWduYWxTdHJlbmdoKSB7XG4gIGlmICghdGhpcy5pc0VtdWxhdG9yKCkpIHtcbiAgICB0aGlzLmxvZy5lcnJvckFuZFRocm93KCdnc21TaWduYWwgbWV0aG9kIGlzIG9ubHkgYXZhaWxhYmxlIGZvciBlbXVsYXRvcnMnKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYi5nc21TaWduYWwoc2lnbmFsU3RyZW5naCk7XG59O1xuXG5jb21tYW5kcy5nc21Wb2ljZSA9IGFzeW5jIGZ1bmN0aW9uIGdzbVZvaWNlIChzdGF0ZSkge1xuICBpZiAoIXRoaXMuaXNFbXVsYXRvcigpKSB7XG4gICAgdGhpcy5sb2cuZXJyb3JBbmRUaHJvdygnZ3NtVm9pY2UgbWV0aG9kIGlzIG9ubHkgYXZhaWxhYmxlIGZvciBlbXVsYXRvcnMnKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYi5nc21Wb2ljZShzdGF0ZSk7XG59O1xuXG5jb21tYW5kcy5wb3dlckFDID0gYXN5bmMgZnVuY3Rpb24gcG93ZXJBQyAoc3RhdGUpIHtcbiAgaWYgKCF0aGlzLmlzRW11bGF0b3IoKSkge1xuICAgIHRoaXMubG9nLmVycm9yQW5kVGhyb3coJ3Bvd2VyQUMgbWV0aG9kIGlzIG9ubHkgYXZhaWxhYmxlIGZvciBlbXVsYXRvcnMnKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYi5wb3dlckFDKHN0YXRlKTtcbn07XG5cbmNvbW1hbmRzLnBvd2VyQ2FwYWNpdHkgPSBhc3luYyBmdW5jdGlvbiBwb3dlckNhcGFjaXR5IChiYXR0ZXJ5UGVyY2VudCkge1xuICBpZiAoIXRoaXMuaXNFbXVsYXRvcigpKSB7XG4gICAgdGhpcy5sb2cuZXJyb3JBbmRUaHJvdygncG93ZXJDYXBhY2l0eSBtZXRob2QgaXMgb25seSBhdmFpbGFibGUgZm9yIGVtdWxhdG9ycycpO1xuICB9XG4gIGF3YWl0IHRoaXMuYWRiLnBvd2VyQ2FwYWNpdHkoYmF0dGVyeVBlcmNlbnQpO1xufTtcblxuY29tbWFuZHMubmV0d29ya1NwZWVkID0gYXN5bmMgZnVuY3Rpb24gbmV0d29ya1NwZWVkIChuZXR3b3JrU3BlZWQpIHtcbiAgaWYgKCF0aGlzLmlzRW11bGF0b3IoKSkge1xuICAgIHRoaXMubG9nLmVycm9yQW5kVGhyb3coJ25ldHdvcmtTcGVlZCBtZXRob2QgaXMgb25seSBhdmFpbGFibGUgZm9yIGVtdWxhdG9ycycpO1xuICB9XG4gIGF3YWl0IHRoaXMuYWRiLm5ldHdvcmtTcGVlZChuZXR3b3JrU3BlZWQpO1xufTtcblxuLyoqXG4gKiBFbXVsYXRlIHNlbnNvcnMgdmFsdWVzIG9uIHRoZSBjb25uZWN0ZWQgZW11bGF0b3IuXG4gKlxuICogQHR5cGVkZWYge09iamVjdH0gU2Vuc29yXG4gKiBAcHJvcGVydHkge3N0cmluZ30gc2Vuc29yVHlwZSAtIHNlbnNvciB0eXBlIGRlY2xhcmVkIGluIGFkYi5TRU5TT1JTXG4gKiBAcHJvcGVydHkge3N0cmluZ30gdmFsdWUgLSB2YWx1ZSB0byBzZXQgdG8gdGhlIHNlbnNvclxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBTZW5zb3JcbiAqIEB0aHJvd3Mge0Vycm9yfSAtIElmIHNlbnNvclR5cGUgaXMgbm90IGRlZmluZWRcbiAqIEB0aHJvd3Mge0Vycm9yfSAtIElmIHZhbHVlIGZvciB0aGUgc2Ugc29yIGlzIG5vdCBkZWZpbmVkXG4gKiBAdGhyb3dzIHtFcnJvcn0gLSBJZiBkZXZpY2VUeXBlIGlzIG5vdCBhbiBlbXVsYXRvclxuICovXG5jb21tYW5kcy5zZW5zb3JTZXQgPSBhc3luYyBmdW5jdGlvbiBzZW5zb3JTZXQgKHNlbnNvciA9IHt9KSB7XG4gIGNvbnN0IHtzZW5zb3JUeXBlLCB2YWx1ZX0gPSBzZW5zb3I7XG4gIGlmICghdXRpbC5oYXNWYWx1ZShzZW5zb3JUeXBlKSkge1xuICAgIHRoaXMubG9nLmVycm9yQW5kVGhyb3coYCdzZW5zb3JUeXBlJyBhcmd1bWVudCBpcyByZXF1aXJlZGApO1xuICB9XG4gIGlmICghdXRpbC5oYXNWYWx1ZSh2YWx1ZSkpIHtcbiAgICB0aGlzLmxvZy5lcnJvckFuZFRocm93KGAndmFsdWUnIGFyZ3VtZW50IGlzIHJlcXVpcmVkYCk7XG4gIH1cbiAgaWYgKCF0aGlzLmlzRW11bGF0b3IoKSkge1xuICAgIHRoaXMubG9nLmVycm9yQW5kVGhyb3coJ3NlbnNvclNldCBtZXRob2QgaXMgb25seSBhdmFpbGFibGUgZm9yIGVtdWxhdG9ycycpO1xuICB9XG4gIGF3YWl0IHRoaXMuYWRiLnNlbnNvclNldChzZW5zb3JUeXBlLCB2YWx1ZSk7XG59O1xuXG5oZWxwZXJzLmdldFNjcmVlbnNob3REYXRhV2l0aEFkYlNoZWxsID0gYXN5bmMgZnVuY3Rpb24gZ2V0U2NyZWVuc2hvdERhdGFXaXRoQWRiU2hlbGwgKGFkYiwgb3B0cykge1xuICBjb25zdCBsb2NhbEZpbGUgPSBhd2FpdCB0ZW1wRGlyLnBhdGgoe3ByZWZpeDogJ2FwcGl1bScsIHN1ZmZpeDogJy5wbmcnfSk7XG4gIGlmIChhd2FpdCBmcy5leGlzdHMobG9jYWxGaWxlKSkge1xuICAgIGF3YWl0IGZzLnVubGluayhsb2NhbEZpbGUpO1xuICB9XG4gIHRyeSB7XG4gICAgY29uc3QgcG5nRGlyID0gb3B0cy5hbmRyb2lkU2NyZWVuc2hvdFBhdGggfHwgJy9kYXRhL2xvY2FsL3RtcC8nO1xuICAgIGNvbnN0IHBuZyA9IHBhdGgucG9zaXgucmVzb2x2ZShwbmdEaXIsICdzY3JlZW5zaG90LnBuZycpO1xuICAgIGNvbnN0IGNtZCA9IFsnL3N5c3RlbS9iaW4vcm0nLCBgJHtwbmd9O2AsICcvc3lzdGVtL2Jpbi9zY3JlZW5jYXAnLCAnLXAnLCBwbmddO1xuICAgIGF3YWl0IGFkYi5zaGVsbChjbWQpO1xuICAgIGlmICghYXdhaXQgYWRiLmZpbGVTaXplKHBuZykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNpemUgb2YgdGhlIHRha2VuIHNjcmVlbnNob3QgZXF1YWxzIHRvIHplcm8uJyk7XG4gICAgfVxuICAgIGF3YWl0IGFkYi5wdWxsKHBuZywgbG9jYWxGaWxlKTtcbiAgICByZXR1cm4gYXdhaXQgamltcC5yZWFkKGxvY2FsRmlsZSk7XG4gIH0gZmluYWxseSB7XG4gICAgaWYgKGF3YWl0IGZzLmV4aXN0cyhsb2NhbEZpbGUpKSB7XG4gICAgICBhd2FpdCBmcy51bmxpbmsobG9jYWxGaWxlKTtcbiAgICB9XG4gIH1cbn07XG5cbmhlbHBlcnMuZ2V0U2NyZWVuc2hvdERhdGFXaXRoQWRiRXhlY091dCA9IGFzeW5jIGZ1bmN0aW9uIGdldFNjcmVlbnNob3REYXRhV2l0aEFkYkV4ZWNPdXQgKGFkYikge1xuICBsZXQge3N0ZG91dCwgc3RkZXJyLCBjb2RlfSA9IGF3YWl0IGV4ZWMoYWRiLmV4ZWN1dGFibGUucGF0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkYi5leGVjdXRhYmxlLmRlZmF1bHRBcmdzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jb25jYXQoWydleGVjLW91dCcsICcvc3lzdGVtL2Jpbi9zY3JlZW5jYXAnLCAnLXAnXSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7ZW5jb2Rpbmc6ICdiaW5hcnknLCBpc0J1ZmZlcjogdHJ1ZX0pO1xuICAvLyBpZiB0aGVyZSBpcyBhbiBlcnJvciwgdGhyb3dcbiAgaWYgKGNvZGUgfHwgc3RkZXJyLmxlbmd0aCkge1xuICAgIHRocm93IG5ldyBFcnJvcihgU2NyZWVuc2hvdCByZXR1cm5lZCBlcnJvciwgY29kZTogJyR7Y29kZX0nLCBzdGRlcnI6ICcke3N0ZGVyci50b1N0cmluZygpfSdgKTtcbiAgfVxuICAvLyBpZiB3ZSBkb24ndCBnZXQgYW55dGhpbmcgYXQgYWxsLCB0aHJvd1xuICBpZiAoIXN0ZG91dC5sZW5ndGgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1NjcmVlbnNob3QgcmV0dXJuZWQgbm8gZGF0YScpO1xuICB9XG5cbiAgcmV0dXJuIGF3YWl0IGppbXAucmVhZChzdGRvdXQpO1xufTtcblxuY29tbWFuZHMuZ2V0U2NyZWVuc2hvdCA9IGFzeW5jIGZ1bmN0aW9uIGdldFNjcmVlbnNob3QgKCkge1xuICBjb25zdCBhcGlMZXZlbCA9IGF3YWl0IHRoaXMuYWRiLmdldEFwaUxldmVsKCk7XG4gIGxldCBpbWFnZSA9IG51bGw7XG4gIGlmIChhcGlMZXZlbCA+IDIwKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFRoaXMgc2NyZWVuc2hvdGluZyBhcHByb2FjaCBpcyB3YXkgZmFzdGVyLCBzaW5jZSBpdCByZXF1aXJlcyBsZXNzIGV4dGVybmFsIGNvbW1hbmRzXG4gICAgICAvLyB0byBiZSBleGVjdXRlZC4gVW5mb3J0dW5hdGVseSwgZXhlYy1vdXQgb3B0aW9uIGlzIG9ubHkgc3VwcG9ydGVkIGJ5IG5ld2VyIEFuZHJvaWQvU0RLIHZlcnNpb25zICg1LjAgYW5kIGxhdGVyKVxuICAgICAgaW1hZ2UgPSBhd2FpdCB0aGlzLmdldFNjcmVlbnNob3REYXRhV2l0aEFkYkV4ZWNPdXQodGhpcy5hZGIpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHRoaXMubG9nLmluZm8oYENhbm5vdCBnZXQgc2NyZWVuc2hvdCBkYXRhIHdpdGggJ2FkYiBleGVjLW91dCcgYmVjYXVzZSBvZiAnJHtlLm1lc3NhZ2V9Jy4gYCArXG4gICAgICAgIGBEZWZhdWx0aW5nIHRvICdhZGIgc2hlbGwnIGNhbGxgKTtcbiAgICB9XG4gIH1cbiAgaWYgKCFpbWFnZSkge1xuICAgIHRyeSB7XG4gICAgICBpbWFnZSA9IGF3YWl0IHRoaXMuZ2V0U2NyZWVuc2hvdERhdGFXaXRoQWRiU2hlbGwodGhpcy5hZGIsIHRoaXMub3B0cyk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc3QgZXJyID0gYENhbm5vdCBnZXQgc2NyZWVuc2hvdCBkYXRhIGJlY2F1c2Ugb2YgJyR7ZS5tZXNzYWdlfScuIGAgK1xuICAgICAgICBgTWFrZSBzdXJlIHRoZSAnTGF5b3V0UGFyYW1zLkZMQUdfU0VDVVJFJyBpcyBub3Qgc2V0IGZvciBgICtcbiAgICAgICAgYHRoZSBjdXJyZW50IHZpZXdgO1xuICAgICAgdGhpcy5sb2cuZXJyb3JBbmRUaHJvdyhlcnIpO1xuICAgIH1cbiAgfVxuICBpZiAoYXBpTGV2ZWwgPCAyMykge1xuICAgIC8vIEFuZHJvaWQgYnVnIDg0MzM3NDIgLSByb3RhdGUgc2NyZWVuc2hvdCBpZiBzY3JlZW4gaXMgcm90YXRlZFxuICAgIGxldCBzY3JlZW5PcmllbnRhdGlvbiA9IGF3YWl0IHRoaXMuYWRiLmdldFNjcmVlbk9yaWVudGF0aW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgIGltYWdlID0gYXdhaXQgaW1hZ2Uucm90YXRlKC05MCAqIHNjcmVlbk9yaWVudGF0aW9uKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHRoaXMubG9nLndhcm4oYENvdWxkIG5vdCByb3RhdGUgc2NyZWVuc2hvdCBkdWUgdG8gZXJyb3I6ICR7ZXJyfWApO1xuICAgIH1cbiAgfVxuICBjb25zdCBnZXRCdWZmZXIgPSBCLnByb21pc2lmeShpbWFnZS5nZXRCdWZmZXIsIHtjb250ZXh0OiBpbWFnZX0pO1xuICBjb25zdCBpbWdCdWZmZXIgPSBhd2FpdCBnZXRCdWZmZXIoamltcC5NSU1FX1BORyk7XG4gIHJldHVybiBpbWdCdWZmZXIudG9TdHJpbmcoJ2Jhc2U2NCcpO1xufTtcblxuT2JqZWN0LmFzc2lnbihleHRlbnNpb25zLCBjb21tYW5kcywgaGVscGVycyk7XG5leHBvcnQgeyBjb21tYW5kcywgaGVscGVycyB9O1xuZXhwb3J0IGRlZmF1bHQgZXh0ZW5zaW9ucztcbiJdLCJmaWxlIjoibGliL2NvbW1hbmRzL2FjdGlvbnMuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
